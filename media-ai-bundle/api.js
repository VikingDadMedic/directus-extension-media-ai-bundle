"use strict";var e=require("buffer"),t=require("crypto"),n=require("stream"),r=require("http"),o=require("https");require("http2");var s=require("util"),i=require("os"),a=require("path"),c=require("fs"),u=require("url"),d=require("child_process"),l=require("process");function p(e){var t=e.default;if("function"==typeof t){var n=function e(){if(this instanceof e){var n=[null];return n.push.apply(n,arguments),new(Function.bind.apply(t,n))}return t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})})),n}var f=(0).constructor;f.isFinite,f.isInteger,[].constructor.isArray;var h,g,m,y,w;new(function(){function e(e){this.size=e,this.reset()}return e.prototype.reset=function(){this.oldestIndex=0,this.map={},this.cachedKeys=new Array(this.size)},e.prototype.get=function(e){return this.map[e]},e.prototype.set=function(e,t){this.map[e]=t;var n=this.cachedKeys[this.oldestIndex];void 0!==n&&delete this.map[n],this.cachedKeys[this.oldestIndex]=e,this.oldestIndex++,this.oldestIndex%=this.size},e}())(1e3),function(e){e.HEADER="header",e.QUERY="query"}(h||(h={})),function(e){e.HTTP="http",e.HTTPS="https"}(g||(g={})),function(e){e.MD5="md5",e.CRC32="crc32",e.CRC32C="crc32c",e.SHA1="sha1",e.SHA256="sha256"}(m||(m={})),function(e){e[e.HEADER=0]="HEADER",e[e.TRAILER=1]="TRAILER"}(y||(y={})),function(e){e.HTTP_0_9="http/0.9",e.HTTP_1_0="http/1.0",e.TDS_8_0="tds/8.0"}(w||(w={}));class b{constructor(e){this.method=e.method||"GET",this.hostname=e.hostname||"localhost",this.port=e.port,this.query=e.query||{},this.headers=e.headers||{},this.body=e.body,this.protocol=e.protocol?":"!==e.protocol.slice(-1)?`${e.protocol}:`:e.protocol:"https:",this.path=e.path?"/"!==e.path.charAt(0)?`/${e.path}`:e.path:"/",this.username=e.username,this.password=e.password,this.fragment=e.fragment}static isInstance(e){if(!e)return!1;const t=e;return"method"in t&&"protocol"in t&&"hostname"in t&&"path"in t&&"object"==typeof t.query&&"object"==typeof t.headers}clone(){const e=new b({...this,headers:{...this.headers}});var t;return e.query&&(e.query=(t=e.query,Object.keys(t).reduce(((e,n)=>{const r=t[n];return{...e,[n]:Array.isArray(r)?[...r]:r}}),{}))),e}}class v{constructor(e){this.statusCode=e.statusCode,this.reason=e.reason,this.headers=e.headers||{},this.body=e.body}static isInstance(e){if(!e)return!1;const t=e;return"number"==typeof t.statusCode&&"object"==typeof t.headers}}const E={name:"hostHeaderMiddleware",step:"build",priority:"low",tags:["HOST"],override:!0},x=e=>({applyToStack:t=>{t.add((e=>t=>async n=>{if(!b.isInstance(n.request))return t(n);const{request:r}=n,{handlerProtocol:o=""}=e.requestHandler.metadata||{};if(o.indexOf("h2")>=0&&!r.headers[":authority"])delete r.headers.host,r.headers[":authority"]="";else if(!r.headers.host){let e=r.hostname;null!=r.port&&(e+=`:${r.port}`),r.headers.host=e}return t(n)})(e),E)}}),S={name:"loggerMiddleware",tags:["LOGGER"],step:"initialize",override:!0},I=e=>({applyToStack:e=>{e.add(((e,t)=>async n=>{try{const r=await e(n),{clientName:o,commandName:s,logger:i,dynamoDbDocumentClientOptions:a={}}=t,{overrideInputFilterSensitiveLog:c,overrideOutputFilterSensitiveLog:u}=a,d=c??t.inputFilterSensitiveLog,l=u??t.outputFilterSensitiveLog,{$metadata:p,...f}=r.output;return i?.info?.({clientName:o,commandName:s,input:d(n.input),output:l(f),metadata:p}),r}catch(e){const{clientName:r,commandName:o,logger:s,dynamoDbDocumentClientOptions:i={}}=t,{overrideInputFilterSensitiveLog:a}=i,c=a??t.inputFilterSensitiveLog;throw s?.error?.({clientName:r,commandName:o,input:c(n.input),error:e,metadata:e.$metadata}),e}}),S)}}),A="X-Amzn-Trace-Id",P={step:"build",tags:["RECURSION_DETECTION"],name:"recursionDetectionMiddleware",override:!0,priority:"low"},T=e=>({applyToStack:t=>{t.add((e=>t=>async n=>{const{request:r}=n;if(!b.isInstance(r)||"node"!==e.runtime||r.headers.hasOwnProperty(A))return t(n);const o=process.env.AWS_LAMBDA_FUNCTION_NAME,s=process.env._X_AMZN_TRACE_ID,i=e=>"string"==typeof e&&e.length>0;return i(o)&&i(s)&&(r.headers[A]=s),t({...n,request:r})})(e),P)}});class C extends Error{constructor(e,t=!0){super(e),this.tryNextLink=t,this.name="ProviderError",Object.setPrototypeOf(this,C.prototype)}static from(e,t=!0){return Object.assign(new this(e.message,t),e)}}class k extends C{constructor(e,t=!0){super(e,t),this.tryNextLink=t,this.name="CredentialsProviderError",Object.setPrototypeOf(this,k.prototype)}}class O extends C{constructor(e,t=!0){super(e,t),this.tryNextLink=t,this.name="TokenProviderError",Object.setPrototypeOf(this,O.prototype)}}function _(...e){return()=>{let t=Promise.reject(new C("No providers in chain"));for(const n of e)t=t.catch((e=>{if(e?.tryNextLink)return n();throw e}));return t}}const R=(e,t,n)=>{let r,o,s,i=!1;const a=async()=>{o||(o=e());try{r=await o,s=!0,i=!1}finally{o=void 0}return r};return void 0===t?async e=>(s&&!e?.forceRefresh||(r=await a()),r):async e=>(s&&!e?.forceRefresh||(r=await a()),i?r:n&&!n(r)?(i=!0,r):t(r)?(await a(),r):r)};var $={},N=function(e,t){return N=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},N(e,t)};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var D=function(){return D=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},D.apply(this,arguments)};function j(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function U(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,s=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(o)throw o.error}}return i}function F(e){return this instanceof F?(this.v=e,this):new F(e)}var M=Object.freeze({__proto__:null,get __assign(){return D},__asyncDelegator:function(e){var t,n;return t={},r("next"),r("throw",(function(e){throw e})),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,o){t[r]=e[r]?function(t){return(n=!n)?{value:F(e[r](t)),done:"return"===r}:o?o(t):t}:o}},__asyncGenerator:function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(e,t||[]),s=[];return r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r;function i(e){o[e]&&(r[e]=function(t){return new Promise((function(n,r){s.push([e,t,n,r])>1||a(e,t)}))})}function a(e,t){try{!function(e){e.value instanceof F?Promise.resolve(e.value.v).then(c,u):d(s[0][2],e)}(o[e](t))}catch(e){d(s[0][3],e)}}function c(e){a("next",e)}function u(e){a("throw",e)}function d(e,t){e(t),s.shift(),s.length&&a(s[0][0],s[0][1])}},__asyncValues:function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=j(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,o){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,o,(t=e[n](t)).done,t.value)}))}}},__await:F,__awaiter:function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((r=r.apply(e,t||[])).next())}))},__classPrivateFieldGet:function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},__classPrivateFieldSet:function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n},__createBinding:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]},__decorate:function(e,t,n,r){var o,s=arguments.length,i=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(i=(s<3?o(i):s>3?o(t,n,i):o(t,n))||i);return s>3&&i&&Object.defineProperty(t,n,i),i},__exportStar:function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||(t[n]=e[n])},__extends:function(e,t){function n(){this.constructor=e}N(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},__generator:function(e,t){var n,r,o,s,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},__importDefault:function(e){return e&&e.__esModule?e:{default:e}},__importStar:function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t},__makeTemplateObject:function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},__metadata:function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__param:function(e,t){return function(n,r){t(n,r,e)}},__read:U,__rest:function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},__spread:function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(U(arguments[t]));return e},__spreadArrays:function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var s=arguments[t],i=0,a=s.length;i<a;i++,o++)r[o]=s[i];return r},__values:j}),L=p(M),z={},q={};var B=Object.freeze({__proto__:null,fromUtf8:e=>"function"==typeof TextEncoder?function(e){return(new TextEncoder).encode(e)}(e):(e=>{const t=[];for(let n=0,r=e.length;n<r;n++){const r=e.charCodeAt(n);if(r<128)t.push(r);else if(r<2048)t.push(r>>6|192,63&r|128);else if(n+1<e.length&&55296==(64512&r)&&56320==(64512&e.charCodeAt(n+1))){const o=65536+((1023&r)<<10)+(1023&e.charCodeAt(++n));t.push(o>>18|240,o>>12&63|128,o>>6&63|128,63&o|128)}else t.push(r>>12|224,r>>6&63|128,63&r|128)}return Uint8Array.from(t)})(e),toUtf8:e=>"function"==typeof TextDecoder?function(e){return new TextDecoder("utf-8").decode(e)}(e):(e=>{let t="";for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r<128)t+=String.fromCharCode(r);else if(192<=r&&r<224){const o=e[++n];t+=String.fromCharCode((31&r)<<6|63&o)}else if(240<=r&&r<365){const o="%"+[r,e[++n],e[++n],e[++n]].map((e=>e.toString(16))).join("%");t+=decodeURIComponent(o)}else t+=String.fromCharCode((15&r)<<12|(63&e[++n])<<6|63&e[++n])}return t})(e)}),W=p(B);Object.defineProperty(q,"__esModule",{value:!0}),q.convertToBuffer=void 0;var V=W,H="undefined"!=typeof Buffer&&Buffer.from?function(e){return Buffer.from(e,"utf8")}:V.fromUtf8;q.convertToBuffer=function(e){return e instanceof Uint8Array?e:"string"==typeof e?H(e):ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(e)};var K={};Object.defineProperty(K,"__esModule",{value:!0}),K.isEmptyData=void 0,K.isEmptyData=function(e){return"string"==typeof e?0===e.length:0===e.byteLength};var G={};Object.defineProperty(G,"__esModule",{value:!0}),G.numToUint8=void 0,G.numToUint8=function(e){return new Uint8Array([(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e])};var X={};Object.defineProperty(X,"__esModule",{value:!0}),X.uint32ArrayFrom=void 0,X.uint32ArrayFrom=function(e){if(!Uint32Array.from){for(var t=new Uint32Array(e.length),n=0;n<e.length;)t[n]=e[n],n+=1;return t}return Uint32Array.from(e)},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.uint32ArrayFrom=e.numToUint8=e.isEmptyData=e.convertToBuffer=void 0;var t=q;Object.defineProperty(e,"convertToBuffer",{enumerable:!0,get:function(){return t.convertToBuffer}});var n=K;Object.defineProperty(e,"isEmptyData",{enumerable:!0,get:function(){return n.isEmptyData}});var r=G;Object.defineProperty(e,"numToUint8",{enumerable:!0,get:function(){return r.numToUint8}});var o=X;Object.defineProperty(e,"uint32ArrayFrom",{enumerable:!0,get:function(){return o.uint32ArrayFrom}})}(z);var J,Y,Z={};function Q(){return Y||(Y=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.AwsCrc32=e.Crc32=e.crc32=void 0;var t=L,n=z;e.crc32=function(e){return(new r).update(e).digest()};var r=function(){function e(){this.checksum=4294967295}return e.prototype.update=function(e){var n,r;try{for(var s=t.__values(e),i=s.next();!i.done;i=s.next()){var a=i.value;this.checksum=this.checksum>>>8^o[255&(this.checksum^a)]}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return this},e.prototype.digest=function(){return(4294967295^this.checksum)>>>0},e}();e.Crc32=r;var o=(0,n.uint32ArrayFrom)([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]),s=function(){if(J)return Z;J=1,Object.defineProperty(Z,"__esModule",{value:!0}),Z.AwsCrc32=void 0;var e=L,t=z,n=Q(),r=function(){function r(){this.crc32=new n.Crc32}return r.prototype.update=function(e){(0,t.isEmptyData)(e)||this.crc32.update((0,t.convertToBuffer)(e))},r.prototype.digest=function(){return e.__awaiter(this,void 0,void 0,(function(){return e.__generator(this,(function(e){return[2,(0,t.numToUint8)(this.crc32.digest())]}))}))},r.prototype.reset=function(){this.crc32=new n.Crc32},r}();return Z.AwsCrc32=r,Z}();Object.defineProperty(e,"AwsCrc32",{enumerable:!0,get:function(){return s.AwsCrc32}})}($)),$}Q();const ee={},te={};for(let e=0;e<256;e++){let t=e.toString(16).toLowerCase();1===t.length&&(t=`0${t}`),ee[e]=t,te[t]=e}function ne(e){let t="";for(let n=0;n<e.byteLength;n++)t+=ee[e[n]];return t}class re{constructor(e){if(this.bytes=e,8!==e.byteLength)throw new Error("Int64 buffers must be exactly 8 bytes")}static fromNumber(e){if(e>0x8000000000000000||e<-0x8000000000000000)throw new Error(`${e} is too large (or, if negative, too small) to represent as an Int64`);const t=new Uint8Array(8);for(let n=7,r=Math.abs(Math.round(e));n>-1&&r>0;n--,r/=256)t[n]=r;return e<0&&oe(t),new re(t)}valueOf(){const e=this.bytes.slice(0),t=128&e[0];return t&&oe(e),parseInt(ne(e),16)*(t?-1:1)}toString(){return String(this.valueOf())}}function oe(e){for(let t=0;t<8;t++)e[t]^=255;for(let t=7;t>-1&&(e[t]++,0===e[t]);t--);}class se{constructor(e,t){this.toUtf8=e,this.fromUtf8=t}format(e){const t=[];for(const n of Object.keys(e)){const r=this.fromUtf8(n);t.push(Uint8Array.from([r.byteLength]),r,this.formatHeaderValue(e[n]))}const n=new Uint8Array(t.reduce(((e,t)=>e+t.byteLength),0));let r=0;for(const e of t)n.set(e,r),r+=e.byteLength;return n}formatHeaderValue(e){switch(e.type){case"boolean":return Uint8Array.from([e.value?0:1]);case"byte":return Uint8Array.from([2,e.value]);case"short":const t=new DataView(new ArrayBuffer(3));return t.setUint8(0,3),t.setInt16(1,e.value,!1),new Uint8Array(t.buffer);case"integer":const n=new DataView(new ArrayBuffer(5));return n.setUint8(0,4),n.setInt32(1,e.value,!1),new Uint8Array(n.buffer);case"long":const r=new Uint8Array(9);return r[0]=5,r.set(e.value.bytes,1),r;case"binary":const o=new DataView(new ArrayBuffer(3+e.value.byteLength));o.setUint8(0,6),o.setUint16(1,e.value.byteLength,!1);const s=new Uint8Array(o.buffer);return s.set(e.value,3),s;case"string":const i=this.fromUtf8(e.value),a=new DataView(new ArrayBuffer(3+i.byteLength));a.setUint8(0,7),a.setUint16(1,i.byteLength,!1);const c=new Uint8Array(a.buffer);return c.set(i,3),c;case"timestamp":const u=new Uint8Array(9);return u[0]=8,u.set(re.fromNumber(e.value.valueOf()).bytes,1),u;case"uuid":if(!me.test(e.value))throw new Error(`Invalid UUID received: ${e.value}`);const d=new Uint8Array(17);return d[0]=9,d.set(function(e){if(e.length%2!=0)throw new Error("Hex encoded strings must have an even number length");const t=new Uint8Array(e.length/2);for(let n=0;n<e.length;n+=2){const r=e.slice(n,n+2).toLowerCase();if(!(r in te))throw new Error(`Cannot decode unrecognized sequence ${r} as hexadecimal`);t[n/2]=te[r]}return t}(e.value.replace(/\-/g,"")),1),d}}parse(e){const t={};let n=0;for(;n<e.byteLength;){const r=e.getUint8(n++),o=this.toUtf8(new Uint8Array(e.buffer,e.byteOffset+n,r));switch(n+=r,e.getUint8(n++)){case 0:t[o]={type:ae,value:!0};break;case 1:t[o]={type:ae,value:!1};break;case 2:t[o]={type:ce,value:e.getInt8(n++)};break;case 3:t[o]={type:ue,value:e.getInt16(n,!1)},n+=2;break;case 4:t[o]={type:de,value:e.getInt32(n,!1)},n+=4;break;case 5:t[o]={type:le,value:new re(new Uint8Array(e.buffer,e.byteOffset+n,8))},n+=8;break;case 6:const r=e.getUint16(n,!1);n+=2,t[o]={type:pe,value:new Uint8Array(e.buffer,e.byteOffset+n,r)},n+=r;break;case 7:const s=e.getUint16(n,!1);n+=2,t[o]={type:fe,value:this.toUtf8(new Uint8Array(e.buffer,e.byteOffset+n,s))},n+=s;break;case 8:t[o]={type:he,value:new Date(new re(new Uint8Array(e.buffer,e.byteOffset+n,8)).valueOf())},n+=8;break;case 9:const i=new Uint8Array(e.buffer,e.byteOffset+n,16);n+=16,t[o]={type:ge,value:`${ne(i.subarray(0,4))}-${ne(i.subarray(4,6))}-${ne(i.subarray(6,8))}-${ne(i.subarray(8,10))}-${ne(i.subarray(10))}`};break;default:throw new Error("Unrecognized header type tag")}}return t}}var ie;!function(e){e[e.boolTrue=0]="boolTrue",e[e.boolFalse=1]="boolFalse",e[e.byte=2]="byte",e[e.short=3]="short",e[e.integer=4]="integer",e[e.long=5]="long",e[e.byteArray=6]="byteArray",e[e.string=7]="string",e[e.timestamp=8]="timestamp",e[e.uuid=9]="uuid"}(ie||(ie={}));const ae="boolean",ce="byte",ue="short",de="integer",le="long",pe="binary",fe="string",he="timestamp",ge="uuid",me=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/,ye=e=>{if("function"==typeof e)return e;const t=Promise.resolve(e);return()=>t},we=e=>"function"==typeof ArrayBuffer&&e instanceof ArrayBuffer||"[object ArrayBuffer]"===Object.prototype.toString.call(e),be=(t,n=0,r=t.byteLength-n)=>{if(!we(t))throw new TypeError(`The "input" argument must be ArrayBuffer. Received type ${typeof t} (${t})`);return e.Buffer.from(t,n,r)},ve=(t,n)=>{if("string"!=typeof t)throw new TypeError(`The "input" argument must be of type string. Received type ${typeof t} (${t})`);return n?e.Buffer.from(t,n):e.Buffer.from(t)},Ee=e=>{const t=ve(e,"utf8");return new Uint8Array(t.buffer,t.byteOffset,t.byteLength/Uint8Array.BYTES_PER_ELEMENT)},xe=e=>"string"==typeof e?Ee(e):ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(e),Se=e=>be(e.buffer,e.byteOffset,e.byteLength).toString("utf8"),Ie="X-Amz-Date",Ae="X-Amz-Signature",Pe="X-Amz-Security-Token",Te="authorization",Ce=Ie.toLowerCase(),ke=[Te,Ce,"date"],Oe=Ae.toLowerCase(),_e="x-amz-content-sha256",Re=Pe.toLowerCase(),$e={authorization:!0,"cache-control":!0,connection:!0,expect:!0,from:!0,"keep-alive":!0,"max-forwards":!0,pragma:!0,referer:!0,te:!0,trailer:!0,"transfer-encoding":!0,upgrade:!0,"user-agent":!0,"x-amzn-trace-id":!0},Ne=/^proxy-/,De=/^sec-/,je="AWS4-HMAC-SHA256",Ue="AWS4-HMAC-SHA256-PAYLOAD",Fe="aws4_request",Me={},Le=[],ze=(e,t,n)=>`${e}/${t}/${n}/${Fe}`,qe=(e,t,n)=>{const r=new e(t);return r.update(xe(n)),r.digest()},Be=({headers:e},t,n)=>{const r={};for(const o of Object.keys(e).sort()){if(null==e[o])continue;const s=o.toLowerCase();(s in $e||t?.has(s)||Ne.test(s)||De.test(s))&&(!n||n&&!n.has(s))||(r[s]=e[o].trim().replace(/\s+/g," "))}return r},We=e=>encodeURIComponent(e).replace(/[!'()*]/g,Ve),Ve=e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`,He=async({headers:e,body:t},n)=>{for(const t of Object.keys(e))if(t.toLowerCase()===_e)return e[t];if(null==t)return"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855";if("string"==typeof t||ArrayBuffer.isView(t)||we(t)){const e=new n;return e.update(xe(t)),ne(await e.digest())}return"UNSIGNED-PAYLOAD"},Ke=({headers:e,query:t,...n})=>({...n,headers:{...e},query:t?Ge(t):void 0}),Ge=e=>Object.keys(e).reduce(((t,n)=>{const r=e[n];return{...t,[n]:Array.isArray(r)?[...r]:r}}),{}),Xe=e=>{e="function"==typeof e.clone?e.clone():Ke(e);for(const t of Object.keys(e.headers))ke.indexOf(t.toLowerCase())>-1&&delete e.headers[t];return e},Je=e=>"number"==typeof e?new Date(1e3*e):"string"==typeof e?Number(e)?new Date(1e3*Number(e)):new Date(e):e;class Ye{constructor({applyChecksum:e,credentials:t,region:n,service:r,sha256:o,uriEscapePath:s=!0}){this.headerMarshaller=new se(Se,Ee),this.service=r,this.sha256=o,this.uriEscapePath=s,this.applyChecksum="boolean"!=typeof e||e,this.regionProvider=ye(n),this.credentialProvider=ye(t)}async presign(e,t={}){const{signingDate:n=new Date,expiresIn:r=3600,unsignableHeaders:o,unhoistableHeaders:s,signableHeaders:i,signingRegion:a,signingService:c}=t,u=await this.credentialProvider();this.validateResolvedCredentials(u);const d=a??await this.regionProvider(),{longDate:l,shortDate:p}=Ze(n);if(r>604800)return Promise.reject("Signature version 4 presigned URLs must have an expiration date less than one week in the future");const f=ze(p,d,c??this.service),h=((e,t={})=>{const{headers:n,query:r={}}="function"==typeof e.clone?e.clone():Ke(e);for(const e of Object.keys(n)){const o=e.toLowerCase();"x-amz-"!==o.slice(0,6)||t.unhoistableHeaders?.has(o)||(r[e]=n[e],delete n[e])}return{...e,headers:n,query:r}})(Xe(e),{unhoistableHeaders:s});u.sessionToken&&(h.query[Pe]=u.sessionToken),h.query["X-Amz-Algorithm"]=je,h.query["X-Amz-Credential"]=`${u.accessKeyId}/${f}`,h.query[Ie]=l,h.query["X-Amz-Expires"]=r.toString(10);const g=Be(h,o,i);return h.query["X-Amz-SignedHeaders"]=Qe(g),h.query[Ae]=await this.getSignature(l,f,this.getSigningKey(u,d,p,c),this.createCanonicalRequest(h,g,await He(e,this.sha256))),h}async sign(e,t){return"string"==typeof e?this.signString(e,t):e.headers&&e.payload?this.signEvent(e,t):e.message?this.signMessage(e,t):this.signRequest(e,t)}async signEvent({headers:e,payload:t},{signingDate:n=new Date,priorSignature:r,signingRegion:o,signingService:s}){const i=o??await this.regionProvider(),{shortDate:a,longDate:c}=Ze(n),u=ze(a,i,s??this.service),d=await He({headers:{},body:t},this.sha256),l=new this.sha256;l.update(e);const p=ne(await l.digest()),f=[Ue,c,u,r,p,d].join("\n");return this.signString(f,{signingDate:n,signingRegion:i,signingService:s})}async signMessage(e,{signingDate:t=new Date,signingRegion:n,signingService:r}){return this.signEvent({headers:this.headerMarshaller.format(e.message.headers),payload:e.message.body},{signingDate:t,signingRegion:n,signingService:r,priorSignature:e.priorSignature}).then((t=>({message:e.message,signature:t})))}async signString(e,{signingDate:t=new Date,signingRegion:n,signingService:r}={}){const o=await this.credentialProvider();this.validateResolvedCredentials(o);const s=n??await this.regionProvider(),{shortDate:i}=Ze(t),a=new this.sha256(await this.getSigningKey(o,s,i,r));return a.update(xe(e)),ne(await a.digest())}async signRequest(e,{signingDate:t=new Date,signableHeaders:n,unsignableHeaders:r,signingRegion:o,signingService:s}={}){const i=await this.credentialProvider();this.validateResolvedCredentials(i);const a=o??await this.regionProvider(),c=Xe(e),{longDate:u,shortDate:d}=Ze(t),l=ze(d,a,s??this.service);c.headers[Ce]=u,i.sessionToken&&(c.headers[Re]=i.sessionToken);const p=await He(c,this.sha256);!((e,t)=>{e=e.toLowerCase();for(const n of Object.keys(t))if(e===n.toLowerCase())return!0;return!1})(_e,c.headers)&&this.applyChecksum&&(c.headers[_e]=p);const f=Be(c,r,n),h=await this.getSignature(u,l,this.getSigningKey(i,a,d,s),this.createCanonicalRequest(c,f,p));return c.headers[Te]=`${je} Credential=${i.accessKeyId}/${l}, SignedHeaders=${Qe(f)}, Signature=${h}`,c}createCanonicalRequest(e,t,n){const r=Object.keys(t).sort();return`${e.method}\n${this.getCanonicalPath(e)}\n${(({query:e={}})=>{const t=[],n={};for(const r of Object.keys(e).sort()){if(r.toLowerCase()===Oe)continue;t.push(r);const o=e[r];"string"==typeof o?n[r]=`${We(r)}=${We(o)}`:Array.isArray(o)&&(n[r]=o.slice(0).reduce(((e,t)=>e.concat([`${We(r)}=${We(t)}`])),[]).sort().join("&"))}return t.map((e=>n[e])).filter((e=>e)).join("&")})(e)}\n${r.map((e=>`${e}:${t[e]}`)).join("\n")}\n\n${r.join(";")}\n${n}`}async createStringToSign(e,t,n){const r=new this.sha256;r.update(xe(n));const o=await r.digest();return`${je}\n${e}\n${t}\n${ne(o)}`}getCanonicalPath({path:e}){if(this.uriEscapePath){const t=[];for(const n of e.split("/"))0!==n?.length&&"."!==n&&(".."===n?t.pop():t.push(n));const n=`${e?.startsWith("/")?"/":""}${t.join("/")}${t.length>0&&e?.endsWith("/")?"/":""}`;return encodeURIComponent(n).replace(/%2F/g,"/")}return e}async getSignature(e,t,n,r){const o=await this.createStringToSign(e,t,r),s=new this.sha256(await n);return s.update(xe(o)),ne(await s.digest())}getSigningKey(e,t,n,r){return(async(e,t,n,r,o)=>{const s=`${n}:${r}:${o}:${ne(await qe(e,t.secretAccessKey,t.accessKeyId))}:${t.sessionToken}`;if(s in Me)return Me[s];for(Le.push(s);Le.length>50;)delete Me[Le.shift()];let i=`AWS4${t.secretAccessKey}`;for(const t of[n,r,o,Fe])i=await qe(e,i,t);return Me[s]=i})(this.sha256,e,n,t,r||this.service)}validateResolvedCredentials(e){if("object"!=typeof e||"string"!=typeof e.accessKeyId||"string"!=typeof e.secretAccessKey)throw new Error("Resolved credential object is not valid")}}const Ze=e=>{const t=(n=e,Je(n).toISOString().replace(/\.\d{3}Z$/,"Z")).replace(/[\-:]/g,"");var n;return{longDate:t,shortDate:t.slice(0,8)}},Qe=e=>Object.keys(e).sort().join(";"),et=e=>{const t=e.credentials?tt(e.credentials):e.credentialDefaultProvider(e),{signingEscapePath:n=!0,systemClockOffset:r=e.systemClockOffset||0,sha256:o}=e;let s;return s=e.signer?ye(e.signer):e.regionInfoProvider?()=>ye(e.region)().then((async t=>[await e.regionInfoProvider(t,{useFipsEndpoint:await e.useFipsEndpoint(),useDualstackEndpoint:await e.useDualstackEndpoint()})||{},t])).then((([r,s])=>{const{signingRegion:i,signingService:a}=r;e.signingRegion=e.signingRegion||i||s,e.signingName=e.signingName||a||e.serviceId;const c={...e,credentials:t,region:e.signingRegion,service:e.signingName,sha256:o,uriEscapePath:n};return new(e.signerConstructor||Ye)(c)})):async r=>{const s=(r=Object.assign({},{name:"sigv4",signingName:e.signingName||e.defaultSigningName,signingRegion:await ye(e.region)(),properties:{}},r)).signingRegion,i=r.signingName;e.signingRegion=e.signingRegion||s,e.signingName=e.signingName||i||e.serviceId;const a={...e,credentials:t,region:e.signingRegion,service:e.signingName,sha256:o,uriEscapePath:n};return new(e.signerConstructor||Ye)(a)},{...e,systemClockOffset:r,signingEscapePath:n,credentials:t,signer:s}},tt=e=>"function"==typeof e?R(e,(e=>void 0!==e.expiration&&e.expiration.getTime()-Date.now()<3e5),(e=>void 0!==e.expiration)):ye(e),nt=e=>new Date(Date.now()+e),rt=(e,t)=>{const n=Date.parse(e);return((e,t)=>Math.abs(nt(t).getTime()-e)>=3e5)(n,t)?n-Date.now():t},ot=e=>v.isInstance(e)?e.headers?.date??e.headers?.Date:void 0,st={name:"awsAuthMiddleware",tags:["SIGNATURE","AWSAUTH"],relation:"after",toMiddleware:"retryMiddleware",override:!0},it=e=>({applyToStack:t=>{t.addRelativeTo((e=>(t,n)=>async function(r){if(!b.isInstance(r.request))return t(r);const o=n.endpointV2?.properties?.authSchemes?.[0],s="sigv4a"===o?.name?o?.signingRegionSet?.join(","):void 0,i=await e.signer(o),a=await t({...r,request:await i.sign(r.request,{signingDate:nt(e.systemClockOffset),signingRegion:s||n.signing_region,signingService:n.signing_service})}).catch((t=>{const n=t.ServerTime??ot(t.$response);throw n&&(e.systemClockOffset=rt(n,e.systemClockOffset)),t})),c=ot(a.response);return c&&(e.systemClockOffset=rt(c,e.systemClockOffset)),a})(e),st)}});function at(e){return{...e,customUserAgent:"string"==typeof e.customUserAgent?[[e.customUserAgent]]:e.customUserAgent}}var ct={partitions:[{id:"aws",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",name:"aws",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^(us|eu|ap|sa|ca|me|af|il)\\-\\w+\\-\\d+$",regions:{"af-south-1":{description:"Africa (Cape Town)"},"ap-east-1":{description:"Asia Pacific (Hong Kong)"},"ap-northeast-1":{description:"Asia Pacific (Tokyo)"},"ap-northeast-2":{description:"Asia Pacific (Seoul)"},"ap-northeast-3":{description:"Asia Pacific (Osaka)"},"ap-south-1":{description:"Asia Pacific (Mumbai)"},"ap-south-2":{description:"Asia Pacific (Hyderabad)"},"ap-southeast-1":{description:"Asia Pacific (Singapore)"},"ap-southeast-2":{description:"Asia Pacific (Sydney)"},"ap-southeast-3":{description:"Asia Pacific (Jakarta)"},"ap-southeast-4":{description:"Asia Pacific (Melbourne)"},"aws-global":{description:"AWS Standard global region"},"ca-central-1":{description:"Canada (Central)"},"eu-central-1":{description:"Europe (Frankfurt)"},"eu-central-2":{description:"Europe (Zurich)"},"eu-north-1":{description:"Europe (Stockholm)"},"eu-south-1":{description:"Europe (Milan)"},"eu-south-2":{description:"Europe (Spain)"},"eu-west-1":{description:"Europe (Ireland)"},"eu-west-2":{description:"Europe (London)"},"eu-west-3":{description:"Europe (Paris)"},"il-central-1":{description:"Israel (Tel Aviv)"},"me-central-1":{description:"Middle East (UAE)"},"me-south-1":{description:"Middle East (Bahrain)"},"sa-east-1":{description:"South America (Sao Paulo)"},"us-east-1":{description:"US East (N. Virginia)"},"us-east-2":{description:"US East (Ohio)"},"us-west-1":{description:"US West (N. California)"},"us-west-2":{description:"US West (Oregon)"}}},{id:"aws-cn",outputs:{dnsSuffix:"amazonaws.com.cn",dualStackDnsSuffix:"api.amazonwebservices.com.cn",name:"aws-cn",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^cn\\-\\w+\\-\\d+$",regions:{"aws-cn-global":{description:"AWS China global region"},"cn-north-1":{description:"China (Beijing)"},"cn-northwest-1":{description:"China (Ningxia)"}}},{id:"aws-us-gov",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",name:"aws-us-gov",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^us\\-gov\\-\\w+\\-\\d+$",regions:{"aws-us-gov-global":{description:"AWS GovCloud (US) global region"},"us-gov-east-1":{description:"AWS GovCloud (US-East)"},"us-gov-west-1":{description:"AWS GovCloud (US-West)"}}},{id:"aws-iso",outputs:{dnsSuffix:"c2s.ic.gov",dualStackDnsSuffix:"c2s.ic.gov",name:"aws-iso",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-iso\\-\\w+\\-\\d+$",regions:{"aws-iso-global":{description:"AWS ISO (US) global region"},"us-iso-east-1":{description:"US ISO East"},"us-iso-west-1":{description:"US ISO WEST"}}},{id:"aws-iso-b",outputs:{dnsSuffix:"sc2s.sgov.gov",dualStackDnsSuffix:"sc2s.sgov.gov",name:"aws-iso-b",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-isob\\-\\w+\\-\\d+$",regions:{"aws-iso-b-global":{description:"AWS ISOB (US) global region"},"us-isob-east-1":{description:"US ISOB East (Ohio)"}}},{id:"aws-iso-e",outputs:{dnsSuffix:"cloud.adc-e.uk",dualStackDnsSuffix:"cloud.adc-e.uk",name:"aws-iso-e",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^eu\\-isoe\\-\\w+\\-\\d+$",regions:{}},{id:"aws-iso-f",outputs:{dnsSuffix:"csp.hci.ic.gov",dualStackDnsSuffix:"csp.hci.ic.gov",name:"aws-iso-f",supportsDualStack:!1,supportsFIPS:!0},regionRegex:"^us\\-isof\\-\\w+\\-\\d+$",regions:{}}],version:"1.1"};let ut=ct,dt="";const lt=(e,t="")=>{ut=e,dt=t},pt=()=>dt,ft=new RegExp("^(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}$"),ht=e=>ft.test(e)||e.startsWith("[")&&e.endsWith("]"),gt="endpoints";function mt(e){return"object"!=typeof e||null==e?e:"ref"in e?`$${mt(e.ref)}`:"fn"in e?`${e.fn}(${(e.argv||[]).map(mt).join(", ")})`:JSON.stringify(e,null,2)}class yt extends Error{constructor(e){super(e),this.name="EndpointError"}}const wt=new RegExp("^(?!.*-$)(?!-)[a-zA-Z0-9-]{1,63}$"),bt=(e,t=!1)=>{if(!t)return wt.test(e);const n=e.split(".");for(const e of n)if(!bt(e))return!1;return!0},vt=(e,t=!1)=>{if(t){for(const t of e.split("."))if(!vt(t))return!1;return!0}return!!bt(e)&&(!(e.length<3||e.length>63)&&(e===e.toLowerCase()&&!ht(e)))};var Et=Object.freeze({__proto__:null,getUserAgentPrefix:pt,isVirtualHostableS3Bucket:vt,parseArn:e=>{const t=e.split(":");if(t.length<6)return null;const[n,r,o,s,i,...a]=t;return"arn"!==n||""===r||""===o||""===a[0]?null:{partition:r,service:o,region:s,accountId:i,resourceId:a[0].includes("/")?a[0].split("/"):a}},partition:e=>{const{partitions:t}=ut;for(const n of t){const{regions:t,outputs:r}=n;for(const[n,o]of Object.entries(t))if(n===e)return{...r,...o}}for(const n of t){const{regionRegex:t,outputs:r}=n;if(new RegExp(t).test(e))return{...r}}const n=t.find((e=>"aws"===e.id));if(!n)throw new Error("Provided region was not found in the partition array or regex, and default partition with id 'aws' doesn't exist.");return{...n.outputs}},setPartitionInfo:lt,useDefaultPartitionInfo:()=>{lt(ct,"")}});const xt=(e,t)=>(e=>{const t=e.split("."),n=[];for(const r of t){const t=r.indexOf("[");if(-1!==t){if(r.indexOf("]")!==r.length-1)throw new yt(`Path: '${e}' does not end with ']'`);const o=r.slice(t+1,-1);if(Number.isNaN(parseInt(o)))throw new yt(`Invalid array index: '${o}' in path: '${e}'`);0!==t&&n.push(r.slice(0,t)),n.push(o)}else n.push(r)}return n})(t).reduce(((n,r)=>{if("object"!=typeof n)throw new yt(`Index '${r}' in '${t}' not found in '${JSON.stringify(e)}'`);return Array.isArray(n)?n[parseInt(r)]:n[r]}),e);var St;!function(e){e.AAAA="AAAA",e.A="A"}(St||(St={}));const It={[g.HTTP]:80,[g.HTTPS]:443};var At=Object.freeze({__proto__:null,aws:Et,booleanEquals:(e,t)=>e===t,getAttr:xt,isSet:e=>null!=e,isValidHostLabel:bt,not:e=>!e,parseURL:e=>{const t=(()=>{try{if(e instanceof URL)return e;if("object"==typeof e&&"hostname"in e){const{hostname:t,port:n,protocol:r="",path:o="",query:s={}}=e,i=new URL(`${r}//${t}${n?`:${n}`:""}${o}`);return i.search=Object.entries(s).map((([e,t])=>`${e}=${t}`)).join("&"),i}return new URL(e)}catch(e){return null}})();if(!t)return console.error(`Unable to parse ${JSON.stringify(e)} as a whatwg URL.`),null;const n=t.href,{host:r,hostname:o,pathname:s,protocol:i,search:a}=t;if(a)return null;const c=i.slice(0,-1);if(!Object.values(g).includes(c))return null;const u=ht(o);return{scheme:c,authority:`${r}${n.includes(`${r}:${It[c]}`)||"string"==typeof e&&e.includes(`${r}:${It[c]}`)?`:${It[c]}`:""}`,path:s,normalizedPath:s.endsWith("/")?s:`${s}/`,isIp:u}},stringEquals:(e,t)=>e===t,substring:(e,t,n,r)=>t>=n||e.length<n?null:r?e.substring(e.length-n,e.length-t):e.substring(t,n),uriEncode:e=>encodeURIComponent(e).replace(/[!*'()]/g,(e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`))});const Pt=(e,t)=>{const n=[],r={...t.endpointParams,...t.referenceRecord};let o=0;for(;o<e.length;){const t=e.indexOf("{",o);if(-1===t){n.push(e.slice(o));break}n.push(e.slice(o,t));const s=e.indexOf("}",t);if(-1===s){n.push(e.slice(t));break}"{"===e[t+1]&&"}"===e[s+1]&&(n.push(e.slice(t+1,s)),o=s+2);const i=e.substring(t+1,s);if(i.includes("#")){const[e,t]=i.split("#");n.push(xt(r[e],t))}else n.push(r[i]);o=s+1}return n.join("")},Tt=(e,t,n)=>{if("string"==typeof e)return Pt(e,n);if(e.fn)return Ct(e,n);if(e.ref)return(({ref:e},t)=>({...t.endpointParams,...t.referenceRecord}[e]))(e,n);throw new yt(`'${t}': ${String(e)} is not a string, function or reference.`)},Ct=({fn:e,argv:t},n)=>{const r=t.map((e=>["boolean","number"].includes(typeof e)?e:Tt(e,"arg",n)));return e.split(".").reduce(((e,t)=>e[t]),At)(...r)},kt=({assign:e,...t},n)=>{if(e&&e in n.referenceRecord)throw new yt(`'${e}' is already defined in Reference Record.`);const r=Ct(t,n);return n.logger?.debug?.(gt,`evaluateCondition: ${mt(t)} = ${mt(r)}`),{result:""===r||!!r,...null!=e&&{toAssign:{name:e,value:r}}}},Ot=(e=[],t)=>{const n={};for(const r of e){const{result:e,toAssign:o}=kt(r,{...t,referenceRecord:{...t.referenceRecord,...n}});if(!e)return{result:e};o&&(n[o.name]=o.value,t.logger?.debug?.(gt,`assign: ${o.name} := ${mt(o.value)}`))}return{result:!0,referenceRecord:n}},_t=(e,t)=>Object.entries(e).reduce(((e,[n,r])=>({...e,[n]:r.map((e=>{const r=Tt(e,"Header value entry",t);if("string"!=typeof r)throw new yt(`Header '${n}' value '${r}' is not a string`);return r}))})),{}),Rt=(e,t)=>{if(Array.isArray(e))return e.map((e=>Rt(e,t)));switch(typeof e){case"string":return Pt(e,t);case"object":if(null===e)throw new yt(`Unexpected endpoint property: ${e}`);return $t(e,t);case"boolean":return e;default:throw new yt("Unexpected endpoint property type: "+typeof e)}},$t=(e,t)=>Object.entries(e).reduce(((e,[n,r])=>({...e,[n]:Rt(r,t)})),{}),Nt=(e,t)=>{const n=Tt(e,"Endpoint URL",t);if("string"==typeof n)try{return new URL(n)}catch(e){throw console.error(`Failed to construct URL with ${n}`,e),e}throw new yt("Endpoint URL must be a string, got "+typeof n)},Dt=(e,t)=>{const{conditions:n,endpoint:r}=e,{result:o,referenceRecord:s}=Ot(n,t);if(!o)return;const i={...t,referenceRecord:{...t.referenceRecord,...s}},{url:a,properties:c,headers:u}=r;return t.logger?.debug?.(gt,`Resolving endpoint from template: ${mt(r)}`),{...null!=u&&{headers:_t(u,i)},...null!=c&&{properties:$t(c,i)},url:Nt(a,i)}},jt=(e,t)=>{const{conditions:n,error:r}=e,{result:o,referenceRecord:s}=Ot(n,t);if(o)throw new yt(Tt(r,"Error",{...t,referenceRecord:{...t.referenceRecord,...s}}))},Ut=(e,t)=>{const{conditions:n,rules:r}=e,{result:o,referenceRecord:s}=Ot(n,t);if(o)return Ft(r,{...t,referenceRecord:{...t.referenceRecord,...s}})},Ft=(e,t)=>{for(const n of e)if("endpoint"===n.type){const e=Dt(n,t);if(e)return e}else if("error"===n.type)jt(n,t);else{if("tree"!==n.type)throw new yt(`Unknown endpoint rule: ${n}`);{const e=Ut(n,t);if(e)return e}}throw new yt("Rules evaluation failed")},Mt=(e,t)=>{const{endpointParams:n,logger:r}=t,{parameters:o,rules:s}=e;t.logger?.debug?.(`${gt} Initial EndpointParams: ${mt(n)}`);const i=Object.entries(o).filter((([,e])=>null!=e.default)).map((([e,t])=>[e,t.default]));if(i.length>0)for(const[e,t]of i)n[e]=n[e]??t;const a=Object.entries(o).filter((([,e])=>e.required)).map((([e])=>e));for(const e of a)if(null==n[e])throw new yt(`Missing required parameter: '${e}'`);const c=Ft(s,{endpointParams:n,logger:r,referenceRecord:{}});if(t.endpointParams?.Endpoint)try{const e=new URL(t.endpointParams.Endpoint),{protocol:n,port:r}=e;c.url.protocol=n,c.url.port=r}catch(e){}return t.logger?.debug?.(`${gt} Resolved endpoint: ${mt(c)}`),c},Lt="user-agent",zt="x-amz-user-agent",qt=/[^\!\$\%\&\'\*\+\-\.\^\_\`\|\~\d\w]/g,Bt=/[^\!\$\%\&\'\*\+\-\.\^\_\`\|\~\d\w\#]/g,Wt=e=>{const t=e[0].split("/").map((e=>e.replace(qt,"-"))).join("/"),n=e[1]?.replace(Bt,"-"),r=t.indexOf("/"),o=t.substring(0,r);let s=t.substring(r+1);return"api"===o&&(s=s.toLowerCase()),[o,s,n].filter((e=>e&&e.length>0)).reduce(((e,t,n)=>{switch(n){case 0:return t;case 1:return`${e}/${t}`;default:return`${e}#${t}`}}),"")},Vt={name:"getUserAgentMiddleware",step:"build",priority:"low",tags:["SET_USER_AGENT","USER_AGENT"],override:!0},Ht=e=>({applyToStack:t=>{var n;t.add((n=e,(e,t)=>async r=>{const{request:o}=r;if(!b.isInstance(o))return e(r);const{headers:s}=o,i=t?.userAgent?.map(Wt)||[],a=(await n.defaultUserAgentProvider()).map(Wt),c=n?.customUserAgent?.map(Wt)||[],u=pt(),d=(u?[u]:[]).concat([...a,...i,...c]).join(" "),l=[...a.filter((e=>e.startsWith("aws-sdk-"))),...c].join(" ");return"browser"!==n.runtime?(l&&(s[zt]=s[zt]?`${s[Lt]} ${l}`:l),s[Lt]=d):s[zt]=d,e({...r,request:o})}),Vt)}});var Kt;!function(e){e.ENV="env",e.CONFIG="shared config entry"}(Kt||(Kt={}));const Gt=(e,t,n)=>{if(t in e){if("true"===e[t])return!0;if("false"===e[t])return!1;throw new Error(`Cannot load ${n} "${t}". Expected "true" or "false", got ${e[t]}.`)}},Xt={environmentVariableSelector:e=>Gt(e,"AWS_USE_DUALSTACK_ENDPOINT",Kt.ENV),configFileSelector:e=>Gt(e,"use_dualstack_endpoint",Kt.CONFIG),default:!1},Jt={environmentVariableSelector:e=>Gt(e,"AWS_USE_FIPS_ENDPOINT",Kt.ENV),configFileSelector:e=>Gt(e,"use_fips_endpoint",Kt.CONFIG),default:!1},Yt={environmentVariableSelector:e=>e.AWS_REGION,configFileSelector:e=>e.region,default:()=>{throw new Error("Region is missing")}},Zt={preferredFile:"credentials"},Qt=e=>"string"==typeof e&&(e.startsWith("fips-")||e.endsWith("-fips")),en=e=>Qt(e)?["fips-aws-global","aws-fips"].includes(e)?"us-east-1":e.replace(/fips-(dkr-|prod-)?|-fips/,""):e,tn=e=>{const{region:t,useFipsEndpoint:n}=e;if(!t)throw new Error("Region is missing");return{...e,region:async()=>{if("string"==typeof t)return en(t);const e=await t();return en(e)},useFipsEndpoint:async()=>{const e="string"==typeof t?t:await t();return!!Qt(e)||("function"!=typeof n?Promise.resolve(!!n):n())}}},nn="content-length";const rn={step:"build",tags:["SET_CONTENT_LENGTH","CONTENT_LENGTH"],name:"contentLengthMiddleware",override:!0},on=e=>({applyToStack:t=>{var n;t.add((n=e.bodyLengthChecker,e=>async t=>{const r=t.request;if(b.isInstance(r)){const{body:e,headers:t}=r;if(e&&-1===Object.keys(t).map((e=>e.toLowerCase())).indexOf(nn))try{const t=n(e);r.headers={...r.headers,[nn]:String(t)}}catch(e){}}return e({...t,request:r})}),rn)}}),sn=/^[a-z0-9][a-z0-9\.\-]{1,61}[a-z0-9]$/,an=/(\d+\.){3}\d+/,cn=/\.\./,un=e=>sn.test(e)&&!an.test(e)&&!cn.test(e),dn=e=>{const[t,n,r,o,s,i]=e.split(":"),a="arn"===t&&e.split(":").length>=6,c=5===[t,n,r,s,i].filter(Boolean).length;if(a&&!c)throw new Error(`Invalid ARN: ${e} was an invalid ARN.`);return!!("arn"===t&&n&&r&&s&&i)},ln=(e,t,n)=>{const r=async()=>{const r=n[e]??n[t];return"function"==typeof r?r():r};return"endpoint"===e||"endpoint"===t?async()=>{const e=await r();if(e&&"object"==typeof e){if("url"in e)return e.url.href;if("hostname"in e){const{protocol:t,hostname:n,port:r,path:o}=e;return`${t}//${n}${r?":"+r:""}${o}`}}return e}:r},pn=async(e,t,n)=>{const r={},o=t?.getEndpointParameterInstructions?.()||{};for(const[t,s]of Object.entries(o))switch(s.type){case"staticContextParams":r[t]=s.value;break;case"contextParams":r[t]=e[s.name];break;case"clientContextParams":case"builtInParams":r[t]=await ln(s.name,t,n)();break;default:throw new Error("Unrecognized endpoint parameter instruction: "+JSON.stringify(s))}return 0===Object.keys(o).length&&Object.assign(r,n),"s3"===String(n.serviceId).toLowerCase()&&await(async e=>{const t=e?.Bucket||"";if("string"==typeof e.Bucket&&(e.Bucket=t.replace(/#/g,encodeURIComponent("#")).replace(/\?/g,encodeURIComponent("?"))),dn(t)){if(!0===e.ForcePathStyle)throw new Error("Path-style addressing cannot be used with ARN buckets")}else(!un(t)||-1!==t.indexOf(".")&&!String(e.Endpoint).startsWith("http:")||t.toLowerCase()!==t||t.length<3)&&(e.ForcePathStyle=!0);return e.DisableMultiRegionAccessPoints&&(e.disableMultiRegionAccessPoints=!0,e.DisableMRAP=!0),e})(r),r};const fn=e=>{if("string"==typeof e)return fn(new URL(e));const{hostname:t,pathname:n,port:r,protocol:o,search:s}=e;let i;return s&&(i=function(e){const t={};if(e=e.replace(/^\?/,""))for(const n of e.split("&")){let[e,r=null]=n.split("=");e=decodeURIComponent(e),r&&(r=decodeURIComponent(r)),e in t?Array.isArray(t[e])?t[e].push(r):t[e]=[t[e],r]:t[e]=r}return t}(s)),{hostname:t,port:r?parseInt(r):void 0,protocol:o,path:n,query:i}},hn=({config:e,instructions:t})=>(n,r)=>async o=>{const s=await(async(e,t,n,r)=>{const o=await pn(e,t,n);if("function"!=typeof n.endpointProvider)throw new Error("config.endpointProvider is not set.");return n.endpointProvider(o,r)})(o.input,{getEndpointParameterInstructions:()=>t},{...e},r);r.endpointV2=s,r.authSchemes=s.properties?.authSchemes;const i=r.authSchemes?.[0];return i&&(r.signing_region=i.signingRegion,r.signing_service=i.signingName),n({...o})},gn={name:"deserializerMiddleware",step:"deserialize",tags:["DESERIALIZER"],override:!0},mn={name:"serializerMiddleware",step:"serialize",tags:["SERIALIZER"],override:!0};function yn(e,t,n){return{applyToStack:r=>{r.add(((e,t)=>(n,r)=>async r=>{const{response:o}=await n(r);try{return{response:o,output:await t(o,e)}}catch(e){if(Object.defineProperty(e,"$response",{value:o}),!("$metadata"in e)){const t="Deserialization error: to see the raw response, inspect the hidden field {error}.$response on this object.";e.message+="\n  "+t}throw e}})(e,n),gn),r.add(((e,t)=>(n,r)=>async o=>{const s=r.endpointV2?.url&&e.urlParser?async()=>e.urlParser(r.endpointV2.url):e.endpoint;if(!s)throw new Error("No valid endpoint provider available.");const i=await t(o.input,{...e,endpoint:s});return n({...o,request:i})})(e,t),mn)}}}const wn={step:"serialize",tags:["ENDPOINT_PARAMETERS","ENDPOINT_V2","ENDPOINT"],name:"endpointV2Middleware",override:!0,relation:"before",toMiddleware:mn.name},bn=(e,t)=>({applyToStack:n=>{n.addRelativeTo(hn({config:e,instructions:t}),wn)}}),vn=e=>{const t=e.tls??!0,{endpoint:n}=e,r=null!=n?async()=>(e=>"object"==typeof e?"url"in e?fn(e.url):e:fn(e))(await ye(n)()):void 0,o=!!n;return{...e,endpoint:r,tls:t,isCustomEndpoint:o,useDualstackEndpoint:ye(e.useDualstackEndpoint??!1),useFipsEndpoint:ye(e.useFipsEndpoint??!1)}};var En;!function(e){e.STANDARD="standard",e.ADAPTIVE="adaptive"}(En||(En={}));const xn=En.STANDARD,Sn=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException","TransactionInProgressException"],In=["TimeoutError","RequestTimeout","RequestTimeoutException"],An=[500,502,503,504],Pn=["ECONNRESET","ECONNREFUSED","EPIPE","ETIMEDOUT"],Tn=e=>429===e.$metadata?.httpStatusCode||Sn.includes(e.name)||1==e.$retryable?.throttling,Cn=e=>In.includes(e.name)||Pn.includes(e?.code||"")||An.includes(e.$metadata?.httpStatusCode||0);class kn{constructor(e){this.currentCapacity=0,this.enabled=!1,this.lastMaxRate=0,this.measuredTxRate=0,this.requestCount=0,this.lastTimestamp=0,this.timeWindow=0,this.beta=e?.beta??.7,this.minCapacity=e?.minCapacity??1,this.minFillRate=e?.minFillRate??.5,this.scaleConstant=e?.scaleConstant??.4,this.smooth=e?.smooth??.8;const t=this.getCurrentTimeInSeconds();this.lastThrottleTime=t,this.lastTxRateBucket=Math.floor(this.getCurrentTimeInSeconds()),this.fillRate=this.minFillRate,this.maxCapacity=this.minCapacity}getCurrentTimeInSeconds(){return Date.now()/1e3}async getSendToken(){return this.acquireTokenBucket(1)}async acquireTokenBucket(e){if(this.enabled){if(this.refillTokenBucket(),e>this.currentCapacity){const t=(e-this.currentCapacity)/this.fillRate*1e3;await new Promise((e=>setTimeout(e,t)))}this.currentCapacity=this.currentCapacity-e}}refillTokenBucket(){const e=this.getCurrentTimeInSeconds();if(!this.lastTimestamp)return void(this.lastTimestamp=e);const t=(e-this.lastTimestamp)*this.fillRate;this.currentCapacity=Math.min(this.maxCapacity,this.currentCapacity+t),this.lastTimestamp=e}updateClientSendingRate(e){let t;if(this.updateMeasuredRate(),Tn(e)){const e=this.enabled?Math.min(this.measuredTxRate,this.fillRate):this.measuredTxRate;this.lastMaxRate=e,this.calculateTimeWindow(),this.lastThrottleTime=this.getCurrentTimeInSeconds(),t=this.cubicThrottle(e),this.enableTokenBucket()}else this.calculateTimeWindow(),t=this.cubicSuccess(this.getCurrentTimeInSeconds());const n=Math.min(t,2*this.measuredTxRate);this.updateTokenBucketRate(n)}calculateTimeWindow(){this.timeWindow=this.getPrecise(Math.pow(this.lastMaxRate*(1-this.beta)/this.scaleConstant,1/3))}cubicThrottle(e){return this.getPrecise(e*this.beta)}cubicSuccess(e){return this.getPrecise(this.scaleConstant*Math.pow(e-this.lastThrottleTime-this.timeWindow,3)+this.lastMaxRate)}enableTokenBucket(){this.enabled=!0}updateTokenBucketRate(e){this.refillTokenBucket(),this.fillRate=Math.max(e,this.minFillRate),this.maxCapacity=Math.max(e,this.minCapacity),this.currentCapacity=Math.min(this.currentCapacity,this.maxCapacity)}updateMeasuredRate(){const e=this.getCurrentTimeInSeconds(),t=Math.floor(2*e)/2;if(this.requestCount++,t>this.lastTxRateBucket){const e=this.requestCount/(t-this.lastTxRateBucket);this.measuredTxRate=this.getPrecise(e*this.smooth+this.measuredTxRate*(1-this.smooth)),this.requestCount=0,this.lastTxRateBucket=t}}getPrecise(e){return parseFloat(e.toFixed(8))}}const On=({retryDelay:e,retryCount:t,retryCost:n})=>({getRetryCount:()=>t,getRetryDelay:()=>Math.min(2e4,e),getRetryCost:()=>n});class _n{constructor(e){this.maxAttempts=e,this.mode=En.STANDARD,this.capacity=500,this.retryBackoffStrategy=(()=>{let e=100;return{computeNextBackoffDelay:t=>Math.floor(Math.min(2e4,Math.random()*2**t*e)),setDelayBase:t=>{e=t}}})(),this.maxAttemptsProvider="function"==typeof e?e:async()=>e}async acquireInitialRetryToken(e){return On({retryDelay:100,retryCount:0})}async refreshRetryTokenForRetry(e,t){const n=await this.getMaxAttempts();if(this.shouldRetry(e,t,n)){const n=t.errorType;this.retryBackoffStrategy.setDelayBase("THROTTLING"===n?500:100);const r=this.retryBackoffStrategy.computeNextBackoffDelay(e.getRetryCount()),o=t.retryAfterHint?Math.max(t.retryAfterHint.getTime()-Date.now()||0,r):r,s=this.getCapacityCost(n);return this.capacity-=s,On({retryDelay:o,retryCount:e.getRetryCount()+1,retryCost:s})}throw new Error("No retry token available")}recordSuccess(e){this.capacity=Math.max(500,this.capacity+(e.getRetryCost()??1))}getCapacity(){return this.capacity}async getMaxAttempts(){try{return await this.maxAttemptsProvider()}catch(e){return console.warn("Max attempts provider could not resolve. Using default of 3"),3}}shouldRetry(e,t,n){return e.getRetryCount()+1<n&&this.capacity>=this.getCapacityCost(t.errorType)&&this.isRetryableError(t.errorType)}getCapacityCost(e){return"TRANSIENT"===e?10:5}isRetryableError(e){return"THROTTLING"===e||"TRANSIENT"===e}}class Rn{constructor(e,t){this.maxAttemptsProvider=e,this.mode=En.ADAPTIVE;const{rateLimiter:n}=t??{};this.rateLimiter=n??new kn,this.standardRetryStrategy=new _n(e)}async acquireInitialRetryToken(e){return await this.rateLimiter.getSendToken(),this.standardRetryStrategy.acquireInitialRetryToken(e)}async refreshRetryTokenForRetry(e,t){return this.rateLimiter.updateClientSendingRate(t),this.standardRetryStrategy.refreshRetryTokenForRetry(e,t)}recordSuccess(e){this.rateLimiter.updateClientSendingRate({}),this.standardRetryStrategy.recordSuccess(e)}}const $n=new Uint8Array(256);let Nn=$n.length;function Dn(){return Nn>$n.length-16&&(t.randomFillSync($n),Nn=0),$n.slice(Nn,Nn+=16)}var jn=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;const Un=[];for(let e=0;e<256;++e)Un.push((e+256).toString(16).substr(1));function Fn(e,t=0){const n=(Un[e[t+0]]+Un[e[t+1]]+Un[e[t+2]]+Un[e[t+3]]+"-"+Un[e[t+4]]+Un[e[t+5]]+"-"+Un[e[t+6]]+Un[e[t+7]]+"-"+Un[e[t+8]]+Un[e[t+9]]+"-"+Un[e[t+10]]+Un[e[t+11]]+Un[e[t+12]]+Un[e[t+13]]+Un[e[t+14]]+Un[e[t+15]]).toLowerCase();if(!function(e){return"string"==typeof e&&jn.test(e)}(n))throw TypeError("Stringified UUID is invalid");return n}function Mn(e,t,n){const r=(e=e||{}).random||(e.rng||Dn)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return Fn(r)}const Ln="AWS_MAX_ATTEMPTS",zn="max_attempts",qn={environmentVariableSelector:e=>{const t=e[Ln];if(!t)return;const n=parseInt(t);if(Number.isNaN(n))throw new Error(`Environment variable ${Ln} mast be a number, got "${t}"`);return n},configFileSelector:e=>{const t=e[zn];if(!t)return;const n=parseInt(t);if(Number.isNaN(n))throw new Error(`Shared config file entry ${zn} mast be a number, got "${t}"`);return n},default:3},Bn=e=>{const{retryStrategy:t}=e,n=ye(e.maxAttempts??3);return{...e,maxAttempts:n,retryStrategy:async()=>{if(t)return t;return await ye(e.retryMode)()===En.ADAPTIVE?new Rn(n):new _n(n)}}},Wn={environmentVariableSelector:e=>e.AWS_RETRY_MODE,configFileSelector:e=>e.retry_mode,default:xn},Vn=e=>void 0!==e.acquireInitialRetryToken&&void 0!==e.refreshRetryTokenForRetry&&void 0!==e.recordSuccess,Hn=e=>{const t={errorType:Kn(e)},n=Jn(e.$response);return n&&(t.retryAfterHint=n),t},Kn=e=>Tn(e)?"THROTTLING":Cn(e)?"TRANSIENT":(e=>{if(void 0!==e.$metadata?.httpStatusCode){const t=e.$metadata.httpStatusCode;return 500<=t&&t<=599&&!Cn(e)}return!1})(e)?"SERVER_ERROR":"CLIENT_ERROR",Gn={name:"retryMiddleware",tags:["RETRY"],step:"finalizeRequest",priority:"high",override:!0},Xn=e=>({applyToStack:t=>{t.add((e=>(t,n)=>async r=>{let o=await e.retryStrategy();const s=await e.maxAttempts();if(!Vn(o))return o?.mode&&(n.userAgent=[...n.userAgent||[],["cfg/retry-mode",o.mode]]),o.retry(t,r);{let e=await o.acquireInitialRetryToken(n.partition_id),a=new Error,c=0,u=0;const{request:d}=r;for(b.isInstance(d)&&(d.headers["amz-sdk-invocation-id"]=Mn());;)try{b.isInstance(d)&&(d.headers["amz-sdk-request"]=`attempt=${c+1}; max=${s}`);const{response:n,output:i}=await t(r);return o.recordSuccess(e),i.$metadata.attempts=c+1,i.$metadata.totalRetryDelay=u,{response:n,output:i}}catch(t){const n=Hn(t);a=(i=t)instanceof Error?i:i instanceof Object?Object.assign(new Error,i):"string"==typeof i?new Error(i):new Error(`AWS SDK error wrapper for ${i}`);try{e=await o.refreshRetryTokenForRetry(e,n)}catch(e){throw a.$metadata||(a.$metadata={}),a.$metadata.attempts=c+1,a.$metadata.totalRetryDelay=u,a}c=e.getRetryCount();const r=e.getRetryDelay();u+=r,await new Promise((e=>setTimeout(e,r)))}}var i})(e),Gn)}}),Jn=e=>{if(!v.isInstance(e))return;const t=Object.keys(e.headers).find((e=>"retry-after"===e.toLowerCase()));if(!t)return;const n=e.headers[t],r=Number(n);if(!Number.isNaN(r))return new Date(1e3*r);return new Date(n)};class Yn{trace(){}debug(){}info(){}warn(){}error(){}}const Zn=()=>{let e=[],t=[];const n=new Set,r=n=>(e.forEach((e=>{n.add(e.middleware,{...e})})),t.forEach((e=>{n.addRelativeTo(e.middleware,{...e})})),n),o=e=>{const t=[];return e.before.forEach((e=>{0===e.before.length&&0===e.after.length?t.push(e):t.push(...o(e))})),t.push(e),e.after.reverse().forEach((e=>{0===e.before.length&&0===e.after.length?t.push(e):t.push(...o(e))})),t},s=(n=!1)=>{const r=[],s=[],i={};e.forEach((e=>{const t={...e,before:[],after:[]};t.name&&(i[t.name]=t),r.push(t)})),t.forEach((e=>{const t={...e,before:[],after:[]};t.name&&(i[t.name]=t),s.push(t)})),s.forEach((e=>{if(e.toMiddleware){const t=i[e.toMiddleware];if(void 0===t){if(n)return;throw new Error(`${e.toMiddleware} is not found when adding ${e.name||"anonymous"} middleware ${e.relation} ${e.toMiddleware}`)}"after"===e.relation&&t.after.push(e),"before"===e.relation&&t.before.push(e)}}));const a=(c=r,c.sort(((e,t)=>Qn[t.step]-Qn[e.step]||er[t.priority||"normal"]-er[e.priority||"normal"]))).map(o).reduce(((e,t)=>(e.push(...t),e)),[]);var c;return a},i={add:(t,r={})=>{const{name:o,override:s}=r,i={step:"initialize",priority:"normal",middleware:t,...r};if(o){if(n.has(o)){if(!s)throw new Error(`Duplicate middleware name '${o}'`);const t=e.findIndex((e=>e.name===o)),n=e[t];if(n.step!==i.step||n.priority!==i.priority)throw new Error(`"${o}" middleware with ${n.priority} priority in ${n.step} step cannot be overridden by same-name middleware with ${i.priority} priority in ${i.step} step.`);e.splice(t,1)}n.add(o)}e.push(i)},addRelativeTo:(e,r)=>{const{name:o,override:s}=r,i={middleware:e,...r};if(o){if(n.has(o)){if(!s)throw new Error(`Duplicate middleware name '${o}'`);const e=t.findIndex((e=>e.name===o)),n=t[e];if(n.toMiddleware!==i.toMiddleware||n.relation!==i.relation)throw new Error(`"${o}" middleware ${n.relation} "${n.toMiddleware}" middleware cannot be overridden by same-name middleware ${i.relation} "${i.toMiddleware}" middleware.`);t.splice(e,1)}n.add(o)}t.push(i)},clone:()=>r(Zn()),use:e=>{e.applyToStack(i)},remove:r=>"string"==typeof r?(r=>{let o=!1;const s=e=>!e.name||e.name!==r||(o=!0,n.delete(r),!1);return e=e.filter(s),t=t.filter(s),o})(r):(r=>{let o=!1;const s=e=>e.middleware!==r||(o=!0,e.name&&n.delete(e.name),!1);return e=e.filter(s),t=t.filter(s),o})(r),removeByTag:r=>{let o=!1;const s=e=>{const{tags:t,name:s}=e;return!t||!t.includes(r)||(s&&n.delete(s),o=!0,!1)};return e=e.filter(s),t=t.filter(s),o},concat:e=>{const t=r(Zn());return t.use(e),t},applyToStack:r,identify:()=>s(!0).map((e=>e.name+": "+(e.tags||[]).join(","))),resolve:(e,t)=>{for(const n of s().map((e=>e.middleware)).reverse())e=n(e,t);return e}};return i},Qn={initialize:5,serialize:4,build:3,finalizeRequest:2,deserialize:1},er={high:3,normal:2,low:1};class tr{constructor(e){this.middlewareStack=Zn(),this.config=e}send(e,t,n){const r="function"!=typeof t?t:void 0,o="function"==typeof t?t:n,s=e.resolveMiddleware(this.middlewareStack,this.config,r);if(!o)return s(e).then((e=>e.output));s(e).then((e=>o(null,e.output)),(e=>o(e))).catch((()=>{}))}destroy(){this.config.requestHandler.destroy&&this.config.requestHandler.destroy()}}const nr=/^[A-Za-z0-9+/]*={0,2}$/,rr=e=>{if(3*e.length%4!=0)throw new TypeError("Incorrect padding on base64 string.");if(!nr.exec(e))throw new TypeError("Invalid base64 string.");const t=ve(e,"base64");return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)},or=e=>be(e.buffer,e.byteOffset,e.byteLength).toString("base64");class sr extends Uint8Array{static fromString(e,t="utf-8"){if("string"==typeof e)return function(e,t){return"base64"===t?sr.mutate(rr(e)):sr.mutate(Ee(e))}(e,t);throw new Error(`Unsupported conversion from ${typeof e} to Uint8ArrayBlobAdapter.`)}static mutate(e){return Object.setPrototypeOf(e,sr.prototype),e}transformToString(e="utf-8"){return function(e,t="utf-8"){return"base64"===t?or(e):Se(e)}(this,e)}}const ir=["ECONNRESET","EPIPE","ETIMEDOUT"],ar=e=>{const t={};for(const n of Object.keys(e)){const r=e[n];t[n]=Array.isArray(r)?r.join(","):r}return t};async function cr(e,t,r=1e3){const o=t.headers??{},s=o.Expect||o.expect;let i=-1,a=!1;"100-continue"===s&&await Promise.race([new Promise((e=>{i=Number(setTimeout(e,Math.max(1e3,r)))})),new Promise((t=>{e.on("continue",(()=>{clearTimeout(i),t()})),e.on("error",(()=>{a=!0,clearTimeout(i),t()}))}))]),a||function(e,t){t instanceof n.Readable?t.pipe(e):t?e.end(Buffer.from(t)):e.end()}(e,t.body)}class ur{constructor(e){this.metadata={handlerProtocol:"http/1.1"},this.configProvider=new Promise(((t,n)=>{"function"==typeof e?e().then((e=>{t(this.resolveDefaultConfig(e))})).catch(n):t(this.resolveDefaultConfig(e))}))}resolveDefaultConfig(e){const{requestTimeout:t,connectionTimeout:n,socketTimeout:s,httpAgent:i,httpsAgent:a}=e||{};return{connectionTimeout:n,requestTimeout:t??s,httpAgent:i||new r.Agent({keepAlive:true,maxSockets:50}),httpsAgent:a||new o.Agent({keepAlive:true,maxSockets:50})}}destroy(){this.config?.httpAgent?.destroy(),this.config?.httpsAgent?.destroy()}async handle(e,{abortSignal:t}={}){return this.config||(this.config=await this.configProvider),new Promise(((n,s)=>{let i;const a=async e=>{await i,s(e)};if(!this.config)throw new Error("Node HTTP request handler config is not resolved");if(t?.aborted){const e=new Error("Request aborted");return e.name="AbortError",void a(e)}const c="https:"===e.protocol,u=function(e){const t=[];for(let n of Object.keys(e).sort()){const r=e[n];if(n=We(n),Array.isArray(r))for(let e=0,o=r.length;e<o;e++)t.push(`${n}=${We(r[e])}`);else{let e=n;(r||"string"==typeof r)&&(e+=`=${We(r)}`),t.push(e)}}return t.join("&")}(e.query||{});let d;if(null!=e.username||null!=e.password){d=`${e.username??""}:${e.password??""}`}let l=e.path;u&&(l+=`?${u}`),e.fragment&&(l+=`#${e.fragment}`);const p={headers:e.headers,host:e.hostname,method:e.method,path:l,port:e.port,agent:c?this.config.httpsAgent:this.config.httpAgent,auth:d},f=(c?o.request:r.request)(p,(e=>{(async e=>{await i,n(e)})({response:new v({statusCode:e.statusCode||-1,reason:e.statusMessage,headers:ar(e.headers),body:e})})}));f.on("error",(e=>{ir.includes(e.code)?a(Object.assign(e,{name:"TimeoutError"})):a(e)})),((e,t,n=0)=>{if(!n)return;const r=setTimeout((()=>{e.destroy(),t(Object.assign(new Error(`Socket timed out without establishing a connection within ${n} ms`),{name:"TimeoutError"}))}),n);e.on("socket",(e=>{e.connecting?e.on("connect",(()=>{clearTimeout(r)})):clearTimeout(r)}))})(f,a,this.config.connectionTimeout),((e,t,n=0)=>{e.setTimeout(n,(()=>{e.destroy(),t(Object.assign(new Error(`Connection timed out after ${n} ms`),{name:"TimeoutError"}))}))})(f,a,this.config.requestTimeout),t&&(t.onabort=()=>{f.abort();const e=new Error("Request aborted");e.name="AbortError",a(e)});const h=p.agent;"object"==typeof h&&"keepAlive"in h&&((e,{keepAlive:t,keepAliveMsecs:n})=>{!0===t&&e.on("socket",(e=>{e.setKeepAlive(t,n||0)}))})(f,{keepAlive:h.keepAlive,keepAliveMsecs:h.keepAliveMsecs}),i=cr(f,e,this.config.requestTimeout).catch(s)}))}}class dr extends n.Writable{constructor(){super(...arguments),this.bufferedBytes=[]}_write(e,t,n){this.bufferedBytes.push(e),n()}}const lr=e=>new Promise(((t,n)=>{const r=new dr;e.pipe(r),e.on("error",(e=>{r.end(),n(e)})),r.on("error",n),r.on("finish",(function(){const e=new Uint8Array(Buffer.concat(this.bufferedBytes));t(e)}))})),pr=async(e=new Uint8Array,t)=>{if(e instanceof Uint8Array)return sr.mutate(e);if(!e)return sr.mutate(new Uint8Array);const n=t.streamCollector(e);return sr.mutate(await n)};class fr{constructor(){this.middlewareStack=Zn()}}const hr="***SensitiveInformation***",gr=Math.ceil(2**127*(2-2**-23)),mr=e=>{const t=(e=>{if(null!=e){if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return String(t)!==String(e)&&Rr.warn(_r(`Expected number but observed string: ${e}`)),t}if("number"==typeof e)return e;throw new TypeError(`Expected number, got ${typeof e}: ${e}`)}})(e);if(void 0!==t&&!Number.isNaN(t)&&t!==1/0&&t!==-1/0&&Math.abs(t)>gr)throw new TypeError(`Expected 32-bit float, got ${e}`);return t},yr=e=>{if(null!=e){if(Number.isInteger(e)&&!Number.isNaN(e))return e;throw new TypeError(`Expected integer, got ${typeof e}: ${e}`)}},wr=e=>Er(e,32),br=e=>Er(e,16),vr=e=>Er(e,8),Er=(e,t)=>{const n=yr(e);if(void 0!==n&&xr(n,t)!==n)throw new TypeError(`Expected ${t}-bit integer, got ${e}`);return n},xr=(e,t)=>{switch(t){case 32:return Int32Array.of(e)[0];case 16:return Int16Array.of(e)[0];case 8:return Int8Array.of(e)[0]}},Sr=(e,t)=>{if(null==e){if(t)throw new TypeError(`Expected a non-null value for ${t}`);throw new TypeError("Expected a non-null value")}return e},Ir=e=>{if(null==e)return;if("object"==typeof e&&!Array.isArray(e))return e;const t=Array.isArray(e)?"array":typeof e;throw new TypeError(`Expected object, got ${t}: ${e}`)},Ar=e=>{if(null!=e){if("string"==typeof e)return e;if(["boolean","number","bigint"].includes(typeof e))return Rr.warn(_r(`Expected string, got ${typeof e}: ${e}`)),String(e);throw new TypeError(`Expected string, got ${typeof e}: ${e}`)}},Pr=/(-?(?:0|[1-9]\d*)(?:\.\d+)?(?:[eE][+-]?\d+)?)|(-?Infinity)|(NaN)/g,Tr=e=>{const t=e.match(Pr);if(null===t||t[0].length!==e.length)throw new TypeError("Expected real number, got implicit NaN");return parseFloat(e)},Cr=e=>"string"==typeof e?kr(e):mr(e),kr=e=>{switch(e){case"NaN":return NaN;case"Infinity":return 1/0;case"-Infinity":return-1/0;default:throw new Error(`Unable to parse float value: ${e}`)}},Or=e=>wr("string"==typeof e?Tr(e):e),_r=e=>String(new TypeError(e).stack||e).split("\n").slice(0,5).filter((e=>!e.includes("stackTraceWarning"))).join("\n"),Rr={warn:console.warn},$r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Nr=new RegExp(/^(\d{4})-(\d{2})-(\d{2})[tT](\d{2}):(\d{2}):(\d{2})(?:\.(\d+))?(([-+]\d{2}\:\d{2})|[zZ])$/),Dr=e=>{if(null==e)return;if("string"!=typeof e)throw new TypeError("RFC-3339 date-times must be expressed as strings");const t=Nr.exec(e);if(!t)throw new TypeError("Invalid RFC-3339 date-time value");const[n,r,o,s,i,a,c,u,d]=t,l=(e=>br("string"==typeof e?Tr(e):e))(Br(r)),p=Lr(o,"month",1,12),f=Lr(s,"day",1,31),h=jr(l,p,f,{hours:i,minutes:a,seconds:c,fractionalMilliseconds:u});return"Z"!=d.toUpperCase()&&h.setTime(h.getTime()-qr(d)),h},jr=(e,t,n,r)=>{const o=t-1;return Fr(e,o,n),new Date(Date.UTC(e,o,n,Lr(r.hours,"hour",0,23),Lr(r.minutes,"minute",0,59),Lr(r.seconds,"seconds",0,60),zr(r.fractionalMilliseconds)))},Ur=[31,28,31,30,31,30,31,31,30,31,30,31],Fr=(e,t,n)=>{let r=Ur[t];if(1===t&&Mr(e)&&(r=29),n>r)throw new TypeError(`Invalid day for ${$r[t]} in ${e}: ${n}`)},Mr=e=>e%4==0&&(e%100!=0||e%400==0),Lr=(e,t,n,r)=>{const o=(e=>vr("string"==typeof e?Tr(e):e))(Br(e));if(o<n||o>r)throw new TypeError(`${t} must be between ${n} and ${r}, inclusive`);return o},zr=e=>null==e?0:1e3*(e=>mr("string"==typeof e?Tr(e):e))("0."+e),qr=e=>{const t=e[0];let n=1;if("+"==t)n=1;else{if("-"!=t)throw new TypeError(`Offset direction, ${t}, must be "+" or "-"`);n=-1}return n*(60*Number(e.substring(1,3))+Number(e.substring(4,6)))*60*1e3},Br=e=>{let t=0;for(;t<e.length-1&&"0"===e.charAt(t);)t++;return 0===t?e:e.slice(t)};class Wr extends Error{constructor(e){super(e.message),Object.setPrototypeOf(this,Wr.prototype),this.name=e.name,this.$fault=e.$fault,this.$metadata=e.$metadata}}const Vr=(e,t={})=>{Object.entries(t).filter((([,e])=>void 0!==e)).forEach((([t,n])=>{null!=e[t]&&""!==e[t]||(e[t]=n)}));const n=e.message||e.Message||"UnknownError";return e.message=n,delete e.Message,e},Hr=e=>({output:t,parsedBody:n,errorCode:r})=>{(({output:e,parsedBody:t,exceptionCtor:n,errorCode:r})=>{const o=Kr(e),s=o.httpStatusCode?o.httpStatusCode+"":void 0,i=new n({name:t?.code||t?.Code||r||s||"UnknownError",$fault:"client",$metadata:o});throw Vr(i,t)})({output:t,parsedBody:n,exceptionCtor:e,errorCode:r})},Kr=e=>({httpStatusCode:e.statusCode,requestId:e.headers["x-amzn-requestid"]??e.headers["x-amzn-request-id"]??e.headers["x-amz-request-id"],extendedRequestId:e.headers["x-amz-id-2"],cfId:e.headers["x-amz-cf-id"]}),Gr=e=>{switch(e){case"standard":case"cross-region":return{retryMode:"standard",connectionTimeout:3100};case"in-region":return{retryMode:"standard",connectionTimeout:1100};case"mobile":return{retryMode:"standard",connectionTimeout:3e4};default:return{}}};let Xr=!1;const Jr=e=>{e&&!Xr&&parseInt(e.substring(1,e.indexOf(".")))<14&&(Xr=!0)},Yr=e=>{const t=[];return void 0!==e.sha256&&t.push({algorithmId:()=>m.SHA256,checksumConstructor:()=>e.sha256}),null!=e.md5&&t.push({algorithmId:()=>m.MD5,checksumConstructor:()=>e.md5}),{_checksumAlgorithms:t,addChecksumAlgorithm(e){this._checksumAlgorithms.push(e)},checksumAlgorithms(){return this._checksumAlgorithms}}},Zr=e=>{const t={};return e.checksumAlgorithms().forEach((e=>{t[e.algorithmId()]=e.checksumConstructor()})),t},Qr=e=>({...Yr(e)}),eo=e=>({...Zr(e)});function to(e){return encodeURIComponent(e).replace(/[!'()*]/g,(function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()}))}const no=e=>{const t="#text";for(const n in e)e.hasOwnProperty(n)&&void 0!==e[n][t]?e[n]=e[n][t]:"object"==typeof e[n]&&null!==e[n]&&(e[n]=no(e[n]));return e},ro=function(){const e=Object.getPrototypeOf(this).constructor,t=new(Function.bind.apply(String,[null,...arguments]));return Object.setPrototypeOf(t,e.prototype),t};function oo(e,t,n){let r,o,s;if(void 0===t&&void 0===n)r={},s=e;else{if(r=e,"function"==typeof t)return o=t,s=n,io(r,o,s);s=t}for(const e of Object.keys(s))Array.isArray(s[e])?ao(r,null,s,e):r[e]=s[e];return r}ro.prototype=Object.create(String.prototype,{constructor:{value:ro,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf(ro,String);const so=(e,t)=>{const n={};for(const r in t)ao(n,e,t,r);return n},io=(e,t,n)=>oo(e,Object.entries(n).reduce(((e,[n,r])=>(Array.isArray(r)?e[n]=r:e[n]="function"==typeof r?[t,r()]:[t,r],e)),{})),ao=(e,t,n,r)=>{if(null!==t){let o=n[r];"function"==typeof o&&(o=[,o]);const[s=co,i=uo,a=r]=o;return void(("function"==typeof s&&s(t[a])||"function"!=typeof s&&s)&&(e[r]=i(t[a])))}let[o,s]=n[r];if("function"==typeof s){let t;const n=void 0===o&&null!=(t=s()),i="function"==typeof o&&!!o(void 0)||"function"!=typeof o&&!!o;n?e[r]=t:i&&(e[r]=s())}else{const t=void 0===o&&null!=s,n="function"==typeof o&&!!o(s)||"function"!=typeof o&&!!o;(t||n)&&(e[r]=s)}},co=e=>null!=e,uo=e=>e,lo=e=>{if(e!=e)return"NaN";switch(e){case 1/0:return"Infinity";case-1/0:return"-Infinity";default:return e}},po=e=>{if(null==e)return{};if(Array.isArray(e))return e.filter((e=>null!=e));if("object"==typeof e){const t={};for(const n of Object.keys(e))null!=e[n]&&(t[n]=po(e[n]));return t}return e};var fo="3.398.0";var ho="3.398.0";class go extends Wr{constructor(e){super(e),Object.setPrototypeOf(this,go.prototype)}}let mo=class e extends go{constructor(t){super({name:"ExpiredTokenException",$fault:"client",...t}),this.name="ExpiredTokenException",this.$fault="client",Object.setPrototypeOf(this,e.prototype)}};class yo extends go{constructor(e){super({name:"MalformedPolicyDocumentException",$fault:"client",...e}),this.name="MalformedPolicyDocumentException",this.$fault="client",Object.setPrototypeOf(this,yo.prototype)}}class wo extends go{constructor(e){super({name:"PackedPolicyTooLargeException",$fault:"client",...e}),this.name="PackedPolicyTooLargeException",this.$fault="client",Object.setPrototypeOf(this,wo.prototype)}}class bo extends go{constructor(e){super({name:"RegionDisabledException",$fault:"client",...e}),this.name="RegionDisabledException",this.$fault="client",Object.setPrototypeOf(this,bo.prototype)}}class vo extends go{constructor(e){super({name:"IDPRejectedClaimException",$fault:"client",...e}),this.name="IDPRejectedClaimException",this.$fault="client",Object.setPrototypeOf(this,vo.prototype)}}class Eo extends go{constructor(e){super({name:"InvalidIdentityTokenException",$fault:"client",...e}),this.name="InvalidIdentityTokenException",this.$fault="client",Object.setPrototypeOf(this,Eo.prototype)}}class xo extends go{constructor(e){super({name:"IDPCommunicationErrorException",$fault:"client",...e}),this.name="IDPCommunicationErrorException",this.$fault="client",Object.setPrototypeOf(this,xo.prototype)}}const So=e=>({...e,...e.SecretAccessKey&&{SecretAccessKey:hr}}),Io=e=>({...e,...e.Credentials&&{Credentials:So(e.Credentials)}}),Ao=e=>({...e,...e.WebIdentityToken&&{WebIdentityToken:hr}}),Po=e=>({...e,...e.Credentials&&{Credentials:So(e.Credentials)}});var To={},Co={};!function(e){const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",n="["+t+"]["+(t+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040")+"]*",r=new RegExp("^"+n+"$");e.isExist=function(e){return void 0!==e},e.isEmptyObject=function(e){return 0===Object.keys(e).length},e.merge=function(e,t,n){if(t){const r=Object.keys(t),o=r.length;for(let s=0;s<o;s++)e[r[s]]="strict"===n?[t[r[s]]]:t[r[s]]}},e.getValue=function(t){return e.isExist(t)?t:""},e.isName=function(e){const t=r.exec(e);return!(null==t)},e.getAllMatches=function(e,t){const n=[];let r=t.exec(e);for(;r;){const o=[];o.startIndex=t.lastIndex-r[0].length;const s=r.length;for(let e=0;e<s;e++)o.push(r[e]);n.push(o),r=t.exec(e)}return n},e.nameRegexp=n}(Co);const ko=Co,Oo={allowBooleanAttributes:!1,unpairedTags:[]};function _o(e){return" "===e||"\t"===e||"\n"===e||"\r"===e}function Ro(e,t){const n=t;for(;t<e.length;t++)if("?"!=e[t]&&" "!=e[t]);else{const r=e.substr(n,t-n);if(t>5&&"xml"===r)return Lo("InvalidXml","XML declaration allowed only at the start of the document.",qo(e,t));if("?"==e[t]&&">"==e[t+1]){t++;break}}return t}function $o(e,t){if(e.length>t+5&&"-"===e[t+1]&&"-"===e[t+2]){for(t+=3;t<e.length;t++)if("-"===e[t]&&"-"===e[t+1]&&">"===e[t+2]){t+=2;break}}else if(e.length>t+8&&"D"===e[t+1]&&"O"===e[t+2]&&"C"===e[t+3]&&"T"===e[t+4]&&"Y"===e[t+5]&&"P"===e[t+6]&&"E"===e[t+7]){let n=1;for(t+=8;t<e.length;t++)if("<"===e[t])n++;else if(">"===e[t]&&(n--,0===n))break}else if(e.length>t+9&&"["===e[t+1]&&"C"===e[t+2]&&"D"===e[t+3]&&"A"===e[t+4]&&"T"===e[t+5]&&"A"===e[t+6]&&"["===e[t+7])for(t+=8;t<e.length;t++)if("]"===e[t]&&"]"===e[t+1]&&">"===e[t+2]){t+=2;break}return t}To.validate=function(e,t){t=Object.assign({},Oo,t);const n=[];let r=!1,o=!1;"\ufeff"===e[0]&&(e=e.substr(1));for(let i=0;i<e.length;i++)if("<"===e[i]&&"?"===e[i+1]){if(i+=2,i=Ro(e,i),i.err)return i}else{if("<"!==e[i]){if(_o(e[i]))continue;return Lo("InvalidChar","char '"+e[i]+"' is not expected.",qo(e,i))}{let a=i;if(i++,"!"===e[i]){i=$o(e,i);continue}{let c=!1;"/"===e[i]&&(c=!0,i++);let u="";for(;i<e.length&&">"!==e[i]&&" "!==e[i]&&"\t"!==e[i]&&"\n"!==e[i]&&"\r"!==e[i];i++)u+=e[i];if(u=u.trim(),"/"===u[u.length-1]&&(u=u.substring(0,u.length-1),i--),s=u,!ko.isName(s)){let t;return t=0===u.trim().length?"Invalid space after '<'.":"Tag '"+u+"' is an invalid name.",Lo("InvalidTag",t,qo(e,i))}const d=jo(e,i);if(!1===d)return Lo("InvalidAttr","Attributes for '"+u+"' have open quote.",qo(e,i));let l=d.value;if(i=d.index,"/"===l[l.length-1]){const n=i-l.length;l=l.substring(0,l.length-1);const o=Fo(l,t);if(!0!==o)return Lo(o.err.code,o.err.msg,qo(e,n+o.err.line));r=!0}else if(c){if(!d.tagClosed)return Lo("InvalidTag","Closing tag '"+u+"' doesn't have proper closing.",qo(e,i));if(l.trim().length>0)return Lo("InvalidTag","Closing tag '"+u+"' can't have attributes or invalid starting.",qo(e,a));{const t=n.pop();if(u!==t.tagName){let n=qo(e,t.tagStartPos);return Lo("InvalidTag","Expected closing tag '"+t.tagName+"' (opened in line "+n.line+", col "+n.col+") instead of closing tag '"+u+"'.",qo(e,a))}0==n.length&&(o=!0)}}else{const s=Fo(l,t);if(!0!==s)return Lo(s.err.code,s.err.msg,qo(e,i-l.length+s.err.line));if(!0===o)return Lo("InvalidXml","Multiple possible root nodes found.",qo(e,i));-1!==t.unpairedTags.indexOf(u)||n.push({tagName:u,tagStartPos:a}),r=!0}for(i++;i<e.length;i++)if("<"===e[i]){if("!"===e[i+1]){i++,i=$o(e,i);continue}if("?"!==e[i+1])break;if(i=Ro(e,++i),i.err)return i}else if("&"===e[i]){const t=Mo(e,i);if(-1==t)return Lo("InvalidChar","char '&' is not expected.",qo(e,i));i=t}else if(!0===o&&!_o(e[i]))return Lo("InvalidXml","Extra text at the end",qo(e,i));"<"===e[i]&&i--}}}var s;return r?1==n.length?Lo("InvalidTag","Unclosed tag '"+n[0].tagName+"'.",qo(e,n[0].tagStartPos)):!(n.length>0)||Lo("InvalidXml","Invalid '"+JSON.stringify(n.map((e=>e.tagName)),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):Lo("InvalidXml","Start tag expected.",1)};const No='"',Do="'";function jo(e,t){let n="",r="",o=!1;for(;t<e.length;t++){if(e[t]===No||e[t]===Do)""===r?r=e[t]:r!==e[t]||(r="");else if(">"===e[t]&&""===r){o=!0;break}n+=e[t]}return""===r&&{value:n,index:t,tagClosed:o}}const Uo=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function Fo(e,t){const n=ko.getAllMatches(e,Uo),r={};for(let e=0;e<n.length;e++){if(0===n[e][1].length)return Lo("InvalidAttr","Attribute '"+n[e][2]+"' has no space in starting.",Bo(n[e]));if(void 0!==n[e][3]&&void 0===n[e][4])return Lo("InvalidAttr","Attribute '"+n[e][2]+"' is without value.",Bo(n[e]));if(void 0===n[e][3]&&!t.allowBooleanAttributes)return Lo("InvalidAttr","boolean attribute '"+n[e][2]+"' is not allowed.",Bo(n[e]));const o=n[e][2];if(!zo(o))return Lo("InvalidAttr","Attribute '"+o+"' is an invalid name.",Bo(n[e]));if(r.hasOwnProperty(o))return Lo("InvalidAttr","Attribute '"+o+"' is repeated.",Bo(n[e]));r[o]=1}return!0}function Mo(e,t){if(";"===e[++t])return-1;if("#"===e[t])return function(e,t){let n=/\d/;for("x"===e[t]&&(t++,n=/[\da-fA-F]/);t<e.length;t++){if(";"===e[t])return t;if(!e[t].match(n))break}return-1}(e,++t);let n=0;for(;t<e.length;t++,n++)if(!(e[t].match(/\w/)&&n<20)){if(";"===e[t])break;return-1}return t}function Lo(e,t,n){return{err:{code:e,msg:t,line:n.line||n,col:n.col}}}function zo(e){return ko.isName(e)}function qo(e,t){const n=e.substring(0,t).split(/\r?\n/);return{line:n.length,col:n[n.length-1].length+1}}function Bo(e){return e.startIndex+e[1].length}var Wo={};const Vo={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(e,t,n){return e}};Wo.buildOptions=function(e){return Object.assign({},Vo,e)},Wo.defaultOptions=Vo;var Ho=class{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){"__proto__"===e&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e){"__proto__"===e.tagname&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}};const Ko=Co;function Go(e,t){let n="";for(;t<e.length&&"'"!==e[t]&&'"'!==e[t];t++)n+=e[t];if(n=n.trim(),-1!==n.indexOf(" "))throw new Error("External entites are not supported");const r=e[t++];let o="";for(;t<e.length&&e[t]!==r;t++)o+=e[t];return[n,o,t]}function Xo(e,t){return"!"===e[t+1]&&"-"===e[t+2]&&"-"===e[t+3]}function Jo(e,t){return"!"===e[t+1]&&"E"===e[t+2]&&"N"===e[t+3]&&"T"===e[t+4]&&"I"===e[t+5]&&"T"===e[t+6]&&"Y"===e[t+7]}function Yo(e,t){return"!"===e[t+1]&&"E"===e[t+2]&&"L"===e[t+3]&&"E"===e[t+4]&&"M"===e[t+5]&&"E"===e[t+6]&&"N"===e[t+7]&&"T"===e[t+8]}function Zo(e,t){return"!"===e[t+1]&&"A"===e[t+2]&&"T"===e[t+3]&&"T"===e[t+4]&&"L"===e[t+5]&&"I"===e[t+6]&&"S"===e[t+7]&&"T"===e[t+8]}function Qo(e,t){return"!"===e[t+1]&&"N"===e[t+2]&&"O"===e[t+3]&&"T"===e[t+4]&&"A"===e[t+5]&&"T"===e[t+6]&&"I"===e[t+7]&&"O"===e[t+8]&&"N"===e[t+9]}function es(e){if(Ko.isName(e))return e;throw new Error(`Invalid entity name ${e}`)}var ts=function(e,t){const n={};if("O"!==e[t+3]||"C"!==e[t+4]||"T"!==e[t+5]||"Y"!==e[t+6]||"P"!==e[t+7]||"E"!==e[t+8])throw new Error("Invalid Tag instead of DOCTYPE");{t+=9;let r=1,o=!1,s=!1,i="";for(;t<e.length;t++)if("<"!==e[t]||s)if(">"===e[t]){if(s?"-"===e[t-1]&&"-"===e[t-2]&&(s=!1,r--):r--,0===r)break}else"["===e[t]?o=!0:i+=e[t];else{if(o&&Jo(e,t))t+=7,[entityName,val,t]=Go(e,t+1),-1===val.indexOf("&")&&(n[es(entityName)]={regx:RegExp(`&${entityName};`,"g"),val:val});else if(o&&Yo(e,t))t+=8;else if(o&&Zo(e,t))t+=8;else if(o&&Qo(e,t))t+=9;else{if(!Xo)throw new Error("Invalid DOCTYPE");s=!0}r++,i=""}if(0!==r)throw new Error("Unclosed DOCTYPE")}return{entities:n,i:t}};const ns=/^[-+]?0x[a-fA-F0-9]+$/,rs=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const os={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};const ss=Co,is=Ho,as=ts,cs=function(e,t={}){if(t=Object.assign({},os,t),!e||"string"!=typeof e)return e;let n=e.trim();if(void 0!==t.skipLike&&t.skipLike.test(n))return e;if(t.hex&&ns.test(n))return Number.parseInt(n,16);{const r=rs.exec(n);if(r){const o=r[1],s=r[2];let i=function(e){if(e&&-1!==e.indexOf("."))return"."===(e=e.replace(/0+$/,""))?e="0":"."===e[0]?e="0"+e:"."===e[e.length-1]&&(e=e.substr(0,e.length-1)),e;return e}(r[3]);const a=r[4]||r[6];if(!t.leadingZeros&&s.length>0&&o&&"."!==n[2])return e;if(!t.leadingZeros&&s.length>0&&!o&&"."!==n[1])return e;{const r=Number(n),c=""+r;return-1!==c.search(/[eE]/)||a?t.eNotation?r:e:-1!==n.indexOf(".")?"0"===c&&""===i||c===i||o&&c==="-"+i?r:e:s?i===c||o+i===c?r:e:n===c||n===o+c?r:e}}return e}};"<((!\\[CDATA\\[([\\s\\S]*?)(]]>))|((NAME:)?(NAME))([^>]*)>|((\\/)(NAME)\\s*>))([^<]*)".replace(/NAME/g,ss.nameRegexp);function us(e){const t=Object.keys(e);for(let n=0;n<t.length;n++){const r=t[n];this.lastEntities[r]={regex:new RegExp("&"+r+";","g"),val:e[r]}}}function ds(e,t,n,r,o,s,i){if(void 0!==e&&(this.options.trimValues&&!r&&(e=e.trim()),e.length>0)){i||(e=this.replaceEntitiesValue(e));const r=this.options.tagValueProcessor(t,e,n,o,s);if(null==r)return e;if(typeof r!=typeof e||r!==e)return r;if(this.options.trimValues)return xs(e,this.options.parseTagValue,this.options.numberParseOptions);return e.trim()===e?xs(e,this.options.parseTagValue,this.options.numberParseOptions):e}}function ls(e){if(this.options.removeNSPrefix){const t=e.split(":"),n="/"===e.charAt(0)?"/":"";if("xmlns"===t[0])return"";2===t.length&&(e=n+t[1])}return e}const ps=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function fs(e,t,n){if(!this.options.ignoreAttributes&&"string"==typeof e){const n=ss.getAllMatches(e,ps),r=n.length,o={};for(let e=0;e<r;e++){const r=this.resolveNameSpace(n[e][1]);let s=n[e][4],i=this.options.attributeNamePrefix+r;if(r.length)if(this.options.transformAttributeName&&(i=this.options.transformAttributeName(i)),"__proto__"===i&&(i="#__proto__"),void 0!==s){this.options.trimValues&&(s=s.trim()),s=this.replaceEntitiesValue(s);const e=this.options.attributeValueProcessor(r,s,t);o[i]=null==e?s:typeof e!=typeof s||e!==s?e:xs(s,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(o[i]=!0)}if(!Object.keys(o).length)return;if(this.options.attributesGroupName){const e={};return e[this.options.attributesGroupName]=o,e}return o}}const hs=function(e){e=e.replace(/\r\n?/g,"\n");const t=new is("!xml");let n=t,r="",o="";for(let s=0;s<e.length;s++){if("<"===e[s])if("/"===e[s+1]){const t=bs(e,">",s,"Closing Tag is not closed.");let i=e.substring(s+2,t).trim();if(this.options.removeNSPrefix){const e=i.indexOf(":");-1!==e&&(i=i.substr(e+1))}this.options.transformTagName&&(i=this.options.transformTagName(i)),n&&(r=this.saveTextToParentTag(r,n,o));const a=o.substring(o.lastIndexOf(".")+1);if(i&&-1!==this.options.unpairedTags.indexOf(i))throw new Error(`Unpaired tag can not be used as closing tag: </${i}>`);let c=0;a&&-1!==this.options.unpairedTags.indexOf(a)?(c=o.lastIndexOf(".",o.lastIndexOf(".")-1),this.tagsNodeStack.pop()):c=o.lastIndexOf("."),o=o.substring(0,c),n=this.tagsNodeStack.pop(),r="",s=t}else if("?"===e[s+1]){let t=vs(e,s,!1,"?>");if(!t)throw new Error("Pi Tag is not closed.");if(r=this.saveTextToParentTag(r,n,o),this.options.ignoreDeclaration&&"?xml"===t.tagName||this.options.ignorePiTags);else{const e=new is(t.tagName);e.add(this.options.textNodeName,""),t.tagName!==t.tagExp&&t.attrExpPresent&&(e[":@"]=this.buildAttributesMap(t.tagExp,o,t.tagName)),this.addChild(n,e,o)}s=t.closeIndex+1}else if("!--"===e.substr(s+1,3)){const t=bs(e,"--\x3e",s+4,"Comment is not closed.");if(this.options.commentPropName){const i=e.substring(s+4,t-2);r=this.saveTextToParentTag(r,n,o),n.add(this.options.commentPropName,[{[this.options.textNodeName]:i}])}s=t}else if("!D"===e.substr(s+1,2)){const t=as(e,s);this.docTypeEntities=t.entities,s=t.i}else if("!["===e.substr(s+1,2)){const t=bs(e,"]]>",s,"CDATA is not closed.")-2,i=e.substring(s+9,t);if(r=this.saveTextToParentTag(r,n,o),this.options.cdataPropName)n.add(this.options.cdataPropName,[{[this.options.textNodeName]:i}]);else{let e=this.parseTextData(i,n.tagname,o,!0,!1,!0);null==e&&(e=""),n.add(this.options.textNodeName,e)}s=t+2}else{let i=vs(e,s,this.options.removeNSPrefix),a=i.tagName,c=i.tagExp,u=i.attrExpPresent,d=i.closeIndex;this.options.transformTagName&&(a=this.options.transformTagName(a)),n&&r&&"!xml"!==n.tagname&&(r=this.saveTextToParentTag(r,n,o,!1));const l=n;if(l&&-1!==this.options.unpairedTags.indexOf(l.tagname)&&(n=this.tagsNodeStack.pop(),o=o.substring(0,o.lastIndexOf("."))),a!==t.tagname&&(o+=o?"."+a:a),this.isItStopNode(this.options.stopNodes,o,a)){let t="";if(c.length>0&&c.lastIndexOf("/")===c.length-1)s=i.closeIndex;else if(-1!==this.options.unpairedTags.indexOf(a))s=i.closeIndex;else{const n=this.readStopNodeData(e,a,d+1);if(!n)throw new Error(`Unexpected end of ${a}`);s=n.i,t=n.tagContent}const r=new is(a);a!==c&&u&&(r[":@"]=this.buildAttributesMap(c,o,a)),t&&(t=this.parseTextData(t,a,o,!0,u,!0,!0)),o=o.substr(0,o.lastIndexOf(".")),r.add(this.options.textNodeName,t),this.addChild(n,r,o)}else{if(c.length>0&&c.lastIndexOf("/")===c.length-1){"/"===a[a.length-1]?(a=a.substr(0,a.length-1),c=a):c=c.substr(0,c.length-1),this.options.transformTagName&&(a=this.options.transformTagName(a));const e=new is(a);a!==c&&u&&(e[":@"]=this.buildAttributesMap(c,o,a)),this.addChild(n,e,o),o=o.substr(0,o.lastIndexOf("."))}else{const e=new is(a);this.tagsNodeStack.push(n),a!==c&&u&&(e[":@"]=this.buildAttributesMap(c,o,a)),this.addChild(n,e,o),n=e}r="",s=d}}else r+=e[s]}return t.child};function gs(e,t,n){const r=this.options.updateTag(t.tagname,n,t[":@"]);!1===r||("string"==typeof r?(t.tagname=r,e.addChild(t)):e.addChild(t))}const ms=function(e){if(this.options.processEntities){for(let t in this.docTypeEntities){const n=this.docTypeEntities[t];e=e.replace(n.regx,n.val)}for(let t in this.lastEntities){const n=this.lastEntities[t];e=e.replace(n.regex,n.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const n=this.htmlEntities[t];e=e.replace(n.regex,n.val)}e=e.replace(this.ampEntity.regex,this.ampEntity.val)}return e};function ys(e,t,n,r){return e&&(void 0===r&&(r=0===Object.keys(t.child).length),void 0!==(e=this.parseTextData(e,t.tagname,n,!1,!!t[":@"]&&0!==Object.keys(t[":@"]).length,r))&&""!==e&&t.add(this.options.textNodeName,e),e=""),e}function ws(e,t,n){const r="*."+n;for(const n in e){const o=e[n];if(r===o||t===o)return!0}return!1}function bs(e,t,n,r){const o=e.indexOf(t,n);if(-1===o)throw new Error(r);return o+t.length-1}function vs(e,t,n,r=">"){const o=function(e,t,n=">"){let r,o="";for(let s=t;s<e.length;s++){let t=e[s];if(r)t===r&&(r="");else if('"'===t||"'"===t)r=t;else if(t===n[0]){if(!n[1])return{data:o,index:s};if(e[s+1]===n[1])return{data:o,index:s}}else"\t"===t&&(t=" ");o+=t}}(e,t+1,r);if(!o)return;let s=o.data;const i=o.index,a=s.search(/\s/);let c=s,u=!0;if(-1!==a&&(c=s.substr(0,a).replace(/\s\s*$/,""),s=s.substr(a+1)),n){const e=c.indexOf(":");-1!==e&&(c=c.substr(e+1),u=c!==o.data.substr(e+1))}return{tagName:c,tagExp:s,closeIndex:i,attrExpPresent:u}}function Es(e,t,n){const r=n;let o=1;for(;n<e.length;n++)if("<"===e[n])if("/"===e[n+1]){const s=bs(e,">",n,`${t} is not closed`);if(e.substring(n+2,s).trim()===t&&(o--,0===o))return{tagContent:e.substring(r,n),i:s};n=s}else if("?"===e[n+1]){n=bs(e,"?>",n+1,"StopNode is not closed.")}else if("!--"===e.substr(n+1,3)){n=bs(e,"--\x3e",n+3,"StopNode is not closed.")}else if("!["===e.substr(n+1,2)){n=bs(e,"]]>",n,"StopNode is not closed.")-2}else{const r=vs(e,n,">");if(r){(r&&r.tagName)===t&&"/"!==r.tagExp[r.tagExp.length-1]&&o++,n=r.closeIndex}}}function xs(e,t,n){if(t&&"string"==typeof e){const t=e.trim();return"true"===t||"false"!==t&&cs(e,n)}return ss.isExist(e)?e:""}var Ss=class{constructor(e){this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"}},this.addExternalEntities=us,this.parseXml=hs,this.parseTextData=ds,this.resolveNameSpace=ls,this.buildAttributesMap=fs,this.isItStopNode=ws,this.replaceEntitiesValue=ms,this.readStopNodeData=Es,this.saveTextToParentTag=ys,this.addChild=gs}},Is={};function As(e,t,n){let r;const o={};for(let s=0;s<e.length;s++){const i=e[s],a=Ps(i);let c="";if(c=void 0===n?a:n+"."+a,a===t.textNodeName)void 0===r?r=i[a]:r+=""+i[a];else{if(void 0===a)continue;if(i[a]){let e=As(i[a],t,c);const n=Cs(e,t);i[":@"]?Ts(e,i[":@"],c,t):1!==Object.keys(e).length||void 0===e[t.textNodeName]||t.alwaysCreateTextNode?0===Object.keys(e).length&&(t.alwaysCreateTextNode?e[t.textNodeName]="":e=""):e=e[t.textNodeName],void 0!==o[a]&&o.hasOwnProperty(a)?(Array.isArray(o[a])||(o[a]=[o[a]]),o[a].push(e)):t.isArray(a,c,n)?o[a]=[e]:o[a]=e}}}return"string"==typeof r?r.length>0&&(o[t.textNodeName]=r):void 0!==r&&(o[t.textNodeName]=r),o}function Ps(e){const t=Object.keys(e);for(let e=0;e<t.length;e++){const n=t[e];if(":@"!==n)return n}}function Ts(e,t,n,r){if(t){const o=Object.keys(t),s=o.length;for(let i=0;i<s;i++){const s=o[i];r.isArray(s,n+"."+s,!0,!0)?e[s]=[t[s]]:e[s]=t[s]}}}function Cs(e,t){const{textNodeName:n}=t,r=Object.keys(e).length;return 0===r||!(1!==r||!e[n]&&"boolean"!=typeof e[n]&&0!==e[n])}Is.prettify=function(e,t){return As(e,t)};const{buildOptions:ks}=Wo,Os=Ss,{prettify:_s}=Is,Rs=To;var $s=class{constructor(e){this.externalEntities={},this.options=ks(e)}parse(e,t){if("string"==typeof e);else{if(!e.toString)throw new Error("XML data is accepted in String or Bytes[] form.");e=e.toString()}if(t){!0===t&&(t={});const n=Rs.validate(e,t);if(!0!==n)throw Error(`${n.err.msg}:${n.err.line}:${n.err.col}`)}const n=new Os(this.options);n.addExternalEntities(this.externalEntities);const r=n.parseXml(e);return this.options.preserveOrder||void 0===r?r:_s(r,this.options)}addEntity(e,t){if(-1!==t.indexOf("&"))throw new Error("Entity value can't have '&'");if(-1!==e.indexOf("&")||-1!==e.indexOf(";"))throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if("&"===t)throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=t}};function Ns(e,t,n,r){let o="",s=!1;for(let i=0;i<e.length;i++){const a=e[i],c=Ds(a);let u="";if(u=0===n.length?c:`${n}.${c}`,c===t.textNodeName){let e=a[c];Us(u,t)||(e=t.tagValueProcessor(c,e),e=Fs(e,t)),s&&(o+=r),o+=e,s=!1;continue}if(c===t.cdataPropName){s&&(o+=r),o+=`<![CDATA[${a[c][0][t.textNodeName]}]]>`,s=!1;continue}if(c===t.commentPropName){o+=r+`\x3c!--${a[c][0][t.textNodeName]}--\x3e`,s=!0;continue}if("?"===c[0]){const e=js(a[":@"],t),n="?xml"===c?"":r;let i=a[c][0][t.textNodeName];i=0!==i.length?" "+i:"",o+=n+`<${c}${i}${e}?>`,s=!0;continue}let d=r;""!==d&&(d+=t.indentBy);const l=r+`<${c}${js(a[":@"],t)}`,p=Ns(a[c],t,u,d);-1!==t.unpairedTags.indexOf(c)?t.suppressUnpairedNode?o+=l+">":o+=l+"/>":p&&0!==p.length||!t.suppressEmptyNode?p&&p.endsWith(">")?o+=l+`>${p}${r}</${c}>`:(o+=l+">",p&&""!==r&&(p.includes("/>")||p.includes("</"))?o+=r+t.indentBy+p+r:o+=p,o+=`</${c}>`):o+=l+"/>",s=!0}return o}function Ds(e){const t=Object.keys(e);for(let e=0;e<t.length;e++){const n=t[e];if(":@"!==n)return n}}function js(e,t){let n="";if(e&&!t.ignoreAttributes)for(let r in e){let o=t.attributeValueProcessor(r,e[r]);o=Fs(o,t),!0===o&&t.suppressBooleanAttributes?n+=` ${r.substr(t.attributeNamePrefix.length)}`:n+=` ${r.substr(t.attributeNamePrefix.length)}="${o}"`}return n}function Us(e,t){let n=(e=e.substr(0,e.length-t.textNodeName.length-1)).substr(e.lastIndexOf(".")+1);for(let r in t.stopNodes)if(t.stopNodes[r]===e||t.stopNodes[r]==="*."+n)return!0;return!1}function Fs(e,t){if(e&&e.length>0&&t.processEntities)for(let n=0;n<t.entities.length;n++){const r=t.entities[n];e=e.replace(r.regex,r.val)}return e}const Ms=function(e,t){let n="";return t.format&&t.indentBy.length>0&&(n="\n"),Ns(e,t,"",n)},Ls={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function zs(e){this.options=Object.assign({},Ls,e),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=Ws),this.processTextOrObjNode=qs,this.options.format?(this.indentate=Bs,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}function qs(e,t,n){const r=this.j2x(e,n+1);return void 0!==e[this.options.textNodeName]&&1===Object.keys(e).length?this.buildTextValNode(e[this.options.textNodeName],t,r.attrStr,n):this.buildObjectNode(r.val,t,r.attrStr,n)}function Bs(e){return this.options.indentBy.repeat(e)}function Ws(e){return!!e.startsWith(this.options.attributeNamePrefix)&&e.substr(this.attrPrefixLen)}zs.prototype.build=function(e){return this.options.preserveOrder?Ms(e,this.options):(Array.isArray(e)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(e={[this.options.arrayNodeName]:e}),this.j2x(e,0).val)},zs.prototype.j2x=function(e,t){let n="",r="";for(let o in e)if(void 0===e[o]);else if(null===e[o])"?"===o[0]?r+=this.indentate(t)+"<"+o+"?"+this.tagEndChar:r+=this.indentate(t)+"<"+o+"/"+this.tagEndChar;else if(e[o]instanceof Date)r+=this.buildTextValNode(e[o],o,"",t);else if("object"!=typeof e[o]){const s=this.isAttribute(o);if(s)n+=this.buildAttrPairStr(s,""+e[o]);else if(o===this.options.textNodeName){let t=this.options.tagValueProcessor(o,""+e[o]);r+=this.replaceEntitiesValue(t)}else r+=this.buildTextValNode(e[o],o,"",t)}else if(Array.isArray(e[o])){const n=e[o].length;let s="";for(let i=0;i<n;i++){const n=e[o][i];void 0===n||(null===n?"?"===o[0]?r+=this.indentate(t)+"<"+o+"?"+this.tagEndChar:r+=this.indentate(t)+"<"+o+"/"+this.tagEndChar:"object"==typeof n?this.options.oneListGroup?s+=this.j2x(n,t+1).val:s+=this.processTextOrObjNode(n,o,t):s+=this.buildTextValNode(n,o,"",t))}this.options.oneListGroup&&(s=this.buildObjectNode(s,o,"",t)),r+=s}else if(this.options.attributesGroupName&&o===this.options.attributesGroupName){const t=Object.keys(e[o]),r=t.length;for(let s=0;s<r;s++)n+=this.buildAttrPairStr(t[s],""+e[o][t[s]])}else r+=this.processTextOrObjNode(e[o],o,t);return{attrStr:n,val:r}},zs.prototype.buildAttrPairStr=function(e,t){return t=this.options.attributeValueProcessor(e,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&"true"===t?" "+e:" "+e+'="'+t+'"'},zs.prototype.buildObjectNode=function(e,t,n,r){if(""===e)return"?"===t[0]?this.indentate(r)+"<"+t+n+"?"+this.tagEndChar:this.indentate(r)+"<"+t+n+this.closeTag(t)+this.tagEndChar;{let o="</"+t+this.tagEndChar,s="";return"?"===t[0]&&(s="?",o=""),n&&-1===e.indexOf("<")?this.indentate(r)+"<"+t+n+s+">"+e+o:!1!==this.options.commentPropName&&t===this.options.commentPropName&&0===s.length?this.indentate(r)+`\x3c!--${e}--\x3e`+this.newLine:this.indentate(r)+"<"+t+n+s+this.tagEndChar+e+this.indentate(r)+o}},zs.prototype.closeTag=function(e){let t="";return-1!==this.options.unpairedTags.indexOf(e)?this.options.suppressUnpairedNode||(t="/"):t=this.options.suppressEmptyNode?"/":`></${e}`,t},zs.prototype.buildTextValNode=function(e,t,n,r){if(!1!==this.options.cdataPropName&&t===this.options.cdataPropName)return this.indentate(r)+`<![CDATA[${e}]]>`+this.newLine;if(!1!==this.options.commentPropName&&t===this.options.commentPropName)return this.indentate(r)+`\x3c!--${e}--\x3e`+this.newLine;if("?"===t[0])return this.indentate(r)+"<"+t+n+"?"+this.tagEndChar;{let o=this.options.tagValueProcessor(t,e);return o=this.replaceEntitiesValue(o),""===o?this.indentate(r)+"<"+t+n+this.closeTag(t)+this.tagEndChar:this.indentate(r)+"<"+t+n+">"+o+"</"+t+this.tagEndChar}},zs.prototype.replaceEntitiesValue=function(e){if(e&&e.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){const n=this.options.entities[t];e=e.replace(n.regex,n.val)}return e};var Vs={XMLParser:$s,XMLValidator:To,XMLBuilder:zs};const Hs=async(e,t)=>{const n={...e,body:await Pi(e.body,t)},r=Ci(e,n.body);switch(r){case"ExpiredTokenException":case"com.amazonaws.sts#ExpiredTokenException":throw await Gs(n);case"MalformedPolicyDocument":case"com.amazonaws.sts#MalformedPolicyDocumentException":throw await Zs(n);case"PackedPolicyTooLarge":case"com.amazonaws.sts#PackedPolicyTooLargeException":throw await Qs(n);case"RegionDisabledException":case"com.amazonaws.sts#RegionDisabledException":throw await ei(n);default:const t=n.body;return xi({output:e,parsedBody:t.Error,errorCode:r})}},Ks=async(e,t)=>{const n={...e,body:await Pi(e.body,t)},r=Ci(e,n.body);switch(r){case"ExpiredTokenException":case"com.amazonaws.sts#ExpiredTokenException":throw await Gs(n);case"IDPCommunicationError":case"com.amazonaws.sts#IDPCommunicationErrorException":throw await Xs(n);case"IDPRejectedClaim":case"com.amazonaws.sts#IDPRejectedClaimException":throw await Js(n);case"InvalidIdentityToken":case"com.amazonaws.sts#InvalidIdentityTokenException":throw await Ys(n);case"MalformedPolicyDocument":case"com.amazonaws.sts#MalformedPolicyDocumentException":throw await Zs(n);case"PackedPolicyTooLarge":case"com.amazonaws.sts#PackedPolicyTooLargeException":throw await Qs(n);case"RegionDisabledException":case"com.amazonaws.sts#RegionDisabledException":throw await ei(n);default:const t=n.body;return xi({output:e,parsedBody:t.Error,errorCode:r})}},Gs=async(e,t)=>{const n=e.body,r=hi(n.Error),o=new mo({$metadata:Ei(e),...r});return Vr(o,n)},Xs=async(e,t)=>{const n=e.body,r=gi(n.Error),o=new xo({$metadata:Ei(e),...r});return Vr(o,n)},Js=async(e,t)=>{const n=e.body,r=mi(n.Error),o=new vo({$metadata:Ei(e),...r});return Vr(o,n)},Ys=async(e,t)=>{const n=e.body,r=yi(n.Error),o=new Eo({$metadata:Ei(e),...r});return Vr(o,n)},Zs=async(e,t)=>{const n=e.body,r=wi(n.Error),o=new yo({$metadata:Ei(e),...r});return Vr(o,n)},Qs=async(e,t)=>{const n=e.body,r=bi(n.Error),o=new wo({$metadata:Ei(e),...r});return Vr(o,n)},ei=async(e,t)=>{const n=e.body,r=vi(n.Error),o=new bo({$metadata:Ei(e),...r});return Vr(o,n)},ti=(e,t)=>{const n={};if(null!=e.RoleArn&&(n.RoleArn=e.RoleArn),null!=e.RoleSessionName&&(n.RoleSessionName=e.RoleSessionName),null!=e.PolicyArns){const t=ri(e.PolicyArns);0===e.PolicyArns?.length&&(n.PolicyArns=[]),Object.entries(t).forEach((([e,t])=>{n[`PolicyArns.${e}`]=t}))}if(null!=e.Policy&&(n.Policy=e.Policy),null!=e.DurationSeconds&&(n.DurationSeconds=e.DurationSeconds),null!=e.Tags){const t=ui(e.Tags);0===e.Tags?.length&&(n.Tags=[]),Object.entries(t).forEach((([e,t])=>{n[`Tags.${e}`]=t}))}if(null!=e.TransitiveTagKeys){const t=ci(e.TransitiveTagKeys);0===e.TransitiveTagKeys?.length&&(n.TransitiveTagKeys=[]),Object.entries(t).forEach((([e,t])=>{n[`TransitiveTagKeys.${e}`]=t}))}if(null!=e.ExternalId&&(n.ExternalId=e.ExternalId),null!=e.SerialNumber&&(n.SerialNumber=e.SerialNumber),null!=e.TokenCode&&(n.TokenCode=e.TokenCode),null!=e.SourceIdentity&&(n.SourceIdentity=e.SourceIdentity),null!=e.ProvidedContexts){const t=ii(e.ProvidedContexts);0===e.ProvidedContexts?.length&&(n.ProvidedContexts=[]),Object.entries(t).forEach((([e,t])=>{n[`ProvidedContexts.${e}`]=t}))}return n},ni=(e,t)=>{const n={};if(null!=e.RoleArn&&(n.RoleArn=e.RoleArn),null!=e.RoleSessionName&&(n.RoleSessionName=e.RoleSessionName),null!=e.WebIdentityToken&&(n.WebIdentityToken=e.WebIdentityToken),null!=e.ProviderId&&(n.ProviderId=e.ProviderId),null!=e.PolicyArns){const t=ri(e.PolicyArns);0===e.PolicyArns?.length&&(n.PolicyArns=[]),Object.entries(t).forEach((([e,t])=>{n[`PolicyArns.${e}`]=t}))}return null!=e.Policy&&(n.Policy=e.Policy),null!=e.DurationSeconds&&(n.DurationSeconds=e.DurationSeconds),n},ri=(e,t)=>{const n={};let r=1;for(const t of e){if(null===t)continue;const e=oi(t);Object.entries(e).forEach((([e,t])=>{n[`member.${r}.${e}`]=t})),r++}return n},oi=(e,t)=>{const n={};return null!=e.arn&&(n.arn=e.arn),n},si=(e,t)=>{const n={};return null!=e.ProviderArn&&(n.ProviderArn=e.ProviderArn),null!=e.ContextAssertion&&(n.ContextAssertion=e.ContextAssertion),n},ii=(e,t)=>{const n={};let r=1;for(const t of e){if(null===t)continue;const e=si(t);Object.entries(e).forEach((([e,t])=>{n[`member.${r}.${e}`]=t})),r++}return n},ai=(e,t)=>{const n={};return null!=e.Key&&(n.Key=e.Key),null!=e.Value&&(n.Value=e.Value),n},ci=(e,t)=>{const n={};let r=1;for(const t of e)null!==t&&(n[`member.${r}`]=t,r++);return n},ui=(e,t)=>{const n={};let r=1;for(const t of e){if(null===t)continue;const e=ai(t);Object.entries(e).forEach((([e,t])=>{n[`member.${r}.${e}`]=t})),r++}return n},di=(e,t)=>{const n={};return void 0!==e.AssumedRoleId&&(n.AssumedRoleId=Ar(e.AssumedRoleId)),void 0!==e.Arn&&(n.Arn=Ar(e.Arn)),n},li=(e,t)=>{const n={};return void 0!==e.Credentials&&(n.Credentials=fi(e.Credentials)),void 0!==e.AssumedRoleUser&&(n.AssumedRoleUser=di(e.AssumedRoleUser)),void 0!==e.PackedPolicySize&&(n.PackedPolicySize=Or(e.PackedPolicySize)),void 0!==e.SourceIdentity&&(n.SourceIdentity=Ar(e.SourceIdentity)),n},pi=(e,t)=>{const n={};return void 0!==e.Credentials&&(n.Credentials=fi(e.Credentials)),void 0!==e.SubjectFromWebIdentityToken&&(n.SubjectFromWebIdentityToken=Ar(e.SubjectFromWebIdentityToken)),void 0!==e.AssumedRoleUser&&(n.AssumedRoleUser=di(e.AssumedRoleUser)),void 0!==e.PackedPolicySize&&(n.PackedPolicySize=Or(e.PackedPolicySize)),void 0!==e.Provider&&(n.Provider=Ar(e.Provider)),void 0!==e.Audience&&(n.Audience=Ar(e.Audience)),void 0!==e.SourceIdentity&&(n.SourceIdentity=Ar(e.SourceIdentity)),n},fi=(e,t)=>{const n={};return void 0!==e.AccessKeyId&&(n.AccessKeyId=Ar(e.AccessKeyId)),void 0!==e.SecretAccessKey&&(n.SecretAccessKey=Ar(e.SecretAccessKey)),void 0!==e.SessionToken&&(n.SessionToken=Ar(e.SessionToken)),void 0!==e.Expiration&&(n.Expiration=Sr(Dr(e.Expiration))),n},hi=(e,t)=>{const n={};return void 0!==e.message&&(n.message=Ar(e.message)),n},gi=(e,t)=>{const n={};return void 0!==e.message&&(n.message=Ar(e.message)),n},mi=(e,t)=>{const n={};return void 0!==e.message&&(n.message=Ar(e.message)),n},yi=(e,t)=>{const n={};return void 0!==e.message&&(n.message=Ar(e.message)),n},wi=(e,t)=>{const n={};return void 0!==e.message&&(n.message=Ar(e.message)),n},bi=(e,t)=>{const n={};return void 0!==e.message&&(n.message=Ar(e.message)),n},vi=(e,t)=>{const n={};return void 0!==e.message&&(n.message=Ar(e.message)),n},Ei=e=>({httpStatusCode:e.statusCode,requestId:e.headers["x-amzn-requestid"]??e.headers["x-amzn-request-id"]??e.headers["x-amz-request-id"],extendedRequestId:e.headers["x-amz-id-2"],cfId:e.headers["x-amz-cf-id"]}),xi=Hr(go),Si=async(e,t,n,r,o)=>{const{hostname:s,protocol:i="https",port:a,path:c}=await e.endpoint(),u={protocol:i,hostname:s,port:a,method:"POST",path:c.endsWith("/")?c.slice(0,-1)+n:c+n,headers:t};return void 0!==r&&(u.hostname=r),void 0!==o&&(u.body=o),new b(u)},Ii={"content-type":"application/x-www-form-urlencoded"},Ai=(e,t)=>((e,t)=>pr(e,t).then((e=>t.utf8Encoder(e))))(e,t).then((e=>{if(e.length){const t=new Vs.XMLParser({attributeNamePrefix:"",htmlEntities:!0,ignoreAttributes:!1,ignoreDeclaration:!0,parseTagValue:!1,trimValues:!1,tagValueProcessor:(e,t)=>""===t.trim()&&t.includes("\n")?"":void 0});t.addEntity("#xD","\r"),t.addEntity("#10","\n");const n=t.parse(e),r="#text",o=Object.keys(n)[0],s=n[o];return s[r]&&(s[o]=s[r],delete s[r]),no(s)}return{}})),Pi=async(e,t)=>{const n=await Ai(e,t);return n.Error&&(n.Error.message=n.Error.message??n.Error.Message),n},Ti=e=>Object.entries(e).map((([e,t])=>to(e)+"="+to(t))).join("&"),Ci=(e,t)=>void 0!==t.Error?.Code?t.Error.Code:404==e.statusCode?"NotFound":void 0;class ki extends fr{static getEndpointParameterInstructions(){return{UseGlobalEndpoint:{type:"builtInParams",name:"useGlobalEndpoint"},UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}}}constructor(e){super(),this.input=e}resolveMiddleware(e,t,n){this.middlewareStack.use(yn(t,this.serialize,this.deserialize)),this.middlewareStack.use(bn(t,ki.getEndpointParameterInstructions())),this.middlewareStack.use(it(t));const r=e.concat(this.middlewareStack),{logger:o}=t,s={logger:o,clientName:"STSClient",commandName:"AssumeRoleCommand",inputFilterSensitiveLog:e=>e,outputFilterSensitiveLog:Io},{requestHandler:i}=t;return r.resolve((e=>i.handle(e.request,n||{})),s)}serialize(e,t){return(async(e,t)=>{const n=Ii;let r;return r=Ti({...ti(e),Action:"AssumeRole",Version:"2011-06-15"}),Si(t,n,"/",void 0,r)})(e,t)}deserialize(e,t){return(async(e,t)=>{if(e.statusCode>=300)return Hs(e,t);const n=await Ai(e.body,t);let r={};return r=li(n.AssumeRoleResult),{$metadata:Ei(e),...r}})(e,t)}}class Oi extends fr{static getEndpointParameterInstructions(){return{UseGlobalEndpoint:{type:"builtInParams",name:"useGlobalEndpoint"},UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}}}constructor(e){super(),this.input=e}resolveMiddleware(e,t,n){this.middlewareStack.use(yn(t,this.serialize,this.deserialize)),this.middlewareStack.use(bn(t,Oi.getEndpointParameterInstructions()));const r=e.concat(this.middlewareStack),{logger:o}=t,s={logger:o,clientName:"STSClient",commandName:"AssumeRoleWithWebIdentityCommand",inputFilterSensitiveLog:Ao,outputFilterSensitiveLog:Po},{requestHandler:i}=t;return r.resolve((e=>i.handle(e.request,n||{})),s)}serialize(e,t){return(async(e,t)=>{const n=Ii;let r;return r=Ti({...ni(e),Action:"AssumeRoleWithWebIdentity",Version:"2011-06-15"}),Si(t,n,"/",void 0,r)})(e,t)}deserialize(e,t){return(async(e,t)=>{if(e.statusCode>=300)return Ks(e,t);const n=await Ai(e.body,t);let r={};return r=pi(n.AssumeRoleWithWebIdentityResult),{$metadata:Ei(e),...r}})(e,t)}}const _i="us-east-1",Ri=e=>"function"!=typeof e?void 0===e?_i:e:async()=>{try{return await e()}catch(e){return _i}},$i=(e,t)=>{let n,r;return async(o,s)=>{if(r=o,!n){const{logger:o,region:s,requestHandler:i}=e;n=new t({logger:o,credentialDefaultProvider:()=>async()=>r,region:Ri(s||e.region),...i?{requestHandler:i}:{}})}const{Credentials:i}=await n.send(new ki(s));if(!i||!i.AccessKeyId||!i.SecretAccessKey)throw new Error(`Invalid response from STS.assumeRole call with role ${s.RoleArn}`);return{accessKeyId:i.AccessKeyId,secretAccessKey:i.SecretAccessKey,sessionToken:i.SessionToken,expiration:i.Expiration}}},Ni=(e,t)=>{let n;return async r=>{if(!n){const{logger:r,region:o,requestHandler:s}=e;n=new t({logger:r,region:Ri(o||e.region),...s?{requestHandler:s}:{}})}const{Credentials:o}=await n.send(new Oi(r));if(!o||!o.AccessKeyId||!o.SecretAccessKey)throw new Error(`Invalid response from STS.assumeRoleWithWebIdentity call with role ${r.RoleArn}`);return{accessKeyId:o.AccessKeyId,secretAccessKey:o.SecretAccessKey,sessionToken:o.SessionToken,expiration:o.Expiration}}},Di=()=>async()=>{const e=process.env.AWS_ACCESS_KEY_ID,t=process.env.AWS_SECRET_ACCESS_KEY,n=process.env.AWS_SESSION_TOKEN,r=process.env.AWS_CREDENTIAL_EXPIRATION;if(e&&t)return{accessKeyId:e,secretAccessKey:t,...n&&{sessionToken:n},...r&&{expiration:new Date(r)}};throw new k("Unable to find environment variable credentials.")},ji=()=>{const{HOME:e,USERPROFILE:t,HOMEPATH:n,HOMEDRIVE:r=`C:${a.sep}`}=process.env;return e||(t||(n?`${r}${n}`:i.homedir()))},Ui="AWS_PROFILE",Fi=e=>e.profile||process.env[Ui]||"default",Mi=e=>{const n=t.createHash("sha1").update(e).digest("hex");return a.join(ji(),".aws","sso","cache",`${n}.json`)},{readFile:Li}=c.promises,zi=async e=>{const t=Mi(e),n=await Li(t,"utf8");return JSON.parse(n)},qi=()=>process.env.AWS_CONFIG_FILE||a.join(ji(),".aws","config"),Bi=()=>process.env.AWS_SHARED_CREDENTIALS_FILE||a.join(ji(),".aws","credentials"),Wi=/^profile\s(["'])?([^\1]+)\1$/,Vi=e=>Object.entries(e).filter((([e])=>Wi.test(e))).reduce(((e,[t,n])=>({...e,[Wi.exec(t)[2]]:n})),{...e.default&&{default:e.default}}),Hi=["__proto__","profile __proto__"],Ki=e=>{const t={};let n;for(let r of e.split(/\r?\n/)){r=r.split(/(^|\s)[;#]/)[0].trim();if("["===r[0]&&"]"===r[r.length-1]){if(n=r.substring(1,r.length-1),Hi.includes(n))throw new Error(`Found invalid profile name "${n}"`)}else if(n){const e=r.indexOf("="),o=0,s=r.length-1;if(-1!==e&&e!==o&&e!==s){const[o,s]=[r.substring(0,e).trim(),r.substring(e+1).trim()];t[n]=t[n]||{},t[n][o]=s}}}return t},{readFile:Gi}=c.promises,Xi={},Ji=(e,t)=>(Xi[e]&&!t?.ignoreCache||(Xi[e]=Gi(e,"utf8")),Xi[e]),Yi=()=>({}),Zi=async(e={})=>{const{filepath:t=Bi(),configFilepath:n=qi()}=e,r=await Promise.all([Ji(n,{ignoreCache:e.ignoreCache}).then(Ki).then(Vi).catch(Yi),Ji(t,{ignoreCache:e.ignoreCache}).then(Ki).catch(Yi)]);return{configFile:r[0],credentialsFile:r[1]}},Qi=/^sso-session\s(["'])?([^\1]+)\1$/,ea=e=>Object.entries(e).filter((([e])=>Qi.test(e))).reduce(((e,[t,n])=>({...e,[Qi.exec(t)[2]]:n})),{}),ta=()=>({}),na=async(e={})=>Ji(e.configFilepath??qi()).then(Ki).then(ea).catch(ta),ra=async e=>{const t=await Zi(e);return((...e)=>{const t={};for(const n of e)for(const[e,r]of Object.entries(n))void 0!==t[e]?Object.assign(t[e],r):t[e]=r;return t})(t.configFile,t.credentialsFile)};function oa(t){return new Promise(((n,o)=>{const s=r.request({method:"GET",...t,hostname:t.hostname?.replace(/^\[(.+)\]$/,"$1")});s.on("error",(e=>{o(Object.assign(new C("Unable to connect to instance metadata service"),e)),s.destroy()})),s.on("timeout",(()=>{o(new C("TimeoutError from instance metadata service")),s.destroy()})),s.on("response",(t=>{const{statusCode:r=400}=t;(r<200||300<=r)&&(o(Object.assign(new C("Error response received from instance metadata service"),{statusCode:r})),s.destroy());const i=[];t.on("data",(e=>{i.push(e)})),t.on("end",(()=>{n(e.Buffer.concat(i)),s.destroy()}))})),s.end()}))}const sa=e=>Boolean(e)&&"object"==typeof e&&"string"==typeof e.AccessKeyId&&"string"==typeof e.SecretAccessKey&&"string"==typeof e.Token&&"string"==typeof e.Expiration,ia=e=>({accessKeyId:e.AccessKeyId,secretAccessKey:e.SecretAccessKey,sessionToken:e.Token,expiration:new Date(e.Expiration)}),aa=({maxRetries:e=0,timeout:t=1e3})=>({maxRetries:e,timeout:t}),ca=(e,t)=>{let n=e();for(let r=0;r<t;r++)n=n.catch(e);return n},ua="AWS_CONTAINER_CREDENTIALS_FULL_URI",da="AWS_CONTAINER_CREDENTIALS_RELATIVE_URI",la="AWS_CONTAINER_AUTHORIZATION_TOKEN",pa=(e={})=>{const{timeout:t,maxRetries:n}=aa(e);return()=>ca((async()=>{const e=await ma(),n=JSON.parse(await fa(t,e));if(!sa(n))throw new k("Invalid response received from instance metadata service.");return ia(n)}),n)},fa=async(e,t)=>{process.env[la]&&(t.headers={...t.headers,Authorization:process.env[la]});return(await oa({...t,timeout:e})).toString()},ha={localhost:!0,"127.0.0.1":!0},ga={"http:":!0,"https:":!0},ma=async()=>{if(process.env[da])return{hostname:"169.254.170.2",path:process.env[da]};if(process.env[ua]){const e=u.parse(process.env[ua]);if(!e.hostname||!(e.hostname in ha))throw new k(`${e.hostname} is not a valid container metadata service hostname`,!1);if(!e.protocol||!(e.protocol in ga))throw new k(`${e.protocol} is not a valid container metadata service protocol`,!1);return{...e,port:e.port?parseInt(e.port,10):void 0}}throw new k(`The container metadata credential provider cannot be used unless the ${da} or ${ua} environment variable is set`,!1)},ya=e=>{return"function"==typeof e?async()=>await e():(t=e,()=>Promise.resolve(t));var t},wa=({environmentVariableSelector:e,configFileSelector:t,default:n},r={})=>{return R(_((o=e,async()=>{try{const e=o(process.env);if(void 0===e)throw new Error;return e}catch(e){throw new k(e.message||`Cannot load config from environment variables with getter: ${o}`)}}),((e,{preferredFile:t="config",...n}={})=>async()=>{const r=Fi(n),{configFile:o,credentialsFile:s}=await Zi(n),i=s[r]||{},a=o[r]||{},c="config"===t?{...i,...a}:{...a,...i};try{const t=e(c);if(void 0===t)throw new Error;return t}catch(t){throw new k(t.message||`Cannot load config for profile ${r} in SDK configuration files with getter: ${e}`)}})(t,r),ya(n)));var o};var ba;!function(e){e.IPv4="http://169.254.169.254",e.IPv6="http://[fd00:ec2::254]"}(ba||(ba={}));const va={environmentVariableSelector:e=>e.AWS_EC2_METADATA_SERVICE_ENDPOINT,configFileSelector:e=>e.ec2_metadata_service_endpoint,default:void 0};var Ea;!function(e){e.IPv4="IPv4",e.IPv6="IPv6"}(Ea||(Ea={}));const xa={environmentVariableSelector:e=>e.AWS_EC2_METADATA_SERVICE_ENDPOINT_MODE,configFileSelector:e=>e.ec2_metadata_service_endpoint_mode,default:Ea.IPv4},Sa=async()=>fn(await Ia()||await Aa()),Ia=async()=>wa(va)(),Aa=async()=>{const e=await wa(xa)();switch(e){case Ea.IPv4:return ba.IPv4;case Ea.IPv6:return ba.IPv6;default:throw new Error(`Unsupported endpoint mode: ${e}. Select from ${Object.values(Ea)}`)}},Pa=(e,t)=>{const n=300+Math.floor(300*Math.random()),r=new Date(Date.now()+1e3*n);t.warn("Attempting credential expiration extension due to a credential service availability issue. A refresh of these credentials will be attempted after ${new Date(newExpiration)}.\nFor more information, please visit: https://docs.aws.amazon.com/sdkref/latest/guide/feature-static-credentials.html");const o=e.originalExpiration??e.expiration;return{...e,...o?{originalExpiration:o}:{},expiration:r}},Ta="/latest/meta-data/iam/security-credentials/",Ca=(e={})=>((e,t={})=>{const n=t?.logger||console;let r;return async()=>{let t;try{t=await e(),t.expiration&&t.expiration.getTime()<Date.now()&&(t=Pa(t,n))}catch(e){if(!r)throw e;n.warn("Credential renew failed: ",e),t=Pa(r,n)}return r=t,t}})(ka(e),{logger:e.logger}),ka=e=>{let t=!1;const{timeout:n,maxRetries:r}=aa(e),o=async(e,n)=>{const r=(await ca((async()=>{let e;try{e=await _a(n)}catch(e){throw 401===e.statusCode&&(t=!1),e}return e}),e)).trim();return ca((async()=>{let e;try{e=await Ra(r,n)}catch(e){throw 401===e.statusCode&&(t=!1),e}return e}),e)};return async()=>{const e=await Sa();if(t)return o(r,{...e,timeout:n});{let s;try{s=(await Oa({...e,timeout:n})).toString()}catch(s){if(400===s?.statusCode)throw Object.assign(s,{message:"EC2 Metadata token request returned error"});return("TimeoutError"===s.message||[403,404,405].includes(s.statusCode))&&(t=!0),o(r,{...e,timeout:n})}return o(r,{...e,headers:{"x-aws-ec2-metadata-token":s},timeout:n})}}},Oa=async e=>oa({...e,path:"/latest/api/token",method:"PUT",headers:{"x-aws-ec2-metadata-token-ttl-seconds":"21600"}}),_a=async e=>(await oa({...e,path:Ta})).toString(),Ra=async(e,t)=>{const n=JSON.parse((await oa({...t,path:Ta+e})).toString());if(!sa(n))throw new k("Invalid response received from instance metadata service.");return ia(n)},$a=e=>"string"==typeof e.source_profile&&void 0===e.credential_source,Na=e=>"string"==typeof e.credential_source&&void 0===e.source_profile,Da=async(e,t,n,r={})=>{const o=t[e];if(!n.roleAssumer)throw new k(`Profile ${e} requires a role to be assumed, but no role assumption callback was provided.`,!1);const{source_profile:s}=o;if(s&&s in r)throw new k(`Detected a cycle attempting to resolve credentials for profile ${Fi(n)}. Profiles visited: `+Object.keys(r).join(", "),!1);const i=s?id(s,t,n,{...r,[s]:!0}):((e,t)=>{const n={EcsContainer:pa,Ec2InstanceMetadata:Ca,Environment:Di};if(e in n)return n[e]();throw new k(`Unsupported credential source in profile ${t}. Got ${e}, expected EcsContainer or Ec2InstanceMetadata or Environment.`)})(o.credential_source,e)(),a={RoleArn:o.role_arn,RoleSessionName:o.role_session_name||`aws-sdk-js-${Date.now()}`,ExternalId:o.external_id},{mfa_serial:c}=o;if(c){if(!n.mfaCodeProvider)throw new k(`Profile ${e} requires multi-factor authentication, but no MFA code callback was provided.`,!1);a.SerialNumber=c,a.TokenCode=await n.mfaCodeProvider(c)}const u=await i;return n.roleAssumer(u,a)},ja=async(e,t)=>{const n=t[e];if(!t[e])throw new k(`Profile ${e} could not be found in shared credentials file.`);{const t=n.credential_process;if(void 0===t)throw new k(`Profile ${e} did not contain credential_process.`);{const n=s.promisify(d.exec);try{const{stdout:r}=await n(t);let o;try{o=JSON.parse(r.trim())}catch{throw Error(`Profile ${e} credential_process returned invalid JSON.`)}return((e,t)=>{if(1!==t.Version)throw Error(`Profile ${e} credential_process did not return Version 1.`);if(void 0===t.AccessKeyId||void 0===t.SecretAccessKey)throw Error(`Profile ${e} credential_process returned invalid credentials.`);if(t.Expiration){const n=new Date;if(new Date(t.Expiration)<n)throw Error(`Profile ${e} credential_process returned expired credentials.`)}return{accessKeyId:t.AccessKeyId,secretAccessKey:t.SecretAccessKey,...t.SessionToken&&{sessionToken:t.SessionToken},...t.Expiration&&{expiration:new Date(t.Expiration)}}})(e,o)}catch(e){throw new k(e.message)}}}},Ua=(e={})=>async()=>{const t=await ra(e);return ja(Fi(e),t)},Fa=e=>e&&("string"==typeof e.sso_start_url||"string"==typeof e.sso_account_id||"string"==typeof e.sso_session||"string"==typeof e.sso_region||"string"==typeof e.sso_role_name);var Ma="3.398.0";const La=({serviceId:e,clientVersion:t})=>{const n=[["aws-sdk-js",t],["ua","2.0"],[`os/${i.platform()}`,i.release()],["lang/js"],["md/nodejs",`${l.versions.node}`]],r=(()=>{try{return"function"==typeof require&&"undefined"!=typeof module&&require("aws-crt")?["md/crt-avail"]:null}catch(e){return null}})();r&&n.push(r),e&&n.push([`api/${e}`,t]),l.env.AWS_EXECUTION_ENV&&n.push([`exec-env/${l.env.AWS_EXECUTION_ENV}`]);const o=wa({environmentVariableSelector:e=>e.AWS_SDK_UA_APP_ID,configFileSelector:e=>e["sdk-ua-app-id"],default:void 0})();let s;return async()=>{if(!s){const e=await o;s=e?[...n,[`app/${e}`]]:[...n]}return s}};class za{constructor(e,t){this.algorithmIdentifier=e,this.secret=t,this.reset()}update(e,t){this.hash.update(xe(qa(e,t)))}digest(){return Promise.resolve(this.hash.digest())}reset(){this.hash=this.secret?t.createHmac(this.algorithmIdentifier,qa(this.secret)):t.createHash(this.algorithmIdentifier)}}function qa(t,n){return e.Buffer.isBuffer(t)?t:"string"==typeof t?ve(t,n):ArrayBuffer.isView(t)?be(t.buffer,t.byteOffset,t.byteLength):be(t)}const Ba=e=>{if(!e)return 0;if("string"==typeof e)return Buffer.from(e).length;if("number"==typeof e.byteLength)return e.byteLength;if("number"==typeof e.size)return e.size;if("number"==typeof e.start&&"number"==typeof e.end)return e.end+1-e.start;if("string"==typeof e.path||Buffer.isBuffer(e.path))return c.lstatSync(e.path).size;if("number"==typeof e.fd)return c.fstatSync(e.fd).size;throw new Error(`Body Length computation failed for ${e}`)},Wa="required",Va="fn",Ha="argv",Ka="ref",Ga="PartitionResult",Xa="tree",Ja="error",Ya="endpoint",Za={[Wa]:!1,type:"String"},Qa={[Wa]:!0,default:!1,type:"Boolean"},ec={[Ka]:"Endpoint"},tc={[Va]:"booleanEquals",[Ha]:[{[Ka]:"UseFIPS"},!0]},nc={[Va]:"booleanEquals",[Ha]:[{[Ka]:"UseDualStack"},!0]},rc={},oc={[Va]:"booleanEquals",[Ha]:[!0,{[Va]:"getAttr",[Ha]:[{[Ka]:Ga},"supportsFIPS"]}]},sc={[Va]:"booleanEquals",[Ha]:[!0,{[Va]:"getAttr",[Ha]:[{[Ka]:Ga},"supportsDualStack"]}]},ic=[ec],ac=[tc],cc=[nc],uc={version:"1.0",parameters:{Region:Za,UseDualStack:Qa,UseFIPS:Qa,Endpoint:Za},rules:[{conditions:[{[Va]:"aws.partition",[Ha]:[{[Ka]:"Region"}],assign:Ga}],type:Xa,rules:[{conditions:[{[Va]:"isSet",[Ha]:ic},{[Va]:"parseURL",[Ha]:ic,assign:"url"}],type:Xa,rules:[{conditions:ac,error:"Invalid Configuration: FIPS and custom endpoint are not supported",type:Ja},{type:Xa,rules:[{conditions:cc,error:"Invalid Configuration: Dualstack and custom endpoint are not supported",type:Ja},{endpoint:{url:ec,properties:rc,headers:rc},type:Ya}]}]},{conditions:[tc,nc],type:Xa,rules:[{conditions:[oc,sc],type:Xa,rules:[{endpoint:{url:"https://portal.sso-fips.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:rc,headers:rc},type:Ya}]},{error:"FIPS and DualStack are enabled, but this partition does not support one or both",type:Ja}]},{conditions:ac,type:Xa,rules:[{conditions:[oc],type:Xa,rules:[{type:Xa,rules:[{endpoint:{url:"https://portal.sso-fips.{Region}.{PartitionResult#dnsSuffix}",properties:rc,headers:rc},type:Ya}]}]},{error:"FIPS is enabled but this partition does not support FIPS",type:Ja}]},{conditions:cc,type:Xa,rules:[{conditions:[sc],type:Xa,rules:[{endpoint:{url:"https://portal.sso.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:rc,headers:rc},type:Ya}]},{error:"DualStack is enabled but this partition does not support DualStack",type:Ja}]},{endpoint:{url:"https://portal.sso.{Region}.{PartitionResult#dnsSuffix}",properties:rc,headers:rc},type:Ya}]}]},dc=(e,t={})=>Mt(uc,{endpointParams:e,logger:t.logger}),lc="AWS_REGION",pc="AWS_DEFAULT_REGION",fc=["in-region","cross-region","mobile","standard","legacy"],hc={environmentVariableSelector:e=>e.AWS_DEFAULTS_MODE,configFileSelector:e=>e.defaults_mode,default:"legacy"},gc=({region:e=wa(Yt),defaultsMode:t=wa(hc)}={})=>R((async()=>{const n="function"==typeof t?await t():t;switch(n?.toLowerCase()){case"auto":return mc(e);case"in-region":case"cross-region":case"mobile":case"standard":case"legacy":return Promise.resolve(n?.toLocaleLowerCase());case void 0:return Promise.resolve("legacy");default:throw new Error(`Invalid parameter for "defaultsMode", expect ${fc.join(", ")}, got ${n}`)}})),mc=async e=>{if(e){const t="function"==typeof e?await e():e,n=await yc();return n?t===n?"in-region":"cross-region":"standard"}return"standard"},yc=async()=>{if(process.env.AWS_EXECUTION_ENV&&(process.env[lc]||process.env[pc]))return process.env[lc]??process.env[pc];if(!process.env.AWS_EC2_METADATA_DISABLED)try{const e=await Sa();return(await oa({...e,path:"/latest/meta-data/placement/region"})).toString()}catch(e){}},wc=e=>{Jr(process.version);const t=gc(e),n=()=>t().then(Gr),r=(e=>({apiVersion:"2019-06-10",base64Decoder:e?.base64Decoder??rr,base64Encoder:e?.base64Encoder??or,disableHostPrefix:e?.disableHostPrefix??!1,endpointProvider:e?.endpointProvider??dc,extensions:e?.extensions??[],logger:e?.logger??new Yn,serviceId:e?.serviceId??"SSO",urlParser:e?.urlParser??fn,utf8Decoder:e?.utf8Decoder??Ee,utf8Encoder:e?.utf8Encoder??Se}))(e);return{...r,...e,runtime:"node",defaultsMode:t,bodyLengthChecker:e?.bodyLengthChecker??Ba,defaultUserAgentProvider:e?.defaultUserAgentProvider??La({serviceId:r.serviceId,clientVersion:Ma}),maxAttempts:e?.maxAttempts??wa(qn),region:e?.region??wa(Yt,Zt),requestHandler:e?.requestHandler??new ur(n),retryMode:e?.retryMode??wa({...Wn,default:async()=>(await n()).retryMode||xn}),sha256:e?.sha256??za.bind(null,"sha256"),streamCollector:e?.streamCollector??lr,useDualstackEndpoint:e?.useDualstackEndpoint??wa(Xt),useFipsEndpoint:e?.useFipsEndpoint??wa(Jt)}};class bc extends tr{constructor(...[e]){const t=wc(e||{}),n=(r=t,{...r,useDualstackEndpoint:r.useDualstackEndpoint??!1,useFipsEndpoint:r.useFipsEndpoint??!1,defaultSigningName:"awsssoportal"});var r;const o=tn(n),s=vn(o),i=((e,t)=>{const n={...Qr(e)};return t.forEach((e=>e.configure(n))),{...e,...eo(n)}})(at(Bn(s)),e?.extensions||[]);super(i),this.config=i,this.middlewareStack.use(Xn(this.config)),this.middlewareStack.use(on(this.config)),this.middlewareStack.use(x(this.config)),this.middlewareStack.use(I(this.config)),this.middlewareStack.use(T(this.config)),this.middlewareStack.use(Ht(this.config))}destroy(){super.destroy()}}class vc extends Wr{constructor(e){super(e),Object.setPrototypeOf(this,vc.prototype)}}let Ec=class e extends vc{constructor(t){super({name:"InvalidRequestException",$fault:"client",...t}),this.name="InvalidRequestException",this.$fault="client",Object.setPrototypeOf(this,e.prototype)}};class xc extends vc{constructor(e){super({name:"ResourceNotFoundException",$fault:"client",...e}),this.name="ResourceNotFoundException",this.$fault="client",Object.setPrototypeOf(this,xc.prototype)}}class Sc extends vc{constructor(e){super({name:"TooManyRequestsException",$fault:"client",...e}),this.name="TooManyRequestsException",this.$fault="client",Object.setPrototypeOf(this,Sc.prototype)}}class Ic extends vc{constructor(e){super({name:"UnauthorizedException",$fault:"client",...e}),this.name="UnauthorizedException",this.$fault="client",Object.setPrototypeOf(this,Ic.prototype)}}const Ac=e=>({...e,...e.accessToken&&{accessToken:hr}}),Pc=e=>({...e,...e.secretAccessKey&&{secretAccessKey:hr},...e.sessionToken&&{sessionToken:hr}}),Tc=e=>({...e,...e.roleCredentials&&{roleCredentials:Pc(e.roleCredentials)}}),Cc=async(e,t)=>{const n={...e,body:await Uc(e.body,t)},r=Fc(e,n.body);switch(r){case"InvalidRequestException":case"com.amazonaws.sso#InvalidRequestException":throw await Oc(n);case"ResourceNotFoundException":case"com.amazonaws.sso#ResourceNotFoundException":throw await _c(n);case"TooManyRequestsException":case"com.amazonaws.sso#TooManyRequestsException":throw await Rc(n);case"UnauthorizedException":case"com.amazonaws.sso#UnauthorizedException":throw await $c(n);default:const t=n.body;return kc({output:e,parsedBody:t,errorCode:r})}},kc=Hr(vc),Oc=async(e,t)=>{const n=oo({}),r=e.body,o=so(r,{message:Ar});Object.assign(n,o);const s=new Ec({$metadata:Nc(e),...n});return Vr(s,e.body)},_c=async(e,t)=>{const n=oo({}),r=e.body,o=so(r,{message:Ar});Object.assign(n,o);const s=new xc({$metadata:Nc(e),...n});return Vr(s,e.body)},Rc=async(e,t)=>{const n=oo({}),r=e.body,o=so(r,{message:Ar});Object.assign(n,o);const s=new Sc({$metadata:Nc(e),...n});return Vr(s,e.body)},$c=async(e,t)=>{const n=oo({}),r=e.body,o=so(r,{message:Ar});Object.assign(n,o);const s=new Ic({$metadata:Nc(e),...n});return Vr(s,e.body)},Nc=e=>({httpStatusCode:e.statusCode,requestId:e.headers["x-amzn-requestid"]??e.headers["x-amzn-request-id"]??e.headers["x-amz-request-id"],extendedRequestId:e.headers["x-amz-id-2"],cfId:e.headers["x-amz-cf-id"]}),Dc=e=>!(null==e||""===e||Object.getOwnPropertyNames(e).includes("length")&&0==e.length||Object.getOwnPropertyNames(e).includes("size")&&0==e.size),jc=(e,t)=>((e,t)=>pr(e,t).then((e=>t.utf8Encoder(e))))(e,t).then((e=>e.length?JSON.parse(e):{})),Uc=async(e,t)=>{const n=await jc(e,t);return n.message=n.message??n.Message,n},Fc=(e,t)=>{const n=e=>{let t=e;return"number"==typeof t&&(t=t.toString()),t.indexOf(",")>=0&&(t=t.split(",")[0]),t.indexOf(":")>=0&&(t=t.split(":")[0]),t.indexOf("#")>=0&&(t=t.split("#")[1]),t},r=(o=e.headers,s="x-amzn-errortype",Object.keys(o).find((e=>e.toLowerCase()===s.toLowerCase())));var o,s;return void 0!==r?n(e.headers[r]):void 0!==t.code?n(t.code):void 0!==t.__type?n(t.__type):void 0};class Mc extends fr{static getEndpointParameterInstructions(){return{UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}}}constructor(e){super(),this.input=e}resolveMiddleware(e,t,n){this.middlewareStack.use(yn(t,this.serialize,this.deserialize)),this.middlewareStack.use(bn(t,Mc.getEndpointParameterInstructions()));const r=e.concat(this.middlewareStack),{logger:o}=t,s={logger:o,clientName:"SSOClient",commandName:"GetRoleCredentialsCommand",inputFilterSensitiveLog:Ac,outputFilterSensitiveLog:Tc},{requestHandler:i}=t;return r.resolve((e=>i.handle(e.request,n||{})),s)}serialize(e,t){return(async(e,t)=>{const{hostname:n,protocol:r="https",port:o,path:s}=await t.endpoint(),i=oo({},Dc,{"x-amz-sso_bearer_token":e.accessToken}),a=`${s?.endsWith("/")?s.slice(0,-1):s||""}/federation/credentials`,c=oo({role_name:[,Sr(e.roleName,"roleName")],account_id:[,Sr(e.accountId,"accountId")]});return new b({protocol:r,hostname:n,port:o,method:"GET",headers:i,path:a,query:c,body:void 0})})(e,t)}deserialize(e,t){return(async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return Cc(e,t);const n=oo({$metadata:Nc(e)}),r=Sr(Ir(await jc(e.body,t)),"body"),o=so(r,{roleCredentials:po});return Object.assign(n,o),n})(e,t)}}var Lc="3.387.0",zc="required",qc="fn",Bc="argv",Wc="ref",Vc="PartitionResult",Hc="tree",Kc="error",Gc="endpoint",Xc={[zc]:!1,type:"String"},Jc={[zc]:!0,default:!1,type:"Boolean"},Yc={[Wc]:"Endpoint"},Zc={[qc]:"booleanEquals",[Bc]:[{[Wc]:"UseFIPS"},!0]},Qc={[qc]:"booleanEquals",[Bc]:[{[Wc]:"UseDualStack"},!0]},eu={},tu={[qc]:"booleanEquals",[Bc]:[!0,{[qc]:"getAttr",[Bc]:[{[Wc]:Vc},"supportsFIPS"]}]},nu={[qc]:"booleanEquals",[Bc]:[!0,{[qc]:"getAttr",[Bc]:[{[Wc]:Vc},"supportsDualStack"]}]},ru=[Yc],ou=[Zc],su=[Qc],iu={version:"1.0",parameters:{Region:Xc,UseDualStack:Jc,UseFIPS:Jc,Endpoint:Xc},rules:[{conditions:[{[qc]:"aws.partition",[Bc]:[{[Wc]:"Region"}],assign:Vc}],type:Hc,rules:[{conditions:[{[qc]:"isSet",[Bc]:ru},{[qc]:"parseURL",[Bc]:ru,assign:"url"}],type:Hc,rules:[{conditions:ou,error:"Invalid Configuration: FIPS and custom endpoint are not supported",type:Kc},{type:Hc,rules:[{conditions:su,error:"Invalid Configuration: Dualstack and custom endpoint are not supported",type:Kc},{endpoint:{url:Yc,properties:eu,headers:eu},type:Gc}]}]},{conditions:[Zc,Qc],type:Hc,rules:[{conditions:[tu,nu],type:Hc,rules:[{endpoint:{url:"https://oidc-fips.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:eu,headers:eu},type:Gc}]},{error:"FIPS and DualStack are enabled, but this partition does not support one or both",type:Kc}]},{conditions:ou,type:Hc,rules:[{conditions:[tu],type:Hc,rules:[{type:Hc,rules:[{endpoint:{url:"https://oidc-fips.{Region}.{PartitionResult#dnsSuffix}",properties:eu,headers:eu},type:Gc}]}]},{error:"FIPS is enabled but this partition does not support FIPS",type:Kc}]},{conditions:su,type:Hc,rules:[{conditions:[nu],type:Hc,rules:[{endpoint:{url:"https://oidc.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:eu,headers:eu},type:Gc}]},{error:"DualStack is enabled but this partition does not support DualStack",type:Kc}]},{endpoint:{url:"https://oidc.{Region}.{PartitionResult#dnsSuffix}",properties:eu,headers:eu},type:Gc}]}]},au=(e,t={})=>Mt(iu,{endpointParams:e,logger:t.logger}),cu=e=>{Jr(process.version);const t=gc(e),n=()=>t().then(Gr),r=(e=>({apiVersion:"2019-06-10",base64Decoder:e?.base64Decoder??rr,base64Encoder:e?.base64Encoder??or,disableHostPrefix:e?.disableHostPrefix??!1,endpointProvider:e?.endpointProvider??au,logger:e?.logger??new Yn,serviceId:e?.serviceId??"SSO OIDC",urlParser:e?.urlParser??fn,utf8Decoder:e?.utf8Decoder??Ee,utf8Encoder:e?.utf8Encoder??Se}))(e);return{...r,...e,runtime:"node",defaultsMode:t,bodyLengthChecker:e?.bodyLengthChecker??Ba,defaultUserAgentProvider:e?.defaultUserAgentProvider??La({serviceId:r.serviceId,clientVersion:Lc}),maxAttempts:e?.maxAttempts??wa(qn),region:e?.region??wa(Yt,Zt),requestHandler:e?.requestHandler??new ur(n),retryMode:e?.retryMode??wa({...Wn,default:async()=>(await n()).retryMode||xn}),sha256:e?.sha256??za.bind(null,"sha256"),streamCollector:e?.streamCollector??lr,useDualstackEndpoint:e?.useDualstackEndpoint??wa(Xt),useFipsEndpoint:e?.useFipsEndpoint??wa(Jt)}},uu=class extends tr{constructor(...[e]){const t=cu(e||{}),n=(r=t,{...r,useDualstackEndpoint:r.useDualstackEndpoint??!1,useFipsEndpoint:r.useFipsEndpoint??!1,defaultSigningName:"awsssooidc"});var r;const o=tn(n),s=vn(o),i=at(Bn(s));super(i),this.config=i,this.middlewareStack.use(Xn(this.config)),this.middlewareStack.use(on(this.config)),this.middlewareStack.use(x(this.config)),this.middlewareStack.use(I(this.config)),this.middlewareStack.use(T(this.config)),this.middlewareStack.use(Ht(this.config))}destroy(){super.destroy()}},du=class e extends Wr{constructor(t){super(t),Object.setPrototypeOf(this,e.prototype)}},lu=class e extends du{constructor(t){super({name:"AccessDeniedException",$fault:"client",...t}),this.name="AccessDeniedException",this.$fault="client",Object.setPrototypeOf(this,e.prototype),this.error=t.error,this.error_description=t.error_description}},pu=class e extends du{constructor(t){super({name:"AuthorizationPendingException",$fault:"client",...t}),this.name="AuthorizationPendingException",this.$fault="client",Object.setPrototypeOf(this,e.prototype),this.error=t.error,this.error_description=t.error_description}},fu=class e extends du{constructor(t){super({name:"ExpiredTokenException",$fault:"client",...t}),this.name="ExpiredTokenException",this.$fault="client",Object.setPrototypeOf(this,e.prototype),this.error=t.error,this.error_description=t.error_description}},hu=class e extends du{constructor(t){super({name:"InternalServerException",$fault:"server",...t}),this.name="InternalServerException",this.$fault="server",Object.setPrototypeOf(this,e.prototype),this.error=t.error,this.error_description=t.error_description}},gu=class e extends du{constructor(t){super({name:"InvalidClientException",$fault:"client",...t}),this.name="InvalidClientException",this.$fault="client",Object.setPrototypeOf(this,e.prototype),this.error=t.error,this.error_description=t.error_description}},mu=class e extends du{constructor(t){super({name:"InvalidGrantException",$fault:"client",...t}),this.name="InvalidGrantException",this.$fault="client",Object.setPrototypeOf(this,e.prototype),this.error=t.error,this.error_description=t.error_description}},yu=class e extends du{constructor(t){super({name:"InvalidRequestException",$fault:"client",...t}),this.name="InvalidRequestException",this.$fault="client",Object.setPrototypeOf(this,e.prototype),this.error=t.error,this.error_description=t.error_description}},wu=class e extends du{constructor(t){super({name:"InvalidScopeException",$fault:"client",...t}),this.name="InvalidScopeException",this.$fault="client",Object.setPrototypeOf(this,e.prototype),this.error=t.error,this.error_description=t.error_description}},bu=class e extends du{constructor(t){super({name:"SlowDownException",$fault:"client",...t}),this.name="SlowDownException",this.$fault="client",Object.setPrototypeOf(this,e.prototype),this.error=t.error,this.error_description=t.error_description}},vu=class e extends du{constructor(t){super({name:"UnauthorizedClientException",$fault:"client",...t}),this.name="UnauthorizedClientException",this.$fault="client",Object.setPrototypeOf(this,e.prototype),this.error=t.error,this.error_description=t.error_description}},Eu=class e extends du{constructor(t){super({name:"UnsupportedGrantTypeException",$fault:"client",...t}),this.name="UnsupportedGrantTypeException",this.$fault="client",Object.setPrototypeOf(this,e.prototype),this.error=t.error,this.error_description=t.error_description}},xu=class e extends du{constructor(t){super({name:"InvalidClientMetadataException",$fault:"client",...t}),this.name="InvalidClientMetadataException",this.$fault="client",Object.setPrototypeOf(this,e.prototype),this.error=t.error,this.error_description=t.error_description}},Su=async(e,t)=>{const n={...e,body:await zu(e.body,t)},r=qu(e,n.body);switch(r){case"AccessDeniedException":case"com.amazonaws.ssooidc#AccessDeniedException":throw await Tu(n);case"AuthorizationPendingException":case"com.amazonaws.ssooidc#AuthorizationPendingException":throw await Cu(n);case"ExpiredTokenException":case"com.amazonaws.ssooidc#ExpiredTokenException":throw await ku(n);case"InternalServerException":case"com.amazonaws.ssooidc#InternalServerException":throw await Ou(n);case"InvalidClientException":case"com.amazonaws.ssooidc#InvalidClientException":throw await _u(n);case"InvalidGrantException":case"com.amazonaws.ssooidc#InvalidGrantException":throw await $u(n);case"InvalidRequestException":case"com.amazonaws.ssooidc#InvalidRequestException":throw await Nu(n);case"InvalidScopeException":case"com.amazonaws.ssooidc#InvalidScopeException":throw await Du(n);case"SlowDownException":case"com.amazonaws.ssooidc#SlowDownException":throw await ju(n);case"UnauthorizedClientException":case"com.amazonaws.ssooidc#UnauthorizedClientException":throw await Uu(n);case"UnsupportedGrantTypeException":case"com.amazonaws.ssooidc#UnsupportedGrantTypeException":throw await Fu(n);default:const t=n.body;return Pu({output:e,parsedBody:t,errorCode:r})}},Iu=async(e,t)=>{const n={...e,body:await zu(e.body,t)},r=qu(e,n.body);switch(r){case"InternalServerException":case"com.amazonaws.ssooidc#InternalServerException":throw await Ou(n);case"InvalidClientMetadataException":case"com.amazonaws.ssooidc#InvalidClientMetadataException":throw await Ru(n);case"InvalidRequestException":case"com.amazonaws.ssooidc#InvalidRequestException":throw await Nu(n);case"InvalidScopeException":case"com.amazonaws.ssooidc#InvalidScopeException":throw await Du(n);default:const t=n.body;return Pu({output:e,parsedBody:t,errorCode:r})}},Au=async(e,t)=>{const n={...e,body:await zu(e.body,t)},r=qu(e,n.body);switch(r){case"InternalServerException":case"com.amazonaws.ssooidc#InternalServerException":throw await Ou(n);case"InvalidClientException":case"com.amazonaws.ssooidc#InvalidClientException":throw await _u(n);case"InvalidRequestException":case"com.amazonaws.ssooidc#InvalidRequestException":throw await Nu(n);case"SlowDownException":case"com.amazonaws.ssooidc#SlowDownException":throw await ju(n);case"UnauthorizedClientException":case"com.amazonaws.ssooidc#UnauthorizedClientException":throw await Uu(n);default:const t=n.body;return Pu({output:e,parsedBody:t,errorCode:r})}},Pu=Hr(du),Tu=async(e,t)=>{const n=oo({}),r=e.body,o=so(r,{error:Ar,error_description:Ar});Object.assign(n,o);const s=new lu({$metadata:Mu(e),...n});return Vr(s,e.body)},Cu=async(e,t)=>{const n=oo({}),r=e.body,o=so(r,{error:Ar,error_description:Ar});Object.assign(n,o);const s=new pu({$metadata:Mu(e),...n});return Vr(s,e.body)},ku=async(e,t)=>{const n=oo({}),r=e.body,o=so(r,{error:Ar,error_description:Ar});Object.assign(n,o);const s=new fu({$metadata:Mu(e),...n});return Vr(s,e.body)},Ou=async(e,t)=>{const n=oo({}),r=e.body,o=so(r,{error:Ar,error_description:Ar});Object.assign(n,o);const s=new hu({$metadata:Mu(e),...n});return Vr(s,e.body)},_u=async(e,t)=>{const n=oo({}),r=e.body,o=so(r,{error:Ar,error_description:Ar});Object.assign(n,o);const s=new gu({$metadata:Mu(e),...n});return Vr(s,e.body)},Ru=async(e,t)=>{const n=oo({}),r=e.body,o=so(r,{error:Ar,error_description:Ar});Object.assign(n,o);const s=new xu({$metadata:Mu(e),...n});return Vr(s,e.body)},$u=async(e,t)=>{const n=oo({}),r=e.body,o=so(r,{error:Ar,error_description:Ar});Object.assign(n,o);const s=new mu({$metadata:Mu(e),...n});return Vr(s,e.body)},Nu=async(e,t)=>{const n=oo({}),r=e.body,o=so(r,{error:Ar,error_description:Ar});Object.assign(n,o);const s=new yu({$metadata:Mu(e),...n});return Vr(s,e.body)},Du=async(e,t)=>{const n=oo({}),r=e.body,o=so(r,{error:Ar,error_description:Ar});Object.assign(n,o);const s=new wu({$metadata:Mu(e),...n});return Vr(s,e.body)},ju=async(e,t)=>{const n=oo({}),r=e.body,o=so(r,{error:Ar,error_description:Ar});Object.assign(n,o);const s=new bu({$metadata:Mu(e),...n});return Vr(s,e.body)},Uu=async(e,t)=>{const n=oo({}),r=e.body,o=so(r,{error:Ar,error_description:Ar});Object.assign(n,o);const s=new vu({$metadata:Mu(e),...n});return Vr(s,e.body)},Fu=async(e,t)=>{const n=oo({}),r=e.body,o=so(r,{error:Ar,error_description:Ar});Object.assign(n,o);const s=new Eu({$metadata:Mu(e),...n});return Vr(s,e.body)},Mu=e=>({httpStatusCode:e.statusCode,requestId:e.headers["x-amzn-requestid"]??e.headers["x-amzn-request-id"]??e.headers["x-amz-request-id"],extendedRequestId:e.headers["x-amz-id-2"],cfId:e.headers["x-amz-cf-id"]}),Lu=(e,t)=>((e,t)=>pr(e,t).then((e=>t.utf8Encoder(e))))(e,t).then((e=>e.length?JSON.parse(e):{})),zu=async(e,t)=>{const n=await Lu(e,t);return n.message=n.message??n.Message,n},qu=(e,t)=>{const n=e=>{let t=e;return"number"==typeof t&&(t=t.toString()),t.indexOf(",")>=0&&(t=t.split(",")[0]),t.indexOf(":")>=0&&(t=t.split(":")[0]),t.indexOf("#")>=0&&(t=t.split("#")[1]),t},r=(o=e.headers,s="x-amzn-errortype",Object.keys(o).find((e=>e.toLowerCase()===s.toLowerCase())));var o,s;return void 0!==r?n(e.headers[r]):void 0!==t.code?n(t.code):void 0!==t.__type?n(t.__type):void 0},Bu=class e extends fr{constructor(e){super(),this.input=e}static getEndpointParameterInstructions(){return{UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}}}resolveMiddleware(t,n,r){this.middlewareStack.use(yn(n,this.serialize,this.deserialize)),this.middlewareStack.use(bn(n,e.getEndpointParameterInstructions()));const o=t.concat(this.middlewareStack),{logger:s}=n,i={logger:s,clientName:"SSOOIDCClient",commandName:"CreateTokenCommand",inputFilterSensitiveLog:e=>e,outputFilterSensitiveLog:e=>e},{requestHandler:a}=n;return o.resolve((e=>a.handle(e.request,r||{})),i)}serialize(e,t){return(async(e,t)=>{const{hostname:n,protocol:r="https",port:o,path:s}=await t.endpoint(),i=`${s?.endsWith("/")?s.slice(0,-1):s||""}/token`;let a;return a=JSON.stringify(so(e,{clientId:[],clientSecret:[],code:[],deviceCode:[],grantType:[],redirectUri:[],refreshToken:[],scope:e=>po(e)})),new b({protocol:r,hostname:n,port:o,method:"POST",headers:{"content-type":"application/json"},path:i,body:a})})(e,t)}deserialize(e,t){return(async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return Su(e,t);const n=oo({$metadata:Mu(e)}),r=Sr(Ir(await Lu(e.body,t)),"body"),o=so(r,{accessToken:Ar,expiresIn:wr,idToken:Ar,refreshToken:Ar,tokenType:Ar});return Object.assign(n,o),n})(e,t)}},Wu={CreateTokenCommand:Bu,RegisterClientCommand:class e extends fr{constructor(e){super(),this.input=e}static getEndpointParameterInstructions(){return{UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}}}resolveMiddleware(t,n,r){this.middlewareStack.use(yn(n,this.serialize,this.deserialize)),this.middlewareStack.use(bn(n,e.getEndpointParameterInstructions()));const o=t.concat(this.middlewareStack),{logger:s}=n,i={logger:s,clientName:"SSOOIDCClient",commandName:"RegisterClientCommand",inputFilterSensitiveLog:e=>e,outputFilterSensitiveLog:e=>e},{requestHandler:a}=n;return o.resolve((e=>a.handle(e.request,r||{})),i)}serialize(e,t){return(async(e,t)=>{const{hostname:n,protocol:r="https",port:o,path:s}=await t.endpoint(),i=`${s?.endsWith("/")?s.slice(0,-1):s||""}/client/register`;let a;return a=JSON.stringify(so(e,{clientName:[],clientType:[],scopes:e=>po(e)})),new b({protocol:r,hostname:n,port:o,method:"POST",headers:{"content-type":"application/json"},path:i,body:a})})(e,t)}deserialize(e,t){return(async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return Iu(e,t);const n=oo({$metadata:Mu(e)}),r=Sr(Ir(await Lu(e.body,t)),"body"),o=so(r,{authorizationEndpoint:Ar,clientId:Ar,clientIdIssuedAt:yr,clientSecret:Ar,clientSecretExpiresAt:yr,tokenEndpoint:Ar});return Object.assign(n,o),n})(e,t)}},StartDeviceAuthorizationCommand:class e extends fr{constructor(e){super(),this.input=e}static getEndpointParameterInstructions(){return{UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}}}resolveMiddleware(t,n,r){this.middlewareStack.use(yn(n,this.serialize,this.deserialize)),this.middlewareStack.use(bn(n,e.getEndpointParameterInstructions()));const o=t.concat(this.middlewareStack),{logger:s}=n,i={logger:s,clientName:"SSOOIDCClient",commandName:"StartDeviceAuthorizationCommand",inputFilterSensitiveLog:e=>e,outputFilterSensitiveLog:e=>e},{requestHandler:a}=n;return o.resolve((e=>a.handle(e.request,r||{})),i)}serialize(e,t){return(async(e,t)=>{const{hostname:n,protocol:r="https",port:o,path:s}=await t.endpoint(),i=`${s?.endsWith("/")?s.slice(0,-1):s||""}/device_authorization`;let a;return a=JSON.stringify(so(e,{clientId:[],clientSecret:[],startUrl:[]})),new b({protocol:r,hostname:n,port:o,method:"POST",headers:{"content-type":"application/json"},path:i,body:a})})(e,t)}deserialize(e,t){return(async(e,t)=>{if(200!==e.statusCode&&e.statusCode>=300)return Au(e,t);const n=oo({$metadata:Mu(e)}),r=Sr(Ir(await Lu(e.body,t)),"body"),o=so(r,{deviceCode:Ar,expiresIn:wr,interval:wr,userCode:Ar,verificationUri:Ar,verificationUriComplete:Ar});return Object.assign(n,o),n})(e,t)}}};((e,t)=>{for(const n of Object.keys(e)){const r=e[n],o=async function(e,t,n){const o=new r(e);if("function"==typeof t)this.send(o,t);else{if("function"!=typeof n)return this.send(o,t);if("object"!=typeof t)throw new Error("Expected http options but got "+typeof t);this.send(o,t||{},n)}},s=(n[0].toLowerCase()+n.slice(1)).replace(/Command$/,"");t.prototype[s]=o}})(Wu,class extends uu{});const Vu="To refresh this SSO session run 'aws sso login' with the corresponding profile.",Hu={},Ku=(e,t)=>{const n=(e=>{if(Hu[e])return Hu[e];const t=new uu({region:e});return Hu[e]=t,t})(t);return n.send(new Bu({clientId:e.clientId,clientSecret:e.clientSecret,refreshToken:e.refreshToken,grantType:"refresh_token"}))},Gu=e=>{if(e.expiration&&e.expiration.getTime()<Date.now())throw new O(`Token is expired. ${Vu}`,!1)},Xu=(e,t,n=!1)=>{if(void 0===t)throw new O(`Value not present for '${e}' in SSO Token${n?". Cannot refresh":""}. ${Vu}`,!1)},{writeFile:Ju}=c.promises,Yu=new Date(0),Zu=(e={})=>async()=>{const t=await ra(e),n=Fi(e),r=t[n];if(!r)throw new O(`Profile '${n}' could not be found in shared credentials file.`,!1);if(!r.sso_session)throw new O(`Profile '${n}' is missing required property 'sso_session'.`);const o=r.sso_session,s=(await na(e))[o];if(!s)throw new O(`Sso session '${o}' could not be found in shared credentials file.`,!1);for(const e of["sso_start_url","sso_region"])if(!s[e])throw new O(`Sso session '${o}' is missing required property '${e}'.`,!1);s.sso_start_url;const i=s.sso_region;let a;try{a=await zi(o)}catch(e){throw new O(`The SSO session token associated with profile=${n} was not found or is invalid. ${Vu}`,!1)}Xu("accessToken",a.accessToken),Xu("expiresAt",a.expiresAt);const{accessToken:c,expiresAt:u}=a,d={token:c,expiration:new Date(u)};if(d.expiration.getTime()-Date.now()>3e5)return d;if(Date.now()-Yu.getTime()<3e4)return Gu(d),d;Xu("clientId",a.clientId,!0),Xu("clientSecret",a.clientSecret,!0),Xu("refreshToken",a.refreshToken,!0);try{Yu.setTime(Date.now());const e=await Ku(a,i);Xu("accessToken",e.accessToken),Xu("expiresIn",e.expiresIn);const t=new Date(Date.now()+1e3*e.expiresIn);try{await((e,t)=>{const n=Mi(e),r=JSON.stringify(t,null,2);return Ju(n,r)})(o,{...a,accessToken:e.accessToken,expiresAt:t.toISOString(),refreshToken:e.refreshToken})}catch(e){}return{token:e.accessToken,expiration:t}}catch(e){return Gu(d),d}},Qu=!1,ed=async({ssoStartUrl:e,ssoSession:t,ssoAccountId:n,ssoRegion:r,ssoRoleName:o,ssoClient:s,profile:i})=>{let a;const c="To refresh this SSO session run aws sso login with the corresponding profile.";if(t)try{const e=await Zu({profile:i})();a={accessToken:e.token,expiresAt:new Date(e.expiration).toISOString()}}catch(e){throw new k(e.message,Qu)}else try{a=await zi(e)}catch(e){throw new k(`The SSO session associated with this profile is invalid. ${c}`,Qu)}if(new Date(a.expiresAt).getTime()-Date.now()<=0)throw new k(`The SSO session associated with this profile has expired. ${c}`,Qu);const{accessToken:u}=a,d=s||new bc({region:r});let l;try{l=await d.send(new Mc({accountId:n,roleName:o,accessToken:u}))}catch(e){throw k.from(e,Qu)}const{roleCredentials:{accessKeyId:p,secretAccessKey:f,sessionToken:h,expiration:g}={}}=l;if(!(p&&f&&h&&g))throw new k("SSO returns an invalid temporary credential.",Qu);return{accessKeyId:p,secretAccessKey:f,sessionToken:h,expiration:new Date(g)}},td=e=>{const{sso_start_url:t,sso_account_id:n,sso_region:r,sso_role_name:o}=e;if(!(t&&n&&r&&o))throw new k(`Profile is configured with invalid SSO credentials. Required parameters "sso_account_id", "sso_region", "sso_role_name", "sso_start_url". Got ${Object.keys(e).join(", ")}\nReference: https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-sso.html`,!1);return e},nd=(e={})=>async()=>{const{ssoStartUrl:t,ssoAccountId:n,ssoRegion:r,ssoRoleName:o,ssoClient:s,ssoSession:i}=e,a=Fi(e);if(t||n||r||o||i){if(t&&n&&r&&o)return ed({ssoStartUrl:t,ssoSession:i,ssoAccountId:n,ssoRegion:r,ssoRoleName:o,ssoClient:s,profile:a});throw new k('Incomplete configuration. The fromSSO() argument hash must include "ssoStartUrl", "ssoAccountId", "ssoRegion", "ssoRoleName"')}{const n=(await ra(e))[a];if(!n)throw new k(`Profile ${a} was not found.`);if(!Fa(n))throw new k(`Profile ${a} is not configured with SSO credentials.`);if(n?.sso_session){const o=(await na(e))[n.sso_session],s=` configurations in profile ${a} and sso-session ${n.sso_session}`;if(r&&r!==o.sso_region)throw new k("Conflicting SSO region"+s,!1);if(t&&t!==o.sso_start_url)throw new k("Conflicting SSO start_url"+s,!1);n.sso_region=o.sso_region,n.sso_start_url=o.sso_start_url}const{sso_start_url:o,sso_account_id:i,sso_region:c,sso_role_name:u,sso_session:d}=td(n);return ed({ssoStartUrl:o,ssoSession:d,ssoAccountId:i,ssoRegion:c,ssoRoleName:u,ssoClient:s,profile:a})}},rd=e=>Boolean(e)&&"object"==typeof e&&"string"==typeof e.aws_access_key_id&&"string"==typeof e.aws_secret_access_key&&["undefined","string"].indexOf(typeof e.aws_session_token)>-1,od=e=>Promise.resolve({accessKeyId:e.aws_access_key_id,secretAccessKey:e.aws_secret_access_key,sessionToken:e.aws_session_token}),sd=(e={})=>async()=>{const t=e?.webIdentityTokenFile??process.env.AWS_WEB_IDENTITY_TOKEN_FILE,n=e?.roleArn??process.env.AWS_ROLE_ARN,r=e?.roleSessionName??process.env.AWS_ROLE_SESSION_NAME;if(!t||!n)throw new k("Web identity configuration not specified");return(e=>()=>{const{roleArn:t,roleSessionName:n,webIdentityToken:r,providerId:o,policyArns:s,policy:i,durationSeconds:a,roleAssumerWithWebIdentity:c}=e;if(!c)throw new k(`Role Arn '${t}' needs to be assumed with web identity, but no role assumption callback was provided.`,!1);return c({RoleArn:t,RoleSessionName:n??`aws-sdk-js-session-${Date.now()}`,WebIdentityToken:r,ProviderId:o,PolicyArns:s,Policy:i,DurationSeconds:a})})({...e,webIdentityToken:c.readFileSync(t,{encoding:"ascii"}),roleArn:n,roleSessionName:r})()},id=async(e,t,n,r={})=>{const o=t[e];if(Object.keys(r).length>0&&rd(o))return od(o);if(s=o,Boolean(s)&&"object"==typeof s&&"string"==typeof s.role_arn&&["undefined","string"].indexOf(typeof s.role_session_name)>-1&&["undefined","string"].indexOf(typeof s.external_id)>-1&&["undefined","string"].indexOf(typeof s.mfa_serial)>-1&&($a(s)||Na(s)))return Da(e,t,n,r);var s;if(rd(o))return od(o);if((e=>Boolean(e)&&"object"==typeof e&&"string"==typeof e.web_identity_token_file&&"string"==typeof e.role_arn&&["undefined","string"].indexOf(typeof e.role_session_name)>-1)(o))return(async(e,t)=>sd({webIdentityTokenFile:e.web_identity_token_file,roleArn:e.role_arn,roleSessionName:e.role_session_name,roleAssumerWithWebIdentity:t.roleAssumerWithWebIdentity})())(o,n);if((e=>Boolean(e)&&"object"==typeof e&&"string"==typeof e.credential_process)(o))return(async(e,t)=>Ua({...e,profile:t})())(n,e);if(Fa(o))return(e=>{const{sso_start_url:t,sso_account_id:n,sso_session:r,sso_region:o,sso_role_name:s}=td(e);return nd({ssoStartUrl:t,ssoAccountId:n,ssoSession:r,ssoRegion:o,ssoRoleName:s})()})(o);throw new k(`Profile ${e} could not be found or parsed in shared credentials file.`)},ad=(e={})=>R(_(...e.profile||process.env[Ui]?[]:[Di()],nd(e),((e={})=>async()=>{const t=await ra(e);return id(Fi(e),t,e)})(e),Ua(e),sd(e),(e=>process.env[da]||process.env[ua]?pa(e):process.env.AWS_EC2_METADATA_DISABLED?async()=>{throw new k("EC2 Instance Metadata Service access disabled")}:Ca(e))(e),(async()=>{throw new k("Could not load credentials from any providers",!1)})),(e=>void 0!==e.expiration&&e.expiration.getTime()-Date.now()<3e5),(e=>void 0!==e.expiration)),cd="required",ud="type",dd="fn",ld="argv",pd="ref",fd="booleanEquals",hd="tree",gd="stringEquals",md="sigv4",yd="us-east-1",wd="endpoint",bd="https://sts.{Region}.{PartitionResult#dnsSuffix}",vd="error",Ed="getAttr",xd={[cd]:!1,[ud]:"String"},Sd={[cd]:!0,default:!1,[ud]:"Boolean"},Id={[pd]:"Endpoint"},Ad={[dd]:"isSet",[ld]:[{[pd]:"Region"}]},Pd={[pd]:"Region"},Td={[dd]:"aws.partition",[ld]:[Pd],assign:"PartitionResult"},Cd={[pd]:"UseFIPS"},kd={[pd]:"UseDualStack"},Od={url:"https://sts.amazonaws.com",properties:{authSchemes:[{name:md,signingName:"sts",signingRegion:yd}]},headers:{}},_d={},Rd={conditions:[{[dd]:gd,[ld]:[Pd,"aws-global"]}],[wd]:Od,[ud]:wd},$d={[dd]:fd,[ld]:[Cd,!0]},Nd={[dd]:fd,[ld]:[kd,!0]},Dd={[dd]:fd,[ld]:[!0,{[dd]:Ed,[ld]:[{[pd]:"PartitionResult"},"supportsFIPS"]}]},jd={[pd]:"PartitionResult"},Ud={[dd]:fd,[ld]:[!0,{[dd]:Ed,[ld]:[jd,"supportsDualStack"]}]},Fd=[{[dd]:"isSet",[ld]:[Id]}],Md=[$d],Ld=[Nd],zd={version:"1.0",parameters:{Region:xd,UseDualStack:Sd,UseFIPS:Sd,Endpoint:xd,UseGlobalEndpoint:Sd},rules:[{conditions:[{[dd]:fd,[ld]:[{[pd]:"UseGlobalEndpoint"},!0]},{[dd]:"not",[ld]:Fd},Ad,Td,{[dd]:fd,[ld]:[Cd,false]},{[dd]:fd,[ld]:[kd,false]}],[ud]:hd,rules:[{conditions:[{[dd]:gd,[ld]:[Pd,"ap-northeast-1"]}],endpoint:Od,[ud]:wd},{conditions:[{[dd]:gd,[ld]:[Pd,"ap-south-1"]}],endpoint:Od,[ud]:wd},{conditions:[{[dd]:gd,[ld]:[Pd,"ap-southeast-1"]}],endpoint:Od,[ud]:wd},{conditions:[{[dd]:gd,[ld]:[Pd,"ap-southeast-2"]}],endpoint:Od,[ud]:wd},Rd,{conditions:[{[dd]:gd,[ld]:[Pd,"ca-central-1"]}],endpoint:Od,[ud]:wd},{conditions:[{[dd]:gd,[ld]:[Pd,"eu-central-1"]}],endpoint:Od,[ud]:wd},{conditions:[{[dd]:gd,[ld]:[Pd,"eu-north-1"]}],endpoint:Od,[ud]:wd},{conditions:[{[dd]:gd,[ld]:[Pd,"eu-west-1"]}],endpoint:Od,[ud]:wd},{conditions:[{[dd]:gd,[ld]:[Pd,"eu-west-2"]}],endpoint:Od,[ud]:wd},{conditions:[{[dd]:gd,[ld]:[Pd,"eu-west-3"]}],endpoint:Od,[ud]:wd},{conditions:[{[dd]:gd,[ld]:[Pd,"sa-east-1"]}],endpoint:Od,[ud]:wd},{conditions:[{[dd]:gd,[ld]:[Pd,yd]}],endpoint:Od,[ud]:wd},{conditions:[{[dd]:gd,[ld]:[Pd,"us-east-2"]}],endpoint:Od,[ud]:wd},{conditions:[{[dd]:gd,[ld]:[Pd,"us-west-1"]}],endpoint:Od,[ud]:wd},{conditions:[{[dd]:gd,[ld]:[Pd,"us-west-2"]}],endpoint:Od,[ud]:wd},{endpoint:{url:bd,properties:{authSchemes:[{name:md,signingName:"sts",signingRegion:"{Region}"}]},headers:_d},[ud]:wd}]},{conditions:Fd,[ud]:hd,rules:[{conditions:Md,error:"Invalid Configuration: FIPS and custom endpoint are not supported",[ud]:vd},{[ud]:hd,rules:[{conditions:Ld,error:"Invalid Configuration: Dualstack and custom endpoint are not supported",[ud]:vd},{endpoint:{url:Id,properties:_d,headers:_d},[ud]:wd}]}]},{[ud]:hd,rules:[{conditions:[Ad],[ud]:hd,rules:[{conditions:[Td],[ud]:hd,rules:[{conditions:[$d,Nd],[ud]:hd,rules:[{conditions:[Dd,Ud],[ud]:hd,rules:[{[ud]:hd,rules:[{endpoint:{url:"https://sts-fips.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:_d,headers:_d},[ud]:wd}]}]},{error:"FIPS and DualStack are enabled, but this partition does not support one or both",[ud]:vd}]},{conditions:Md,[ud]:hd,rules:[{conditions:[Dd],[ud]:hd,rules:[{[ud]:hd,rules:[{conditions:[{[dd]:gd,[ld]:["aws-us-gov",{[dd]:Ed,[ld]:[jd,"name"]}]}],endpoint:{url:"https://sts.{Region}.amazonaws.com",properties:_d,headers:_d},[ud]:wd},{endpoint:{url:"https://sts-fips.{Region}.{PartitionResult#dnsSuffix}",properties:_d,headers:_d},[ud]:wd}]}]},{error:"FIPS is enabled but this partition does not support FIPS",[ud]:vd}]},{conditions:Ld,[ud]:hd,rules:[{conditions:[Ud],[ud]:hd,rules:[{[ud]:hd,rules:[{endpoint:{url:"https://sts.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:_d,headers:_d},[ud]:wd}]}]},{error:"DualStack is enabled but this partition does not support DualStack",[ud]:vd}]},{[ud]:hd,rules:[Rd,{endpoint:{url:bd,properties:_d,headers:_d},[ud]:wd}]}]}]},{error:"Invalid Configuration: Missing Region",[ud]:vd}]}]},qd=(e,t={})=>Mt(zd,{endpointParams:e,logger:t.logger}),Bd=e=>{Jr(process.version);const t=gc(e),n=()=>t().then(Gr),r=(e=>({apiVersion:"2011-06-15",base64Decoder:e?.base64Decoder??rr,base64Encoder:e?.base64Encoder??or,disableHostPrefix:e?.disableHostPrefix??!1,endpointProvider:e?.endpointProvider??qd,extensions:e?.extensions??[],logger:e?.logger??new Yn,serviceId:e?.serviceId??"STS",urlParser:e?.urlParser??fn,utf8Decoder:e?.utf8Decoder??Ee,utf8Encoder:e?.utf8Encoder??Se}))(e);return{...r,...e,runtime:"node",defaultsMode:t,bodyLengthChecker:e?.bodyLengthChecker??Ba,credentialDefaultProvider:e?.credentialDefaultProvider??(o=ad,e=>o({roleAssumer:$i(e,e.stsClientCtor),roleAssumerWithWebIdentity:Ni(e,e.stsClientCtor),...e})),defaultUserAgentProvider:e?.defaultUserAgentProvider??La({serviceId:r.serviceId,clientVersion:ho}),maxAttempts:e?.maxAttempts??wa(qn),region:e?.region??wa(Yt,Zt),requestHandler:e?.requestHandler??new ur(n),retryMode:e?.retryMode??wa({...Wn,default:async()=>(await n()).retryMode||xn}),sha256:e?.sha256??za.bind(null,"sha256"),streamCollector:e?.streamCollector??lr,useDualstackEndpoint:e?.useDualstackEndpoint??wa(Xt),useFipsEndpoint:e?.useFipsEndpoint??wa(Jt)};var o};class Wd extends tr{constructor(...[e]){const t=Bd(e||{}),n=(r=t,{...r,useDualstackEndpoint:r.useDualstackEndpoint??!1,useFipsEndpoint:r.useFipsEndpoint??!1,useGlobalEndpoint:r.useGlobalEndpoint??!1,defaultSigningName:"sts"});var r;const o=tn(n),s=vn(o),i=((e,t)=>{const n={...Qr(e)};return t.forEach((e=>e.configure(n))),{...e,...eo(n)}})(at(((e,{stsClientCtor:t})=>et({...e,stsClientCtor:t}))(Bn(s),{stsClientCtor:Wd})),e?.extensions||[]);super(i),this.config=i,this.middlewareStack.use(Xn(this.config)),this.middlewareStack.use(on(this.config)),this.middlewareStack.use(x(this.config)),this.middlewareStack.use(I(this.config)),this.middlewareStack.use(T(this.config)),this.middlewareStack.use(Ht(this.config))}destroy(){super.destroy()}}const Vd=(e,t)=>t?class extends e{constructor(e){super(e);for(const e of t)this.middlewareStack.use(e)}}:e,Hd=(e={},t)=>$i(e,Vd(Wd,t)),Kd=(e={},t)=>Ni(e,Vd(Wd,t)),Gd="required",Xd="fn",Jd="argv",Yd="ref",Zd="isSet",Qd="tree",el="error",tl="endpoint",nl="PartitionResult",rl={[Gd]:!1,type:"String"},ol={[Gd]:!0,default:!1,type:"Boolean"},sl={[Yd]:"Endpoint"},il={[Xd]:"booleanEquals",[Jd]:[{[Yd]:"UseFIPS"},!0]},al={[Xd]:"booleanEquals",[Jd]:[{[Yd]:"UseDualStack"},!0]},cl={},ul={[Xd]:"booleanEquals",[Jd]:[!0,{[Xd]:"getAttr",[Jd]:[{[Yd]:nl},"supportsFIPS"]}]},dl={[Xd]:"booleanEquals",[Jd]:[!0,{[Xd]:"getAttr",[Jd]:[{[Yd]:nl},"supportsDualStack"]}]},ll=[il],pl=[al],fl=[{[Yd]:"Region"}],hl={version:"1.0",parameters:{Region:rl,UseDualStack:ol,UseFIPS:ol,Endpoint:rl},rules:[{conditions:[{[Xd]:Zd,[Jd]:[sl]}],type:Qd,rules:[{conditions:ll,error:"Invalid Configuration: FIPS and custom endpoint are not supported",type:el},{conditions:pl,error:"Invalid Configuration: Dualstack and custom endpoint are not supported",type:el},{endpoint:{url:sl,properties:cl,headers:cl},type:tl}]},{conditions:[{[Xd]:Zd,[Jd]:fl}],type:Qd,rules:[{conditions:[{[Xd]:"aws.partition",[Jd]:fl,assign:nl}],type:Qd,rules:[{conditions:[il,al],type:Qd,rules:[{conditions:[ul,dl],type:Qd,rules:[{endpoint:{url:"https://rekognition-fips.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:cl,headers:cl},type:tl}]},{error:"FIPS and DualStack are enabled, but this partition does not support one or both",type:el}]},{conditions:ll,type:Qd,rules:[{conditions:[ul],type:Qd,rules:[{endpoint:{url:"https://rekognition-fips.{Region}.{PartitionResult#dnsSuffix}",properties:cl,headers:cl},type:tl}]},{error:"FIPS is enabled but this partition does not support FIPS",type:el}]},{conditions:pl,type:Qd,rules:[{conditions:[dl],type:Qd,rules:[{endpoint:{url:"https://rekognition.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:cl,headers:cl},type:tl}]},{error:"DualStack is enabled but this partition does not support DualStack",type:el}]},{endpoint:{url:"https://rekognition.{Region}.{PartitionResult#dnsSuffix}",properties:cl,headers:cl},type:tl}]}]},{error:"Invalid Configuration: Missing Region",type:el}]},gl=(e,t={})=>Mt(hl,{endpointParams:e,logger:t.logger}),ml=e=>{Jr(process.version);const t=gc(e),n=()=>t().then(Gr),r=(e=>({apiVersion:"2016-06-27",base64Decoder:e?.base64Decoder??rr,base64Encoder:e?.base64Encoder??or,disableHostPrefix:e?.disableHostPrefix??!1,endpointProvider:e?.endpointProvider??gl,extensions:e?.extensions??[],logger:e?.logger??new Yn,serviceId:e?.serviceId??"Rekognition",urlParser:e?.urlParser??fn,utf8Decoder:e?.utf8Decoder??Ee,utf8Encoder:e?.utf8Encoder??Se}))(e);return{...r,...e,runtime:"node",defaultsMode:t,bodyLengthChecker:e?.bodyLengthChecker??Ba,credentialDefaultProvider:e?.credentialDefaultProvider??(o=ad,e=>o({roleAssumer:Hd(e),roleAssumerWithWebIdentity:Kd(e),...e})),defaultUserAgentProvider:e?.defaultUserAgentProvider??La({serviceId:r.serviceId,clientVersion:fo}),maxAttempts:e?.maxAttempts??wa(qn),region:e?.region??wa(Yt,Zt),requestHandler:e?.requestHandler??new ur(n),retryMode:e?.retryMode??wa({...Wn,default:async()=>(await n()).retryMode||xn}),sha256:e?.sha256??za.bind(null,"sha256"),streamCollector:e?.streamCollector??lr,useDualstackEndpoint:e?.useDualstackEndpoint??wa(Xt),useFipsEndpoint:e?.useFipsEndpoint??wa(Jt)};var o};class yl extends tr{constructor(...[e]){const t=ml(e||{}),n=(r=t,{...r,useDualstackEndpoint:r.useDualstackEndpoint??!1,useFipsEndpoint:r.useFipsEndpoint??!1,defaultSigningName:"rekognition"});var r;const o=tn(n),s=vn(o),i=Bn(s),a=((e,t)=>{const n={...Qr(e)};return t.forEach((e=>e.configure(n))),{...e,...eo(n)}})(at(et(i)),e?.extensions||[]);super(a),this.config=a,this.middlewareStack.use(Xn(this.config)),this.middlewareStack.use(on(this.config)),this.middlewareStack.use(x(this.config)),this.middlewareStack.use(I(this.config)),this.middlewareStack.use(T(this.config)),this.middlewareStack.use(it(this.config)),this.middlewareStack.use(Ht(this.config))}destroy(){super.destroy()}}class wl extends Wr{constructor(e){super(e),Object.setPrototypeOf(this,wl.prototype)}}class bl extends wl{constructor(e){super({name:"AccessDeniedException",$fault:"client",...e}),this.name="AccessDeniedException",this.$fault="client",Object.setPrototypeOf(this,bl.prototype),this.Message=e.Message,this.Code=e.Code,this.Logref=e.Logref}}class vl extends wl{constructor(e){super({name:"InternalServerError",$fault:"server",...e}),this.name="InternalServerError",this.$fault="server",Object.setPrototypeOf(this,vl.prototype),this.Message=e.Message,this.Code=e.Code,this.Logref=e.Logref}}class El extends wl{constructor(e){super({name:"InvalidParameterException",$fault:"client",...e}),this.name="InvalidParameterException",this.$fault="client",Object.setPrototypeOf(this,El.prototype),this.Message=e.Message,this.Code=e.Code,this.Logref=e.Logref}}class xl extends wl{constructor(e){super({name:"ProvisionedThroughputExceededException",$fault:"client",...e}),this.name="ProvisionedThroughputExceededException",this.$fault="client",Object.setPrototypeOf(this,xl.prototype),this.Message=e.Message,this.Code=e.Code,this.Logref=e.Logref}}class Sl extends wl{constructor(e){super({name:"ThrottlingException",$fault:"server",...e}),this.name="ThrottlingException",this.$fault="server",Object.setPrototypeOf(this,Sl.prototype),this.Message=e.Message,this.Code=e.Code,this.Logref=e.Logref}}class Il extends wl{constructor(e){super({name:"ImageTooLargeException",$fault:"client",...e}),this.name="ImageTooLargeException",this.$fault="client",Object.setPrototypeOf(this,Il.prototype),this.Message=e.Message,this.Code=e.Code,this.Logref=e.Logref}}class Al extends wl{constructor(e){super({name:"InvalidImageFormatException",$fault:"client",...e}),this.name="InvalidImageFormatException",this.$fault="client",Object.setPrototypeOf(this,Al.prototype),this.Message=e.Message,this.Code=e.Code,this.Logref=e.Logref}}class Pl extends wl{constructor(e){super({name:"InvalidS3ObjectException",$fault:"client",...e}),this.name="InvalidS3ObjectException",this.$fault="client",Object.setPrototypeOf(this,Pl.prototype),this.Message=e.Message,this.Code=e.Code,this.Logref=e.Logref}}const Tl=async(e,t)=>{const n={...e,body:await ip(e.body,t)},r=ap(e,n.body);switch(r){case"AccessDeniedException":case"com.amazonaws.rekognition#AccessDeniedException":throw await kl(n);case"ImageTooLargeException":case"com.amazonaws.rekognition#ImageTooLargeException":throw await Ol(n);case"InternalServerError":case"com.amazonaws.rekognition#InternalServerError":throw await _l(n);case"InvalidImageFormatException":case"com.amazonaws.rekognition#InvalidImageFormatException":throw await Rl(n);case"InvalidParameterException":case"com.amazonaws.rekognition#InvalidParameterException":throw await $l(n);case"InvalidS3ObjectException":case"com.amazonaws.rekognition#InvalidS3ObjectException":throw await Nl(n);case"ProvisionedThroughputExceededException":case"com.amazonaws.rekognition#ProvisionedThroughputExceededException":throw await Dl(n);case"ThrottlingException":case"com.amazonaws.rekognition#ThrottlingException":throw await jl(n);default:const t=n.body;return np({output:e,parsedBody:t,errorCode:r})}},Cl=async(e,t)=>{const n={...e,body:await ip(e.body,t)},r=ap(e,n.body);switch(r){case"AccessDeniedException":case"com.amazonaws.rekognition#AccessDeniedException":throw await kl(n);case"ImageTooLargeException":case"com.amazonaws.rekognition#ImageTooLargeException":throw await Ol(n);case"InternalServerError":case"com.amazonaws.rekognition#InternalServerError":throw await _l(n);case"InvalidImageFormatException":case"com.amazonaws.rekognition#InvalidImageFormatException":throw await Rl(n);case"InvalidParameterException":case"com.amazonaws.rekognition#InvalidParameterException":throw await $l(n);case"InvalidS3ObjectException":case"com.amazonaws.rekognition#InvalidS3ObjectException":throw await Nl(n);case"ProvisionedThroughputExceededException":case"com.amazonaws.rekognition#ProvisionedThroughputExceededException":throw await Dl(n);case"ThrottlingException":case"com.amazonaws.rekognition#ThrottlingException":throw await jl(n);default:const t=n.body;return np({output:e,parsedBody:t,errorCode:r})}},kl=async(e,t)=>{const n=e.body,r=po(n),o=new bl({$metadata:tp(e),...r});return Vr(o,n)},Ol=async(e,t)=>{const n=e.body,r=po(n),o=new Il({$metadata:tp(e),...r});return Vr(o,n)},_l=async(e,t)=>{const n=e.body,r=po(n),o=new vl({$metadata:tp(e),...r});return Vr(o,n)},Rl=async(e,t)=>{const n=e.body,r=po(n),o=new Al({$metadata:tp(e),...r});return Vr(o,n)},$l=async(e,t)=>{const n=e.body,r=po(n),o=new El({$metadata:tp(e),...r});return Vr(o,n)},Nl=async(e,t)=>{const n=e.body,r=po(n),o=new Pl({$metadata:tp(e),...r});return Vr(o,n)},Dl=async(e,t)=>{const n=e.body,r=po(n),o=new xl({$metadata:tp(e),...r});return Vr(o,n)},jl=async(e,t)=>{const n=e.body,r=po(n),o=new Sl({$metadata:tp(e),...r});return Vr(o,n)},Ul=(e,t)=>so(e,{Features:po,Image:e=>Ll(e,t),MaxLabels:[],MinConfidence:lo,Settings:po}),Fl=(e,t)=>so(e,{RegionsOfInterest:e=>Bl(e),WordFilter:e=>((e,t)=>so(e,{MinBoundingBoxHeight:lo,MinBoundingBoxWidth:lo,MinConfidence:lo}))(e)}),Ml=(e,t)=>so(e,{Filters:e=>Fl(e),Image:e=>Ll(e,t)}),Ll=(e,t)=>so(e,{Bytes:t.base64Encoder,S3Object:po}),zl=(e,t)=>e.filter((e=>null!=e)).map((e=>((e,t)=>so(e,{X:lo,Y:lo}))(e))),ql=(e,t)=>so(e,{BoundingBox:e=>((e,t)=>so(e,{Height:lo,Left:lo,Top:lo,Width:lo}))(e),Polygon:e=>zl(e)}),Bl=(e,t)=>e.filter((e=>null!=e)).map((e=>ql(e))),Wl=(e,t)=>so(e,{Height:Cr,Left:Cr,Top:Cr,Width:Cr}),Vl=(e,t)=>so(e,{Background:e=>((e,t)=>so(e,{DominantColors:e=>Xl(e),Quality:e=>Hl(e)}))(e),DominantColors:e=>Xl(e),Foreground:e=>((e,t)=>so(e,{DominantColors:e=>Xl(e),Quality:e=>Hl(e)}))(e),Quality:e=>Hl(e)}),Hl=(e,t)=>so(e,{Brightness:Cr,Contrast:Cr,Sharpness:Cr}),Kl=(e,t)=>so(e,{ImageProperties:e=>Vl(e),LabelModelVersion:Ar,Labels:e=>Yl(e),OrientationCorrection:Ar}),Gl=(e,t)=>so(e,{TextDetections:e=>ep(e),TextModelVersion:Ar}),Xl=(e,t)=>{const n=(e||[]).filter((e=>null!=e)).map((e=>((e,t)=>so(e,{Blue:wr,CSSColor:Ar,Green:wr,HexCode:Ar,PixelPercent:Cr,Red:wr,SimplifiedColor:Ar}))(e)));return n},Jl=(e,t)=>{const n=(e||[]).filter((e=>null!=e)).map((e=>((e,t)=>so(e,{BoundingBox:e=>Wl(e),Confidence:Cr,DominantColors:e=>Xl(e)}))(e)));return n},Yl=(e,t)=>{const n=(e||[]).filter((e=>null!=e)).map((e=>((e,t)=>so(e,{Aliases:po,Categories:po,Confidence:Cr,Instances:e=>Jl(e),Name:Ar,Parents:po}))(e)));return n},Zl=(e,t)=>{const n=(e||[]).filter((e=>null!=e)).map((e=>((e,t)=>so(e,{X:Cr,Y:Cr}))(e)));return n},Ql=(e,t)=>so(e,{Confidence:Cr,DetectedText:Ar,Geometry:e=>((e,t)=>so(e,{BoundingBox:e=>Wl(e),Polygon:e=>Zl(e)}))(e),Id:wr,ParentId:wr,Type:Ar}),ep=(e,t)=>{const n=(e||[]).filter((e=>null!=e)).map((e=>Ql(e)));return n},tp=e=>({httpStatusCode:e.statusCode,requestId:e.headers["x-amzn-requestid"]??e.headers["x-amzn-request-id"]??e.headers["x-amz-request-id"],extendedRequestId:e.headers["x-amz-id-2"],cfId:e.headers["x-amz-cf-id"]}),np=Hr(wl),rp=async(e,t,n,r,o)=>{const{hostname:s,protocol:i="https",port:a,path:c}=await e.endpoint(),u={protocol:i,hostname:s,port:a,method:"POST",path:c.endsWith("/")?c.slice(0,-1)+n:c+n,headers:t};return void 0!==r&&(u.hostname=r),void 0!==o&&(u.body=o),new b(u)};function op(e){return{"content-type":"application/x-amz-json-1.1","x-amz-target":`RekognitionService.${e}`}}const sp=(e,t)=>((e,t)=>pr(e,t).then((e=>t.utf8Encoder(e))))(e,t).then((e=>e.length?JSON.parse(e):{})),ip=async(e,t)=>{const n=await sp(e,t);return n.message=n.message??n.Message,n},ap=(e,t)=>{const n=e=>{let t=e;return"number"==typeof t&&(t=t.toString()),t.indexOf(",")>=0&&(t=t.split(",")[0]),t.indexOf(":")>=0&&(t=t.split(":")[0]),t.indexOf("#")>=0&&(t=t.split("#")[1]),t},r=(o=e.headers,s="x-amzn-errortype",Object.keys(o).find((e=>e.toLowerCase()===s.toLowerCase())));var o,s;return void 0!==r?n(e.headers[r]):void 0!==t.code?n(t.code):void 0!==t.__type?n(t.__type):void 0};class cp extends fr{static getEndpointParameterInstructions(){return{UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}}}constructor(e){super(),this.input=e}resolveMiddleware(e,t,n){this.middlewareStack.use(yn(t,this.serialize,this.deserialize)),this.middlewareStack.use(bn(t,cp.getEndpointParameterInstructions()));const r=e.concat(this.middlewareStack),{logger:o}=t,s={logger:o,clientName:"RekognitionClient",commandName:"DetectLabelsCommand",inputFilterSensitiveLog:e=>e,outputFilterSensitiveLog:e=>e},{requestHandler:i}=t;return r.resolve((e=>i.handle(e.request,n||{})),s)}serialize(e,t){return(async(e,t)=>{const n=op("DetectLabels");let r;return r=JSON.stringify(Ul(e,t)),rp(t,n,"/",void 0,r)})(e,t)}deserialize(e,t){return(async(e,t)=>{if(e.statusCode>=300)return Tl(e,t);const n=await sp(e.body,t);let r={};return r=Kl(n),{$metadata:tp(e),...r}})(e,t)}}class up extends fr{static getEndpointParameterInstructions(){return{UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}}}constructor(e){super(),this.input=e}resolveMiddleware(e,t,n){this.middlewareStack.use(yn(t,this.serialize,this.deserialize)),this.middlewareStack.use(bn(t,up.getEndpointParameterInstructions()));const r=e.concat(this.middlewareStack),{logger:o}=t,s={logger:o,clientName:"RekognitionClient",commandName:"DetectTextCommand",inputFilterSensitiveLog:e=>e,outputFilterSensitiveLog:e=>e},{requestHandler:i}=t;return r.resolve((e=>i.handle(e.request,n||{})),s)}serialize(e,t){return(async(e,t)=>{const n=op("DetectText");let r;return r=JSON.stringify(Ml(e,t)),rp(t,n,"/",void 0,r)})(e,t)}deserialize(e,t){return(async(e,t)=>{if(e.statusCode>=300)return Cl(e,t);const n=await sp(e.body,t);let r={};return r=Gl(n),{$metadata:tp(e),...r}})(e,t)}}function dp(e,t){if("__proto__"!==e)return t}function lp(e){return"string"==typeof e?(t=e,String(t).includes("__proto__")?JSON.parse(t,dp):JSON.parse(t)):e;var t}const pp=async e=>new Promise(((t,n)=>{const r=Array();e.on("data",(e=>r.push(e))),e.on("end",(()=>t(Buffer.concat(r)))),e.on("error",(e=>n(`error converting stream - ${e}`)))})),fp=require("axios");var hp={id:"describe-image",handler:async({field:e,api:t},{data:n,env:r,logger:o,accountability:s,database:i,getSchema:a,services:c})=>{var u,d,l;const p=null!=e?e:lp(n.$trigger).key;if(!p)throw Error("Key is empty");const f=await a({database:i}),{AssetsService:h}=c,g=new h({schema:f}),m=await g.getAsset(p,{transformationParams:{},acceptFormat:null});if(!m)throw Error("Could not find the asset");if(-1===m.file.type.indexOf("image"))throw Error("This operation only works for images");var y=await pp(m.stream);if("alttext.ai"==t){if(!r.ALTTEXT_AI_API_KEY)throw Error("Missing required environment variables");const e=await fp.post("https://alttext.ai/api/v1/images",JSON.stringify({image:{raw:y.toString("base64"),asset_id:m.file.id}}),{headers:{"Content-Type":"application/json","X-API-Key":r.ALTTEXT_AI_API_KEY}});if(null==(u=e.data)?void 0:u.alt_text)return{description:null==(d=e.data)?void 0:d.alt_text,$raw:e.data};throw Error(e.data.errors)}{if(!r.AWS_ACCESS_KEY_ID||!r.AWS_SECRET_ACCESS_KEY||!r.AWS_REGION)throw Error("Missing required environment variables");const e=new yl({region:r.AWS_REGION}),t=new cp({Image:{Bytes:y},MaxLabels:10,MinConfidence:80}),n=await e.send(t);return{description:null==(l=n.Labels)?void 0:l.map((e=>e.Name)).join(", "),$raw:n}}}},gp={id:"extract-text-from-image",handler:async({field:e,api:t},{data:n,env:r,database:o,getSchema:s,services:i})=>{var a,c,u;const d=null!=e?e:lp(n.$trigger).key;if(!d)throw Error("Key is empty");const l=await s({database:o}),{AssetsService:p}=i,f=new p({schema:l}),h=await f.getAsset(d,{transformationParams:{},acceptFormat:null});if(!h)throw Error("Could not find any files");if(-1===h.file.type.indexOf("image"))throw Error("This operation only works for images");var g=await pp(h.stream);if("azure-vision-ai"==t)return null;{if(!r.AWS_ACCESS_KEY_ID||!r.AWS_SECRET_ACCESS_KEY||!r.AWS_REGION)throw Error("Missing required environment variables");const e=new yl({region:r.AWS_REGION}),t=new up({Image:{Bytes:g}}),n=await e.send(t),o=null==(c=null==(a=n.TextDetections)?void 0:a.filter((e=>"LINE"==e.Type)))?void 0:c.map((e=>{var t,n,r,o,s,i,a,c;return{text:e.DetectedText,confidence:e.Confidence,geometry:{top:null==(n=null==(t=e.Geometry)?void 0:t.BoundingBox)?void 0:n.Top,left:null==(o=null==(r=e.Geometry)?void 0:r.BoundingBox)?void 0:o.Left,height:null==(i=null==(s=e.Geometry)?void 0:s.BoundingBox)?void 0:i.Height,width:null==(c=null==(a=e.Geometry)?void 0:a.BoundingBox)?void 0:c.Width}}}));return{lines:o,full_text:null==(u=null==o?void 0:o.map((e=>e.text)))?void 0:u.join("\n"),$raw:n}}}};const mp=[{name:"describe-image",config:hp},{name:"extract-text-from-image",config:gp}];exports.endpoints=[],exports.hooks=[],exports.operations=mp;
